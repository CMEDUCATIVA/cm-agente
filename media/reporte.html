<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Cronograma Real vs Planificado</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-zoom@2.0.1/dist/chartjs-plugin-zoom.min.js"></script>
  <style>
    :root {
      --bg: #ffffff;
      --panel: #ffffff;
      --accent: #1d4ed8;
      --text: #0f172a;
      --muted: #475569;
      --border: #e2e8f0;
      --success: #16a34a;
      --warning: #ea580c;
    }
    * { box-sizing: border-box; }
    body {
      margin: 0 auto;
      padding: 16px;
      font-family: "Inter", -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      background: var(--bg);
      color: var(--text);
      max-width: 297mm; /* A4 horizontal */
    }
    h1, h2, h3 { margin: 0 0 10px; font-weight: 700; }
    .header {
      display: flex;
      flex-direction: column;
      align-items: flex-start;
      gap: 8px;
      margin-bottom: 12px;
      width: 100%;
    }
    .badge {
      display: inline-flex;
      align-items: center;
      padding: 6px 10px;
      border-radius: 8px;
      background: #eef2ff;
      border: 1px solid #dfe4ff;
      color: var(--text);
      font-weight: 600;
      font-size: 12px;
    }
    .graph-panel .badge { margin-bottom: 20px; }
    .project-title {
      font-size: 20px;
      padding: 10px 14px;
      font-weight: 700;
    }
    .panel {
      background: var(--panel);
      border: 1px solid var(--border);
      border-radius: 12px;
      padding: 12px;
      box-shadow: 0 8px 26px rgba(15, 23, 42, 0.08);
      margin-bottom: 12px;
      position: relative;
    }
    .graph-panel { padding-bottom: 48px; }
    .controls {
      display: flex;
      flex-wrap: wrap;
      gap: 12px;
      align-items: center;
      margin-bottom: 8px;
    }
    .input {
      background: #f8fafc;
      border: 1px solid var(--border);
      border-radius: 8px;
      padding: 6px 10px;
      color: var(--text);
      min-width: 220px;
    }
    .btn {
      background: var(--accent);
      border: none;
      color: white;
      padding: 5px 9px;
      border-radius: 8px;
      cursor: pointer;
      font-weight: 600;
      font-size: 12px;
      transition: transform 0.08s ease, box-shadow 0.15s ease;
      box-shadow: 0 4px 14px rgba(29, 78, 216, 0.25);
      display: inline-flex;
      align-items: center;
      gap: 6px;
    }
    .btn:hover { transform: translateY(-1px); }
    .btn:active { transform: translateY(0); }
    .btn svg {
      width: 16px;
      height: 16px;
      fill: white;
    }
    .btn-ghost {
      background: #0f172a;
      color: white;
      box-shadow: 0 4px 14px rgba(15, 23, 42, 0.25);
    }
    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 6px;
      font-size: 12px;
    }
    th, td {
      text-align: left;
      padding: 8px 6px;
      border-bottom: 1px solid var(--border);
    }
    th { color: var(--muted); font-weight: 700; letter-spacing: 0.01em; }
    tr:hover { background: #f8fafc; }
    .status {
      padding: 4px 8px;
      border-radius: 6px;
      font-weight: 700;
      font-size: 11px;
      display: inline-block;
      background: #ecfdf3;
      color: var(--success);
      border: 1px solid #bbf7d0;
    }
    .status-muted {
      background: #f1f5f9;
      color: #475569;
      border: 1px solid #e2e8f0;
    }
    .cost { color: var(--warning); font-weight: 600; }
    canvas {
      width: 100%;
      height: 260px;
      display: block;
    }
    #status-tooltip, #aging-tooltip {
      position: fixed;
      background: rgba(15, 23, 42, 0.92);
      color: #fff;
      padding: 6px 10px;
      border-radius: 8px;
      font-size: 12px;
      pointer-events: none;
      box-shadow: 0 6px 20px rgba(0,0,0,0.25);
      opacity: 0;
      transition: opacity 0.1s ease;
      z-index: 9999;
      border: 1px solid var(--accent);
    }
    .chart-footer {
      display: flex;
      justify-content: center;
      align-items: center;
      gap: 10px;
      margin-top: 8px;
      flex-wrap: wrap;
    }
    .chart-desc {
      color: var(--muted);
      font-size: 12px;
      text-align: center;
    }
    .heatmap-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
      gap: 10px;
      margin-top: 8px;
    }
    .heat-cell {
      position: relative;
      border-radius: 10px;
      padding: 10px;
      border: 1px solid var(--border);
      background: #f8fafc;
      transition: transform 0.08s ease, box-shadow 0.15s ease;
    }
    .heat-cell:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 20px rgba(15, 23, 42, 0.08);
    }
    .heat-label { font-size: 12px; color: var(--muted); }
    .heat-value { font-size: 22px; font-weight: 700; color: var(--text); }
    .heat-sub { font-size: 12px; color: var(--muted); }
    .table-wrapper {
      height: auto;
      overflow: visible;
      border: 1px solid var(--border);
      border-radius: 12px;
      background: #fff;
      margin-bottom: 10px;
      padding-bottom: 12px;
    }
    .table-chunk {
      border: 1px solid var(--border);
      border-radius: 12px;
      padding: 12px 12px 28px 12px;
      margin-bottom: 24px;
      page-break-inside: avoid;
      background: #fff;
      box-shadow: 0 4px 14px rgba(15, 23, 42, 0.05);
    }
    .phase-summary {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
      gap: 8px;
      margin: 6px 0 10px;
      font-size: 12px;
      color: var(--muted);
    }
    .phase-summary strong {
      color: var(--text);
      font-weight: 600;
    }
    @media print {
      @page { size: A4 landscape; margin: 10mm; }
      body {
        box-shadow: none;
        max-width: 297mm;
        padding: 10mm;
      }
      .btn { display: none; }
      .panel {
        box-shadow: none;
        page-break-inside: avoid;
      }
      .table-wrapper {
        height: 320px !important;
        max-height: 320px !important;
        overflow: hidden;
      }
      table, tr, td, th {
        page-break-inside: avoid;
      }
      .header { page-break-inside: avoid; }
      .table-chunk { page-break-inside: avoid; }
      .table-chunk[data-chunk-index="0"] { page-break-after: always; }
      .table-chunk[data-chunk-index]:not([data-chunk-index="0"]):nth-of-type(2n) { page-break-after: always; }
    }
    .download-icon {
      width: 32px;
      height: 32px;
      border: none;
      background: transparent;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      padding: 0;
      color: #2563eb;
      box-shadow: none;
      outline: none;
      appearance: none;
    }
    .download-icon:hover { transform: translateY(-1px); }
    .download-icon svg { width: 24px; height: 24px; fill: currentColor; display: block; }
    .chart-actions {
      display: flex;
      justify-content: flex-start;
      gap: 8px;
      margin-top: 8px;
    }
    .chart-scroll { overflow: hidden; max-width: 100%; }
    .chart-scroll canvas { display: block; }
    .chart-scroll-y {
      max-height: 420px;
      overflow-y: auto;
      overflow-x: hidden;
    }
    .kpi-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
      gap: 10px;
      margin-top: 8px;
    }
    .kpi-card {
      border: 1px solid var(--border);
      border-radius: 12px;
      background: #fff;
      padding: 10px;
      text-align: center;
      box-shadow: 0 4px 14px rgba(15, 23, 42, 0.05);
    }
    .kpi-title {
      font-size: 12px;
      color: var(--muted);
      margin-bottom: 6px;
      font-weight: 600;
    }
    .kpi-sub {
      font-size: 11px;
      color: var(--muted);
      margin-top: 4px;
    }
    .kpi-canvas {
      width: 100%;
      height: 110px;
      display: block;
    }
    .kpi-select {
      width: 100%;
      min-width: 0;
      max-width: 100%;
      display: block;
      border-radius: 4px;
      height: 28px;
      padding: 4px 8px;
      text-align-last: left;
    }
    .progress-legend {
      display: flex;
      flex-direction: column;
      align-items: flex-start;
      gap: 6px;
      margin: 8px 0 14px;
      font-size: 12px;
      color: var(--muted);
    }
    .progress-legend-item {
      display: flex;
      align-items: center;
      gap: 6px;
    }
    .legend-swatch {
      width: 12px;
      height: 12px;
      border-radius: 3px;
      display: inline-block;
    }
    .legend-bar { background: #2563eb; }
    .legend-line { border: 2px solid #16a34a; background: transparent; }
    .legend-time { border: 2px dashed #94a3b8; background: transparent; }
    .legend-est { border: 2px dashed #64748b; background: transparent; }
    .legend-cost { border: 2px dashed #f59e0b; background: transparent; }
    .legend-disabled { opacity: 0.4; }
    .startcurve-legend {
      display: flex;
      flex-direction: column;
      gap: 6px;
      margin: 6px 0 10px;
    }
    .startcurve-legend-item {
      display: flex;
      align-items: center;
      gap: 8px;
      font-size: 12px;
      color: #0f172a;
      cursor: pointer;
      user-select: none;
    }
    .startcurve-legend-item .legend-dot {
      width: 12px;
      height: 12px;
      border-radius: 3px;
    }
    .startcurve-legend-item.legend-disabled {
      opacity: 0.4;
    }
    @media print {
      body.print-selected .graph-panel:not(.print-target) {
        display: none !important;
      }
      body.print-selected .panel.print-target {
        display: block !important;
        width: 100% !important;
        max-width: 100% !important;
        margin: 0 !important;
        box-shadow: none !important;
        border: none !important;
        page-break-after: always;
      }
    }
  </style>
</head>
<body>
  <div class="header">
    <div style="display:flex; align-items:center; justify-content:space-between; gap:8px; flex-wrap:wrap; margin-top:6px; width:100%;">
      <div class="badge project-title" id="project-badge">Proyecto: --</div>
      <div style="display:flex; align-items:center; gap:8px; flex-wrap:wrap;">
        <button class="btn" id="download-pdf-btn">
          <svg viewBox="0 0 24 24" aria-hidden="true"><path d="M12 3a1 1 0 0 1 1 1v9.586l2.293-2.293a1 1 0 0 1 1.414 1.414l-4 4a1 1 0 0 1-1.414 0l-4-4a1 1 0 1 1 1.414-1.414L11 13.586V4a1 1 0 0 1 1-1zm-7 14a1 1 0 1 1 0-2h14a1 1 0 1 1 0 2H5z"/></svg>
          PDF
        </button>
        <div class="badge" id="generated-at">Generado: --</div>
      </div>
    </div>
    <div style="display:flex; align-items:center; gap:8px; flex-wrap:wrap; margin-top:6px; width:100%;">
      <input class="input" id="search-input" placeholder="Buscar paquetes de trabajo..." />
      <select class="input" id="status-filter">
        <option value="">Todos los estados</option>
      </select>
      <select class="input" id="graph-select" style="min-width:220px;">
        <option value="status">Inventario de estados</option>
        <option value="aging">Aging Index (Indice de Envejecimiento)</option>
        <option value="labor-people">Costos de mano de obra</option>
        <option value="progress-curve">Curva S de progreso</option>
        <option value="real-hours">Uso de horas reales</option>
        <option value="role-performance">Rendimiento por rol</option>
        <option value="startcurve">Linea de tiempo de Paquetes de trabajo</option>
      </select>
    </div>
  </div>

  <div class="panel graph-panel" id="status-panel" data-graph-panel="status">
    <canvas id="status-chart"></canvas>
    <div id="status-tooltip"></div>
    <div class="chart-footer">
      <div class="chart-desc">Inventario de estados: cuantos paquetes de trabajo hay por cada estado.</div>
    </div>
    <div class="chart-actions">
      <span class="download-icon" id="download-status-png" title="Descargar PNG" role="button" tabindex="0">
        <svg viewBox="0 0 20 20" aria-hidden="true">
          <path fill="currentColor" d="M2.66821 12.6663V12.5003C2.66821 12.1331 2.96598 11.8353 3.33325 11.8353C3.70052 11.8353 3.99829 12.1331 3.99829 12.5003V12.6663C3.99829 13.3772 3.9992 13.8707 4.03052 14.2542C4.0612 14.6298 4.11803 14.8413 4.19849 14.9993L4.2688 15.1263C4.44511 15.4137 4.69813 15.6481 5.00024 15.8021L5.13013 15.8577C5.2739 15.9092 5.46341 15.947 5.74536 15.97C6.12888 16.0014 6.62221 16.0013 7.33325 16.0013H12.6663C13.3771 16.0013 13.8707 16.0014 14.2542 15.97C14.6295 15.9394 14.8413 15.8825 14.9993 15.8021L15.1262 15.7308C15.4136 15.5545 15.6481 15.3014 15.802 14.9993L15.8577 14.8695C15.9091 14.7257 15.9469 14.536 15.97 14.2542C16.0013 13.8707 16.0012 13.3772 16.0012 12.6663V12.5003C16.0012 12.1332 16.2991 11.8355 16.6663 11.8353C17.0335 11.8353 17.3313 12.1331 17.3313 12.5003V12.6663C17.3313 13.3553 17.3319 13.9124 17.2952 14.3626C17.2624 14.7636 17.1974 15.1247 17.053 15.4613L16.9866 15.6038C16.7211 16.1248 16.3172 16.5605 15.8215 16.8646L15.6038 16.9866C15.227 17.1786 14.8206 17.2578 14.3625 17.2952C13.9123 17.332 13.3553 17.3314 12.6663 17.3314H7.33325C6.64416 17.3314 6.0872 17.332 5.63696 17.2952C5.23642 17.2625 4.87552 17.1982 4.53931 17.054L4.39673 16.9866C3.87561 16.7211 3.43911 16.3174 3.13501 15.8216L3.01294 15.6038C2.82097 15.2271 2.74177 14.8206 2.70435 14.3626C2.66758 13.9124 2.66821 13.3553 2.66821 12.6663ZM9.33521 3.33333C9.33521 2.96606 9.63298 2.66829 10.0002 2.66829C10.3674 2.66847 10.6653 2.96617 10.6653 3.33333V10.8939L12.8625 8.69661L12.967 8.61165C13.2252 8.44092 13.5766 8.46925 13.804 8.69661C14.0633 8.95628 14.0634 9.37744 13.804 9.63704L10.47 12.97C10.3453 13.0947 10.1765 13.1653 10.0002 13.1654C9.82388 13.1654 9.65425 13.0948 9.52954 12.97L6.19653 9.63704L6.11157 9.53255C5.94101 9.27441 5.96924 8.9239 6.19653 8.69661C6.42382 8.46932 6.77433 8.44109 7.03247 8.61165L7.13696 8.69661L9.33521 10.8949V3.33333Z"></path>
        </svg>
      </span>
    </div>
  </div>

  <div class="panel graph-panel" id="aging-panel" data-graph-panel="aging">
    <div class="badge">Aging Index (Indice de Envejecimiento)</div>
    <div class="heatmap-grid" id="aging-heatmap"></div>
    <div id="aging-tooltip"></div>
    <div class="chart-footer" style="justify-content:center; margin-top:8px;">
      <div class="chart-desc">Dias transcurridos desde la ultima actualizacion (updatedAt).</div>
    </div>
    <div class="chart-actions">
      <span class="download-icon" id="download-aging-png" title="Descargar PNG" role="button" tabindex="0">
        <svg viewBox="0 0 20 20" aria-hidden="true">
          <path fill="currentColor" d="M2.66821 12.6663V12.5003C2.66821 12.1331 2.96598 11.8353 3.33325 11.8353C3.70052 11.8353 3.99829 12.1331 3.99829 12.5003V12.6663C3.99829 13.3772 3.9992 13.8707 4.03052 14.2542C4.0612 14.6298 4.11803 14.8413 4.19849 14.9993L4.2688 15.1263C4.44511 15.4137 4.69813 15.6481 5.00024 15.8021L5.13013 15.8577C5.2739 15.9092 5.46341 15.947 5.74536 15.97C6.12888 16.0014 6.62221 16.0013 7.33325 16.0013H12.6663C13.3771 16.0013 13.8707 16.0014 14.2542 15.97C14.6295 15.9394 14.8413 15.8825 14.9993 15.8021L15.1262 15.7308C15.4136 15.5545 15.6481 15.3014 15.802 14.9993L15.8577 14.8695C15.9091 14.7257 15.9469 14.536 15.97 14.2542C16.0013 13.8707 16.0012 13.3772 16.0012 12.6663V12.5003C16.0012 12.1332 16.2991 11.8355 16.6663 11.8353C17.0335 11.8353 17.3313 12.1331 17.3313 12.5003V12.6663C17.3313 13.3553 17.3319 13.9124 17.2952 14.3626C17.2624 14.7636 17.1974 15.1247 17.053 15.4613L16.9866 15.6038C16.7211 16.1248 16.3172 16.5605 15.8215 16.8646L15.6038 16.9866C15.227 17.1786 14.8206 17.2578 14.3625 17.2952C13.9123 17.332 13.3553 17.3314 12.6663 17.3314H7.33325C6.64416 17.3314 6.0872 17.332 5.63696 17.2952C5.23642 17.2625 4.87552 17.1982 4.53931 17.054L4.39673 16.9866C3.87561 16.7211 3.43911 16.3174 3.13501 15.8216L3.01294 15.6038C2.82097 15.2271 2.74177 14.8206 2.70435 14.3626C2.66758 13.9124 2.66821 13.3553 2.66821 12.6663ZM9.33521 3.33333C9.33521 2.96606 9.63298 2.66829 10.0002 2.66829C10.3674 2.66847 10.6653 2.96617 10.6653 3.33333V10.8939L12.8625 8.69661L12.967 8.61165C13.2252 8.44092 13.5766 8.46925 13.804 8.69661C14.0633 8.95628 14.0634 9.37744 13.804 9.63704L10.47 12.97C10.3453 13.0947 10.1765 13.1653 10.0002 13.1654C9.82388 13.1654 9.65425 13.0948 9.52954 12.97L6.19653 9.63704L6.11157 9.53255C5.94101 9.27441 5.96924 8.9239 6.19653 8.69661C6.42382 8.46932 6.77433 8.44109 7.03247 8.61165L7.13696 8.69661L9.33521 10.8949V3.33333Z"></path>
        </svg>
      </span>
    </div>
  </div>


  <div class="panel graph-panel" id="labor-people-panel" data-graph-panel="labor-people">
    <div style="display:flex; align-items:center; justify-content:space-between; gap:8px; flex-wrap:wrap;">
      <div class="badge">Paquetes principales e independientes</div>
      <div class="badge" id="labor-people-total">Total: --</div>
    </div>
    <div class="chart-scroll-y">
      <canvas id="labor-people-mothers-chart"></canvas>
    </div>
    <div class="chart-footer" style="justify-content:center; margin-top:8px;">
      <div class="chart-desc">Muestra qué grupos/personas aportan más al costo total por paquete principal o independiente (apilado).</div>
    </div>
    <div style="display:flex; align-items:center; justify-content:space-between; gap:8px; flex-wrap:wrap; margin-top:10px;">
      <div class="badge">Subpaquetes</div>
      <div class="badge" id="labor-children-total">Total: --</div>
    </div>
    <div class="chart-scroll-y">
      <canvas id="labor-people-children-chart"></canvas>
    </div>
    <div class="chart-footer" style="justify-content:center; margin-top:8px;">
      <div class="chart-desc">Muestra qué grupos/personas aportan más al costo total por subpaquete (apilado).</div>
    </div>
  </div>

  <div class="panel graph-panel" id="progress-curve-panel" data-graph-panel="progress-curve">
    <div class="badge">Paquetes principales e independientes</div>
    <div class="progress-legend" data-legend-for="main">
      <div class="progress-legend-item" data-dataset="0"><span class="legend-swatch legend-bar"></span>Progreso diario real</div>
      <div class="progress-legend-item" data-dataset="1"><span class="legend-swatch legend-line"></span>Progreso acumulado real</div>
      <div class="progress-legend-item" data-dataset="2"><span class="legend-swatch legend-time"></span>Horas invertidas reales</div>
      <div class="progress-legend-item" data-dataset="3"><span class="legend-swatch legend-est"></span>Horas estimadas de trabajo</div>
      <div class="progress-legend-item" data-dataset="4"><span class="legend-swatch legend-cost"></span>Costos reales</div>
    </div>
    <div class="controls" style="margin:6px 0 12px;">
      <select class="input" id="progress-range-main" style="min-width:200px;">
        <option value="all" selected>Todo</option>
        <option value="today">Hoy</option>
        <option value="last3">Ultimos 3 dias</option>
        <option value="last7">Ultimos 7 dias</option>
        <option value="month">Mes actual</option>
        <option value="year">Ano actual</option>
      </select>
    </div>
    <div class="chart-scroll" id="progress-main-scroll">
      <canvas id="progress-curve-main-chart"></canvas>
    </div>
    <div class="chart-footer" style="justify-content:center; margin-top:8px;">
      <div class="chart-desc">Linea: porcentaje real acumulado. Barras: progreso diario (ponderado por estimacion).</div>
    </div>
    <div class="badge" style="margin-top:14px;">Subpaquetes</div>
    <div class="progress-legend" data-legend-for="child">
      <div class="progress-legend-item" data-dataset="0"><span class="legend-swatch legend-bar"></span>Progreso diario real</div>
      <div class="progress-legend-item" data-dataset="1"><span class="legend-swatch legend-line"></span>Progreso acumulado real</div>
      <div class="progress-legend-item" data-dataset="2"><span class="legend-swatch legend-time"></span>Horas invertidas reales</div>
      <div class="progress-legend-item" data-dataset="3"><span class="legend-swatch legend-est"></span>Horas estimadas de trabajo</div>
      <div class="progress-legend-item" data-dataset="4"><span class="legend-swatch legend-cost"></span>Costos reales</div>
    </div>
    <div class="controls" style="margin:6px 0 12px;">
      <select class="input" id="progress-range-child" style="min-width:200px;">
        <option value="all" selected>Todo</option>
        <option value="today">Hoy</option>
        <option value="last3">Ultimos 3 dias</option>
        <option value="last7">Ultimos 7 dias</option>
        <option value="month">Mes actual</option>
        <option value="year">Ano actual</option>
      </select>
    </div>
    <div class="chart-scroll" id="progress-child-scroll">
      <canvas id="progress-curve-chart"></canvas>
    </div>
    <div class="chart-footer" style="justify-content:center; margin-top:8px;">
      <div class="chart-desc">Linea: porcentaje real acumulado. Barras: progreso diario (ponderado por estimacion).</div>
    </div>
  </div>

  <div class="panel graph-panel" id="real-hours-panel" data-graph-panel="real-hours">
    <div style="display:flex; align-items:center; justify-content:space-between; gap:8px; flex-wrap:wrap;">
      <div class="badge">Paquetes principales e independientes</div>
      <div class="badge" id="real-hours-total">Total: --</div>
    </div>
    <div class="chart-scroll-y">
      <canvas id="real-hours-main-chart"></canvas>
    </div>
    <div class="chart-footer" style="justify-content:center; margin-top:8px;">
      <div class="chart-desc">Horas reales acumuladas por paquete principal o independiente; barras apiladas por persona.</div>
    </div>
    <div style="display:flex; align-items:center; justify-content:space-between; gap:8px; flex-wrap:wrap; margin-top:10px;">
      <div class="badge">Subpaquetes</div>
      <div class="badge" id="real-hours-children-total">Total: --</div>
    </div>
    <div class="chart-scroll-y">
      <canvas id="real-hours-child-chart"></canvas>
    </div>
    <div class="chart-footer" style="justify-content:center; margin-top:8px;">
      <div class="chart-desc">Horas reales por subpaquete; barras apiladas por persona dentro de cada paquete.</div>
    </div>
  </div>

  <div class="panel graph-panel" id="role-performance-panel" data-graph-panel="role-performance">
    <div class="badge">Paquetes principales e independientes</div>
    <div class="chart-scroll-y">
      <canvas id="role-performance-main-chart"></canvas>
    </div>
    <div class="badge" style="margin-top:12px;">Subpaquetes</div>
    <div class="chart-scroll-y">
      <canvas id="role-performance-child-chart"></canvas>
    </div>
    <div class="chart-footer" style="justify-content:center; margin-top:8px;">
      <div class="chart-desc">Roles por tarea con % completado real (barra unica por tarea).</div>
    </div>
  </div>

  <div class="panel graph-panel" id="startcurve-panel" data-graph-panel="startcurve">
    <div class="badge">Paquetes principales e independientes</div>
    <div class="startcurve-legend" id="startcurve-main-legend"></div>
    <div class="chart-scroll" id="startcurve-main-scroll">
      <canvas id="startcurve-main-chart"></canvas>
    </div>
    <div id="startcurve-main-tooltip"></div>
    <div class="badge" style="margin-top:12px;">Subpaquetes</div>
    <div class="startcurve-legend" id="startcurve-child-legend"></div>
    <div class="chart-scroll" id="startcurve-child-scroll">
      <canvas id="startcurve-child-chart"></canvas>
    </div>
    <div id="startcurve-child-tooltip"></div>
    <div class="chart-footer" style="justify-content:center; margin-top:8px;">
      <div class="chart-desc">Linea de tiempo por paquete de trabajo (creacion -> vencimiento, puntos de inicio y ultima actualizacion)</div>
    </div>
    <div class="chart-actions">
      <span class="download-icon" id="download-startcurve-png" title="Descargar PNG" role="button" tabindex="0">
        <svg viewBox="0 0 20 20" aria-hidden="true">
          <path fill="currentColor" d="M2.66821 12.6663V12.5003C2.66821 12.1331 2.96598 11.8353 3.33325 11.8353C3.70052 11.8353 3.99829 12.1331 3.99829 12.5003V12.6663C3.99829 13.3772 3.9992 13.8707 4.03052 14.2542C4.0612 14.6298 4.11803 14.8413 4.19849 14.9993L4.2688 15.1263C4.44511 15.4137 4.69813 15.6481 5.00024 15.8021L5.13013 15.8577C5.2739 15.9092 5.46341 15.947 5.74536 15.97C6.12888 16.0014 6.62221 16.0013 7.33325 16.0013H12.6663C13.3771 16.0013 13.8707 16.0014 14.2542 15.97C14.6295 15.9394 14.8413 15.8825 14.9993 15.8021L15.1262 15.7308C15.4136 15.5545 15.6481 15.3014 15.802 14.9993L15.8577 14.8695C15.9091 14.7257 15.9469 14.536 15.97 14.2542C16.0013 13.8707 16.0012 13.3772 16.0012 12.6663V12.5003C16.0012 12.1332 16.2991 11.8355 16.6663 11.8353C17.0335 11.8353 17.3313 12.1331 17.3313 12.5003V12.6663C17.3313 13.3553 17.3319 13.9124 17.2952 14.3626C17.2624 14.7636 17.1974 15.1247 17.053 15.4613L16.9866 15.6038C16.7211 16.1248 16.3172 16.5605 15.8215 16.8646L15.6038 16.9866C15.227 17.1786 14.8206 17.2578 14.3625 17.2952C13.9123 17.332 13.3553 17.3314 12.6663 17.3314H7.33325C6.64416 17.3314 6.0872 17.332 5.63696 17.2952C5.23642 17.2625 4.87552 17.1982 4.53931 17.054L4.39673 16.9866C3.87561 16.7211 3.43911 16.3174 3.13501 15.8216L3.01294 15.6038C2.82097 15.2271 2.74177 14.8206 2.70435 14.3626C2.66758 13.9124 2.66821 13.3553 2.66821 12.6663ZM9.33521 3.33333C9.33521 2.96606 9.63298 2.66829 10.0002 2.66829C10.3674 2.66847 10.6653 2.96617 10.6653 3.33333V10.8939L12.8625 8.69661L12.967 8.61165C13.2252 8.44092 13.5766 8.46925 13.804 8.69661C14.0633 8.95628 14.0634 9.37744 13.804 9.63704L10.47 12.97C10.3453 13.0947 10.1765 13.1653 10.0002 13.1654C9.82388 13.1654 9.65425 13.0948 9.52954 12.97L6.19653 9.63704L6.11157 9.53255C5.94101 9.27441 5.96924 8.9239 6.19653 8.69661C6.42382 8.46932 6.77433 8.44109 7.03247 8.61165L7.13696 8.69661L9.33521 10.8949V3.33333Z"></path>
        </svg>
      </span>
    </div>
  </div>

  <div class="panel" id="kpi-panel">
    <div class="badge">Indicadores clave (reales)</div>
    <div class="kpi-grid">
      <div class="kpi-card">
        <div class="kpi-title">Avance real promedio</div>
        <select class="input kpi-select" id="kpi-progress-person-select" style="margin-bottom:6px;">
          <option value="">No hay involucrado</option>
        </select>
        <canvas class="kpi-canvas" id="kpi-progress"></canvas>
        <div class="kpi-sub" id="kpi-progress-sub">--</div>
      </div>
      <div class="kpi-card">
        <div class="kpi-title">Tareas vencidas</div>
        <select class="input kpi-select" id="kpi-overdue-person-select" style="margin-bottom:6px;">
          <option value="">No hay involucrado</option>
        </select>
        <canvas class="kpi-canvas" id="kpi-overdue"></canvas>
        <div class="kpi-sub" id="kpi-overdue-sub">--</div>
      </div>
      <div class="kpi-card">
        <div class="kpi-title">Prioridades</div>
        <select class="input kpi-select" id="kpi-priority-select" style="margin-bottom:6px;">
          <option value="">Todas las prioridades</option>
        </select>
        <canvas class="kpi-canvas" id="kpi-priority"></canvas>
        <div class="kpi-sub" id="kpi-priority-sub">--</div>
      </div>
      <div class="kpi-card">
        <div class="kpi-title">Fase de gestion de informacion</div>
        <select class="input kpi-select" id="kpi-ig-phase-select" style="margin-bottom:6px;">
          <option value="">Todas las fases</option>
        </select>
        <canvas class="kpi-canvas" id="kpi-ig-phase"></canvas>
        <div class="kpi-sub" id="kpi-ig-phase-sub">--</div>
      </div>
      <div class="kpi-card">
        <div class="kpi-title" id="kpi-role-title">Participacion por persona</div>
        <select class="input kpi-select" id="kpi-person-select" style="margin-bottom:6px;">
          <option value="">No hay involucrado</option>
        </select>
        <canvas class="kpi-canvas" id="kpi-assignee"></canvas>
        <div class="kpi-sub" id="kpi-assignee-sub">--</div>
      </div>
    </div>
  </div>


  <div class="panel">
    <div class="controls" style="margin-bottom:4px;">
      <div class="badge" id="wp-count">0 paquetes de trabajo</div>
    </div>
    <div id="table-panels"></div>
  </div>

  <script>
    (function() {
      // Registrar plugin de zoom/pan si está disponible
      if (window.Chart && (window.ChartZoom || window['chartjs-plugin-zoom'])) {
        const zoomPlugin = window.ChartZoom || window['chartjs-plugin-zoom'];
        if (zoomPlugin && window.Chart.register) {
          window.Chart.register(zoomPlugin);
        }
      }
      if (window.Chart && window.Chart.defaults) {
        window.Chart.defaults.devicePixelRatio = window.devicePixelRatio || 1;
      }

      // La IA debe reemplazar __DATA_JSON__ con JSON valido.
      const raw = `__DATA_JSON__`;
      const fallback = JSON.parse(String.raw`
{
  "_type": "Collection",
  "total": 17,
  "count": 17,
  "pageSize": 17,
  "offset": 1,
  "_embedded": {
    "elements": [
      {
        "derivedStartDate": "2025-12-21",
        "derivedDueDate": "2026-01-21",
        "spentTime": "PT16H",
        "laborCosts": "448,00 SOL",
        "materialCosts": "0,00 SOL",
        "overallCosts": "448,00 SOL",
        "_type": "WorkPackage",
        "id": 1492,
        "lockVersion": 33,
        "subject": "FASE 1 - Preparación y Configuración Inicial",
        "description": {
          "format": "markdown",
          "raw": "",
          "html": ""
        },
        "scheduleManually": false,
        "startDate": "2025-12-21",
        "dueDate": "2026-01-21",
        "estimatedTime": null,
        "derivedEstimatedTime": "P3DT6H",
        "derivedRemainingTime": "P2DT14H",
        "duration": "P32D",
        "ignoreNonWorkingDays": false,
        "percentageDone": null,
        "derivedPercentageDone": 21,
        "createdAt": "2025-12-19T23:22:29.852Z",
        "updatedAt": "2025-12-20T20:42:54.115Z",
        "readonly": false,
        "position": 1,
        "storyPoints": null,
        "customField1": null,
        "customField2": null,
        "customField7": null,
        "customField8": null,
        "_links": {
          "addAttachment": {
            "href": "/api/v3/work_packages/1492/attachments",
            "method": "post"
          },
          "fileLinks": {
            "href": "/api/v3/work_packages/1492/file_links"
          },
          "addFileLink": {
            "href": "/api/v3/work_packages/1492/file_links",
            "method": "post"
          },
          "update": {
            "href": "/api/v3/work_packages/1492/form",
            "method": "post"
          },
          "schema": {
            "href": "/api/v3/work_packages/schemas/686-3"
          },
          "updateImmediately": {
            "href": "/api/v3/work_packages/1492",
            "method": "patch"
          },
          "delete": {
            "href": "/api/v3/work_packages/1492",
            "method": "delete"
          },
          "logTime": {
            "href": "/api/v3/time_entries",
            "title": "Log time on work package 'FASE 1 - Preparación y Configuración Inicial'"
          },
          "move": {
            "href": "/work_packages/1492/move/new",
            "type": "text/html",
            "title": "Move work package 'FASE 1 - Preparación y Configuración Inicial'"
          },
          "copy": {
            "href": "/work_packages/1492/copy",
            "type": "text/html",
            "title": "Copy work package 'FASE 1 - Preparación y Configuración Inicial'"
          },
          "pdf": {
            "href": "/work_packages/1492.pdf",
            "type": "application/pdf",
            "title": "Export as PDF"
          },
          "generate_pdf": {
            "href": "/work_packages/1492/generate_pdf_dialog",
            "type": "text/vnd.turbo-stream.html",
            "title": "Generate PDF"
          },
          "atom": {
            "href": "/work_packages/1492.atom",
            "type": "application/rss+xml",
            "title": "Atom feed"
          },
          "availableRelationCandidates": {
            "href": "/api/v3/work_packages/1492/available_relation_candidates",
            "title": "Potential work packages to relate to"
          },
          "customFields": {
            "href": "/projects/arquitectura-3/settings/custom_fields",
            "type": "text/html",
            "title": "Custom fields"
          },
          "configureForm": {
            "href": "/types/3/edit?tab=form_configuration",
            "type": "text/html",
            "title": "Configure form"
          },
          "activities": {
            "href": "/api/v3/work_packages/1492/activities"
          },
          "availableWatchers": {
            "href": "/api/v3/work_packages/1492/available_watchers"
          },
          "relations": {
            "href": "/api/v3/work_packages/1492/relations"
          },
          "revisions": {
            "href": "/api/v3/work_packages/1492/revisions"
          },
          "watchers": {
            "href": "/api/v3/work_packages/1492/watchers"
          },
          "addWatcher": {
            "href": "/api/v3/work_packages/1492/watchers",
            "method": "post",
            "payload": {
              "user": {
                "href": "/api/v3/users/{user_id}"
              }
            },
            "templated": true
          },
          "removeWatcher": {
            "href": "/api/v3/work_packages/1492/watchers/{user_id}",
            "method": "delete",
            "templated": true
          },
          "addRelation": {
            "href": "/api/v3/work_packages/1492/relations",
            "method": "post",
            "title": "Add relation"
          },
          "addChild": {
            "href": "/api/v3/projects/arquitectura-3/work_packages",
            "method": "post",
            "title": "Add child of FASE 1 - Preparación y Configuración Inicial"
          },
          "changeParent": {
            "href": "/api/v3/work_packages/1492",
            "method": "patch",
            "title": "Change parent of FASE 1 - Preparación y Configuración Inicial"
          },
          "addComment": {
            "href": "/api/v3/work_packages/1492/activities",
            "method": "post",
            "title": "Add comment"
          },
          "previewMarkup": {
            "href": "/api/v3/render/markdown?context=/api/v3/work_packages/1492",
            "method": "post"
          },
          "timeEntries": {
            "href": "/api/v3/time_entries?filters=%5B%7B%22work_package_id%22%3A%7B%22operator%22%3A%22%3D%22%2C%22values%22%3A%5B%221492%22%5D%7D%7D%5D",
            "title": "Time entries"
          },
          "category": {
            "href": null
          },
          "type": {
            "href": "/api/v3/types/3",
            "title": "Fase"
          },
          "priority": {
            "href": "/api/v3/priorities/4",
            "title": "Baja"
          },
          "project": {
            "href": "/api/v3/projects/686",
            "title": "ARQUITECTURA"
          },
          "projectPhaseDefinition": {
            "href": null,
            "title": null
          },
          "status": {
            "href": "/api/v3/statuses/1",
            "title": "(WIP) Trabajo en progresos"
          },
          "author": {
            "href": "/api/v3/users/4",
            "title": "Francis Vin"
          },
          "responsible": {
            "href": "/api/v3/groups/454",
            "title": "Gerente de Proyecto BIM"
          },
          "assignee": {
            "href": "/api/v3/groups/16",
            "title": "BIM Manager"
          },
          "version": {
            "href": null
          },
          "budget": {
            "href": "/api/v3/budgets/8",
            "title": "Presupuesto total Arquitectura LOD 300"
          },
          "logCosts": {
            "href": "/work_packages/1492/cost_entries/new",
            "type": "text/html",
            "title": "Log costs on FASE 1 - Preparación y Configuración Inicial"
          },
          "showCosts": {
            "href": "/projects/686/cost_reports?fields%5B%5D=WorkPackageId&operators%5BWorkPackageId%5D=%3D&set_filter=1&values%5BWorkPackageId%5D=1492",
            "type": "text/html",
            "title": "Show cost entries"
          },
          "costsByType": {
            "href": "/api/v3/work_packages/1492/summarized_costs_by_type"
          },
          "github_pull_requests": {
            "href": "/api/v3/work_packages/1492/github_pull_requests",
            "title": "GitHub pull requests"
          },
          "gitlab_merge_requests": {
            "href": "/api/v3/work_packages/1492/gitlab_merge_requests",
            "title": "Gitlab merge requests"
          },
          "gitlab_issues": {
            "href": "/api/v3/work_packages/1492/gitlab_issues",
            "title": "Gitlab Issues"
          },
          "meetings": {
            "href": "/work_packages/1492/tabs/meetings",
            "title": "meetings"
          },
          "convertBCF": {
            "href": "/api/bcf/2.1/projects/arquitectura-3/topics",
            "title": "Convert to BCF",
            "payload": {
              "reference_links": [
                "/api/v3/work_packages/1492"
              ]
            },
            "method": "post"
          },
          "customField3": {
            "href": null,
            "title": null
          },
          "customField4": {
            "href": null,
            "title": null
          },
          "customField5": {
            "href": null,
            "title": null
          },
          "customField6": {
            "href": null,
            "title": null
          },
          "customField9": {
            "href": null,
            "title": null
          },
          "customField12": {
            "title": "PIM – Diseño",
            "href": "/api/v3/custom_options/193"
          },
          "customField73": {
            "href": null,
            "title": null
          },
          "customField74": {
            "href": null,
            "title": null
          },
          "self": {
            "href": "/api/v3/work_packages/1492",
            "title": "FASE 1 - Preparación y Configuración Inicial"
          },
          "unwatch": {
            "href": "/api/v3/work_packages/1492/watchers/4",
            "method": "delete"
          },
          "children": [
            {
              "href": "/api/v3/work_packages/1493",
              "title": "Revisión de EIR/AIR"
            },
            {
              "href": "/api/v3/work_packages/1498",
              "title": "Configuración de subproyectos/Worksets"
            },
            {
              "href": "/api/v3/work_packages/1494",
              "title": "Creación del BEP de Diseño"
            },
            {
              "href": "/api/v3/work_packages/1497",
              "title": "Configuración de niveles y rejillas"
            },
            {
              "href": "/api/v3/work_packages/1495",
              "title": "Configuración de template Revit"
            },
            {
              "href": "/api/v3/work_packages/1496",
              "title": "Configuración de parámetros compartidos"
            },
            {
              "href": "/api/v3/work_packages/1500",
              "title": "Hito 1 - Entrega de PEB y Plantillas"
            }
          ],
          "ancestors": [],
          "parent": {
            "href": null,
            "title": null
          },
          "customActions": []
        }
      },
      {
        "derivedStartDate": null,
        "derivedDueDate": null,
        "spentTime": "PT0S",
        "laborCosts": "0,00 SOL",
        "materialCosts": "0,00 SOL",
        "overallCosts": "0,00 SOL",
        "_type": "WorkPackage",
        "id": 1493,
        "lockVersion": 17,
        "subject": "Revisión de EIR/AIR",
        "description": {
          "format": "markdown",
          "raw": "",
          "html": ""
        },
        "scheduleManually": true,
        "startDate": "2025-12-21",
        "dueDate": "2025-12-23",
        "estimatedTime": "PT10H",
        "derivedEstimatedTime": null,
        "remainingTime": "PT8H",
        "derivedRemainingTime": null,
        "duration": "P3D",
        "ignoreNonWorkingDays": false,
        "percentageDone": 20,
        "derivedPercentageDone": null,
        "createdAt": "2025-12-19T23:23:00.164Z",
        "updatedAt": "2025-12-20T20:32:01.855Z",
        "readonly": false,
        "customField1": null,
        "customField2": null,
        "customField7": null,
        "customField8": null,
        "_links": {
          "addAttachment": {
            "href": "/api/v3/work_packages/1493/attachments",
            "method": "post"
          },
          "fileLinks": {
            "href": "/api/v3/work_packages/1493/file_links"
          },
          "addFileLink": {
            "href": "/api/v3/work_packages/1493/file_links",
            "method": "post"
          },
          "update": {
            "href": "/api/v3/work_packages/1493/form",
            "method": "post"
          },
          "schema": {
            "href": "/api/v3/work_packages/schemas/686-1"
          },
          "updateImmediately": {
            "href": "/api/v3/work_packages/1493",
            "method": "patch"
          },
          "delete": {
            "href": "/api/v3/work_packages/1493",
            "method": "delete"
          },
          "logTime": {
            "href": "/api/v3/time_entries",
            "title": "Log time on work package 'Revisión de EIR/AIR'"
          },
          "move": {
            "href": "/work_packages/1493/move/new",
            "type": "text/html",
            "title": "Move work package 'Revisión de EIR/AIR'"
          },
          "copy": {
            "href": "/work_packages/1493/copy",
            "type": "text/html",
            "title": "Copy work package 'Revisión de EIR/AIR'"
          },
          "pdf": {
            "href": "/work_packages/1493.pdf",
            "type": "application/pdf",
            "title": "Export as PDF"
          },
          "generate_pdf": {
            "href": "/work_packages/1493/generate_pdf_dialog",
            "type": "text/vnd.turbo-stream.html",
            "title": "Generate PDF"
          },
          "atom": {
            "href": "/work_packages/1493.atom",
            "type": "application/rss+xml",
            "title": "Atom feed"
          },
          "availableRelationCandidates": {
            "href": "/api/v3/work_packages/1493/available_relation_candidates",
            "title": "Potential work packages to relate to"
          },
          "customFields": {
            "href": "/projects/arquitectura-3/settings/custom_fields",
            "type": "text/html",
            "title": "Custom fields"
          },
          "configureForm": {
            "href": "/types/1/edit?tab=form_configuration",
            "type": "text/html",
            "title": "Configure form"
          },
          "activities": {
            "href": "/api/v3/work_packages/1493/activities"
          },
          "availableWatchers": {
            "href": "/api/v3/work_packages/1493/available_watchers"
          },
          "relations": {
            "href": "/api/v3/work_packages/1493/relations"
          },
          "revisions": {
            "href": "/api/v3/work_packages/1493/revisions"
          },
          "watchers": {
            "href": "/api/v3/work_packages/1493/watchers"
          },
          "addWatcher": {
            "href": "/api/v3/work_packages/1493/watchers",
            "method": "post",
            "payload": {
              "user": {
                "href": "/api/v3/users/{user_id}"
              }
            },
            "templated": true
          },
          "removeWatcher": {
            "href": "/api/v3/work_packages/1493/watchers/{user_id}",
            "method": "delete",
            "templated": true
          },
          "addRelation": {
            "href": "/api/v3/work_packages/1493/relations",
            "method": "post",
            "title": "Add relation"
          },
          "addChild": {
            "href": "/api/v3/projects/arquitectura-3/work_packages",
            "method": "post",
            "title": "Add child of Revisión de EIR/AIR"
          },
          "changeParent": {
            "href": "/api/v3/work_packages/1493",
            "method": "patch",
            "title": "Change parent of Revisión de EIR/AIR"
          },
          "addComment": {
            "href": "/api/v3/work_packages/1493/activities",
            "method": "post",
            "title": "Add comment"
          },
          "previewMarkup": {
            "href": "/api/v3/render/markdown?context=/api/v3/work_packages/1493",
            "method": "post"
          },
          "timeEntries": {
            "href": "/api/v3/time_entries?filters=%5B%7B%22work_package_id%22%3A%7B%22operator%22%3A%22%3D%22%2C%22values%22%3A%5B%221493%22%5D%7D%7D%5D",
            "title": "Time entries"
          },
          "category": {
            "href": null
          },
          "type": {
            "href": "/api/v3/types/1",
            "title": "Tarea"
          },
          "priority": {
            "href": "/api/v3/priorities/4",
            "title": "Baja"
          },
          "project": {
            "href": "/api/v3/projects/686",
            "title": "ARQUITECTURA"
          },
          "projectPhaseDefinition": {
            "href": null,
            "title": null
          },
          "status": {
            "href": "/api/v3/statuses/2",
            "title": "Compartido (Shared)"
          },
          "author": {
            "href": "/api/v3/users/4",
            "title": "Francis Vin"
          },
          "responsible": {
            "href": "/api/v3/groups/16",
            "title": "BIM Manager"
          },
          "assignee": {
            "href": "/api/v3/groups/6",
            "title": "Coordinador BIM"
          },
          "version": {
            "href": null
          },
          "budget": {
            "href": "/api/v3/budgets/8",
            "title": "Presupuesto total Arquitectura LOD 300"
          },
          "logCosts": {
            "href": "/work_packages/1493/cost_entries/new",
            "type": "text/html",
            "title": "Log costs on Revisión de EIR/AIR"
          },
          "showCosts": {
            "href": "/projects/686/cost_reports?fields%5B%5D=WorkPackageId&operators%5BWorkPackageId%5D=%3D&set_filter=1&values%5BWorkPackageId%5D=1493",
            "type": "text/html",
            "title": "Show cost entries"
          },
          "costsByType": {
            "href": "/api/v3/work_packages/1493/summarized_costs_by_type"
          },
          "github_pull_requests": {
            "href": "/api/v3/work_packages/1493/github_pull_requests",
            "title": "GitHub pull requests"
          },
          "gitlab_merge_requests": {
            "href": "/api/v3/work_packages/1493/gitlab_merge_requests",
            "title": "Gitlab merge requests"
          },
          "gitlab_issues": {
            "href": "/api/v3/work_packages/1493/gitlab_issues",
            "title": "Gitlab Issues"
          },
          "meetings": {
            "href": "/work_packages/1493/tabs/meetings",
            "title": "meetings"
          },
          "convertBCF": {
            "href": "/api/bcf/2.1/projects/arquitectura-3/topics",
            "title": "Convert to BCF",
            "payload": {
              "reference_links": [
                "/api/v3/work_packages/1493"
              ]
            },
            "method": "post"
          },
          "customField3": {
            "href": null,
            "title": null
          },
          "customField4": {
            "href": null,
            "title": null
          },
          "customField5": {
            "href": null,
            "title": null
          },
          "customField6": {
            "href": null,
            "title": null
          },
          "customField9": {
            "href": null,
            "title": null
          },
          "customField12": {
            "title": "PIM – Diseño",
            "href": "/api/v3/custom_options/193"
          },
          "customField11": {
            "href": null,
            "title": null
          },
          "self": {
            "href": "/api/v3/work_packages/1493",
            "title": "Revisión de EIR/AIR"
          },
          "unwatch": {
            "href": "/api/v3/work_packages/1493/watchers/4",
            "method": "delete"
          },
          "ancestors": [
            {
              "href": "/api/v3/work_packages/1492",
              "title": "FASE 1 - Preparación y Configuración Inicial"
            }
          ],
          "parent": {
            "href": "/api/v3/work_packages/1492",
            "title": "FASE 1 - Preparación y Configuración Inicial"
          },
          "customActions": []
        }
      },
      {
        "derivedStartDate": null,
        "derivedDueDate": null,
        "spentTime": "PT0S",
        "laborCosts": "0,00 SOL",
        "materialCosts": "0,00 SOL",
        "overallCosts": "0,00 SOL",
        "_type": "WorkPackage",
        "id": 1494,
        "lockVersion": 16,
        "subject": "Creación del BEP de Diseño",
        "description": {
          "format": "markdown",
          "raw": "",
          "html": ""
        },
        "scheduleManually": true,
        "startDate": "2025-12-23",
        "dueDate": "2025-12-29",
        "estimatedTime": "PT20H",
        "derivedEstimatedTime": null,
        "remainingTime": "PT10H",
        "derivedRemainingTime": null,
        "duration": "P7D",
        "ignoreNonWorkingDays": false,
        "percentageDone": 50,
        "derivedPercentageDone": null,
        "createdAt": "2025-12-19T23:24:04.999Z",
        "updatedAt": "2025-12-20T20:32:07.828Z",
        "readonly": true,
        "customField1": null,
        "customField2": null,
        "customField7": null,
        "customField8": null,
        "_links": {
          "fileLinks": {
            "href": "/api/v3/work_packages/1494/file_links"
          },
          "addFileLink": {
            "href": "/api/v3/work_packages/1494/file_links",
            "method": "post"
          },
          "update": {
            "href": "/api/v3/work_packages/1494/form",
            "method": "post"
          },
          "schema": {
            "href": "/api/v3/work_packages/schemas/686-1"
          },
          "updateImmediately": {
            "href": "/api/v3/work_packages/1494",
            "method": "patch"
          },
          "delete": {
            "href": "/api/v3/work_packages/1494",
            "method": "delete"
          },
          "logTime": {
            "href": "/api/v3/time_entries",
            "title": "Log time on work package 'Creación del BEP de Diseño'"
          },
          "move": {
            "href": "/work_packages/1494/move/new",
            "type": "text/html",
            "title": "Move work package 'Creación del BEP de Diseño'"
          },
          "copy": {
            "href": "/work_packages/1494/copy",
            "type": "text/html",
            "title": "Copy work package 'Creación del BEP de Diseño'"
          },
          "pdf": {
            "href": "/work_packages/1494.pdf",
            "type": "application/pdf",
            "title": "Export as PDF"
          },
          "generate_pdf": {
            "href": "/work_packages/1494/generate_pdf_dialog",
            "type": "text/vnd.turbo-stream.html",
            "title": "Generate PDF"
          },
          "atom": {
            "href": "/work_packages/1494.atom",
            "type": "application/rss+xml",
            "title": "Atom feed"
          },
          "availableRelationCandidates": {
            "href": "/api/v3/work_packages/1494/available_relation_candidates",
            "title": "Potential work packages to relate to"
          },
          "customFields": {
            "href": "/projects/arquitectura-3/settings/custom_fields",
            "type": "text/html",
            "title": "Custom fields"
          },
          "configureForm": {
            "href": "/types/1/edit?tab=form_configuration",
            "type": "text/html",
            "title": "Configure form"
          },
          "activities": {
            "href": "/api/v3/work_packages/1494/activities"
          },
          "availableWatchers": {
            "href": "/api/v3/work_packages/1494/available_watchers"
          },
          "relations": {
            "href": "/api/v3/work_packages/1494/relations"
          },
          "revisions": {
            "href": "/api/v3/work_packages/1494/revisions"
          },
          "watchers": {
            "href": "/api/v3/work_packages/1494/watchers"
          },
          "addWatcher": {
            "href": "/api/v3/work_packages/1494/watchers",
            "method": "post",
            "payload": {
              "user": {
                "href": "/api/v3/users/{user_id}"
              }
            },
            "templated": true
          },
          "removeWatcher": {
            "href": "/api/v3/work_packages/1494/watchers/{user_id}",
            "method": "delete",
            "templated": true
          },
          "addRelation": {
            "href": "/api/v3/work_packages/1494/relations",
            "method": "post",
            "title": "Add relation"
          },
          "addChild": {
            "href": "/api/v3/projects/arquitectura-3/work_packages",
            "method": "post",
            "title": "Add child of Creación del BEP de Diseño"
          },
          "changeParent": {
            "href": "/api/v3/work_packages/1494",
            "method": "patch",
            "title": "Change parent of Creación del BEP de Diseño"
          },
          "addComment": {
            "href": "/api/v3/work_packages/1494/activities",
            "method": "post",
            "title": "Add comment"
          },
          "previewMarkup": {
            "href": "/api/v3/render/markdown?context=/api/v3/work_packages/1494",
            "method": "post"
          },
          "timeEntries": {
            "href": "/api/v3/time_entries?filters=%5B%7B%22work_package_id%22%3A%7B%22operator%22%3A%22%3D%22%2C%22values%22%3A%5B%221494%22%5D%7D%7D%5D",
            "title": "Time entries"
          },
          "category": {
            "href": null
          },
          "type": {
            "href": "/api/v3/types/1",
            "title": "Tarea"
          },
          "priority": {
            "href": "/api/v3/priorities/4",
            "title": "Baja"
          },
          "project": {
            "href": "/api/v3/projects/686",
            "title": "ARQUITECTURA"
          },
          "projectPhaseDefinition": {
            "href": null,
            "title": null
          },
          "status": {
            "href": "/api/v3/statuses/3",
            "title": "Publicado (Published)"
          },
          "author": {
            "href": "/api/v3/users/4",
            "title": "Francis Vin"
          },
          "responsible": {
            "href": "/api/v3/groups/16",
            "title": "BIM Manager"
          },
          "assignee": {
            "href": "/api/v3/groups/6",
            "title": "Coordinador BIM"
          },
          "version": {
            "href": null
          },
          "budget": {
            "href": "/api/v3/budgets/8",
            "title": "Presupuesto total Arquitectura LOD 300"
          },
          "logCosts": {
            "href": "/work_packages/1494/cost_entries/new",
            "type": "text/html",
            "title": "Log costs on Creación del BEP de Diseño"
          },
          "showCosts": {
            "href": "/projects/686/cost_reports?fields%5B%5D=WorkPackageId&operators%5BWorkPackageId%5D=%3D&set_filter=1&values%5BWorkPackageId%5D=1494",
            "type": "text/html",
            "title": "Show cost entries"
          },
          "costsByType": {
            "href": "/api/v3/work_packages/1494/summarized_costs_by_type"
          },
          "github_pull_requests": {
            "href": "/api/v3/work_packages/1494/github_pull_requests",
            "title": "GitHub pull requests"
          },
          "gitlab_merge_requests": {
            "href": "/api/v3/work_packages/1494/gitlab_merge_requests",
            "title": "Gitlab merge requests"
          },
          "gitlab_issues": {
            "href": "/api/v3/work_packages/1494/gitlab_issues",
            "title": "Gitlab Issues"
          },
          "meetings": {
            "href": "/work_packages/1494/tabs/meetings",
            "title": "meetings"
          },
          "convertBCF": {
            "href": "/api/bcf/2.1/projects/arquitectura-3/topics",
            "title": "Convert to BCF",
            "payload": {
              "reference_links": [
                "/api/v3/work_packages/1494"
              ]
            },
            "method": "post"
          },
          "customField11": {
            "href": null,
            "title": null
          },
          "customField3": {
            "href": null,
            "title": null
          },
          "customField4": {
            "href": null,
            "title": null
          },
          "customField5": {
            "href": null,
            "title": null
          },
          "customField6": {
            "href": null,
            "title": null
          },
          "customField9": {
            "href": null,
            "title": null
          },
          "customField12": {
            "title": "PIM – Diseño",
            "href": "/api/v3/custom_options/193"
          },
          "self": {
            "href": "/api/v3/work_packages/1494",
            "title": "Creación del BEP de Diseño"
          },
          "unwatch": {
            "href": "/api/v3/work_packages/1494/watchers/4",
            "method": "delete"
          },
          "ancestors": [
            {
              "href": "/api/v3/work_packages/1492",
              "title": "FASE 1 - Preparación y Configuración Inicial"
            }
          ],
          "parent": {
            "href": "/api/v3/work_packages/1492",
            "title": "FASE 1 - Preparación y Configuración Inicial"
          },
          "customActions": []
        }
      },
      {
        "derivedStartDate": null,
        "derivedDueDate": null,
        "spentTime": "PT3H",
        "laborCosts": "84,00 SOL",
        "materialCosts": "0,00 SOL",
        "overallCosts": "84,00 SOL",
        "_type": "WorkPackage",
        "id": 1495,
        "lockVersion": 15,
        "subject": "Configuración de template Revit",
        "description": {
          "format": "markdown",
          "raw": "",
          "html": ""
        },
        "scheduleManually": true,
        "startDate": "2026-01-02",
        "dueDate": "2026-01-21",
        "estimatedTime": "PT16H",
        "derivedEstimatedTime": null,
        "remainingTime": "PT16H",
        "derivedRemainingTime": null,
        "duration": "P20D",
        "ignoreNonWorkingDays": false,
        "percentageDone": 0,
        "derivedPercentageDone": null,
        "createdAt": "2025-12-19T23:24:15.471Z",
        "updatedAt": "2025-12-20T20:32:16.017Z",
        "readonly": true,
        "customField1": null,
        "customField2": null,
        "customField7": null,
        "customField8": null,
        "_links": {
          "fileLinks": {
            "href": "/api/v3/work_packages/1495/file_links"
          },
          "addFileLink": {
            "href": "/api/v3/work_packages/1495/file_links",
            "method": "post"
          },
          "update": {
            "href": "/api/v3/work_packages/1495/form",
            "method": "post"
          },
          "schema": {
            "href": "/api/v3/work_packages/schemas/686-1"
          },
          "updateImmediately": {
            "href": "/api/v3/work_packages/1495",
            "method": "patch"
          },
          "delete": {
            "href": "/api/v3/work_packages/1495",
            "method": "delete"
          },
          "logTime": {
            "href": "/api/v3/time_entries",
            "title": "Log time on work package 'Configuración de template Revit'"
          },
          "move": {
            "href": "/work_packages/1495/move/new",
            "type": "text/html",
            "title": "Move work package 'Configuración de template Revit'"
          },
          "copy": {
            "href": "/work_packages/1495/copy",
            "type": "text/html",
            "title": "Copy work package 'Configuración de template Revit'"
          },
          "pdf": {
            "href": "/work_packages/1495.pdf",
            "type": "application/pdf",
            "title": "Export as PDF"
          },
          "generate_pdf": {
            "href": "/work_packages/1495/generate_pdf_dialog",
            "type": "text/vnd.turbo-stream.html",
            "title": "Generate PDF"
          },
          "atom": {
            "href": "/work_packages/1495.atom",
            "type": "application/rss+xml",
            "title": "Atom feed"
          },
          "availableRelationCandidates": {
            "href": "/api/v3/work_packages/1495/available_relation_candidates",
            "title": "Potential work packages to relate to"
          },
          "customFields": {
            "href": "/projects/arquitectura-3/settings/custom_fields",
            "type": "text/html",
            "title": "Custom fields"
          },
          "configureForm": {
            "href": "/types/1/edit?tab=form_configuration",
            "type": "text/html",
            "title": "Configure form"
          },
          "activities": {
            "href": "/api/v3/work_packages/1495/activities"
          },
          "availableWatchers": {
            "href": "/api/v3/work_packages/1495/available_watchers"
          },
          "relations": {
            "href": "/api/v3/work_packages/1495/relations"
          },
          "revisions": {
            "href": "/api/v3/work_packages/1495/revisions"
          },
          "watchers": {
            "href": "/api/v3/work_packages/1495/watchers"
          },
          "addWatcher": {
            "href": "/api/v3/work_packages/1495/watchers",
            "method": "post",
            "payload": {
              "user": {
                "href": "/api/v3/users/{user_id}"
              }
            },
            "templated": true
          },
          "removeWatcher": {
            "href": "/api/v3/work_packages/1495/watchers/{user_id}",
            "method": "delete",
            "templated": true
          },
          "addRelation": {
            "href": "/api/v3/work_packages/1495/relations",
            "method": "post",
            "title": "Add relation"
          },
          "addChild": {
            "href": "/api/v3/projects/arquitectura-3/work_packages",
            "method": "post",
            "title": "Add child of Configuración de template Revit"
          },
          "changeParent": {
            "href": "/api/v3/work_packages/1495",
            "method": "patch",
            "title": "Change parent of Configuración de template Revit"
          },
          "addComment": {
            "href": "/api/v3/work_packages/1495/activities",
            "method": "post",
            "title": "Add comment"
          },
          "previewMarkup": {
            "href": "/api/v3/render/markdown?context=/api/v3/work_packages/1495",
            "method": "post"
          },
          "timeEntries": {
            "href": "/api/v3/time_entries?filters=%5B%7B%22work_package_id%22%3A%7B%22operator%22%3A%22%3D%22%2C%22values%22%3A%5B%221495%22%5D%7D%7D%5D",
            "title": "Time entries"
          },
          "category": {
            "href": null
          },
          "type": {
            "href": "/api/v3/types/1",
            "title": "Tarea"
          },
          "priority": {
            "href": "/api/v3/priorities/4",
            "title": "Baja"
          },
          "project": {
            "href": "/api/v3/projects/686",
            "title": "ARQUITECTURA"
          },
          "projectPhaseDefinition": {
            "href": null,
            "title": null
          },
          "status": {
            "href": "/api/v3/statuses/4",
            "title": "Archivo"
          },
          "author": {
            "href": "/api/v3/users/4",
            "title": "Francis Vin"
          },
          "responsible": {
            "href": "/api/v3/groups/6",
            "title": "Coordinador BIM"
          },
          "assignee": {
            "href": "/api/v3/users/599",
            "title": "Modelador bim"
          },
          "version": {
            "href": null
          },
          "budget": {
            "href": "/api/v3/budgets/8",
            "title": "Presupuesto total Arquitectura LOD 300"
          },
          "logCosts": {
            "href": "/work_packages/1495/cost_entries/new",
            "type": "text/html",
            "title": "Log costs on Configuración de template Revit"
          },
          "showCosts": {
            "href": "/projects/686/cost_reports?fields%5B%5D=WorkPackageId&operators%5BWorkPackageId%5D=%3D&set_filter=1&values%5BWorkPackageId%5D=1495",
            "type": "text/html",
            "title": "Show cost entries"
          },
          "costsByType": {
            "href": "/api/v3/work_packages/1495/summarized_costs_by_type"
          },
          "github_pull_requests": {
            "href": "/api/v3/work_packages/1495/github_pull_requests",
            "title": "GitHub pull requests"
          },
          "gitlab_merge_requests": {
            "href": "/api/v3/work_packages/1495/gitlab_merge_requests",
            "title": "Gitlab merge requests"
          },
          "gitlab_issues": {
            "href": "/api/v3/work_packages/1495/gitlab_issues",
            "title": "Gitlab Issues"
          },
          "meetings": {
            "href": "/work_packages/1495/tabs/meetings",
            "title": "meetings"
          },
          "convertBCF": {
            "href": "/api/bcf/2.1/projects/arquitectura-3/topics",
            "title": "Convert to BCF",
            "payload": {
              "reference_links": [
                "/api/v3/work_packages/1495"
              ]
            },
            "method": "post"
          },
          "customField11": {
            "href": null,
            "title": null
          },
          "customField3": {
            "href": null,
            "title": null
          },
          "customField4": {
            "href": null,
            "title": null
          },
          "customField5": {
            "href": null,
            "title": null
          },
          "customField6": {
            "href": null,
            "title": null
          },
          "customField9": {
            "href": null,
            "title": null
          },
          "customField12": {
            "title": "PIM – Diseño",
            "href": "/api/v3/custom_options/193"
          },
          "self": {
            "href": "/api/v3/work_packages/1495",
            "title": "Configuración de template Revit"
          },
          "unwatch": {
            "href": "/api/v3/work_packages/1495/watchers/4",
            "method": "delete"
          },
          "ancestors": [
            {
              "href": "/api/v3/work_packages/1492",
              "title": "FASE 1 - Preparación y Configuración Inicial"
            }
          ],
          "parent": {
            "href": "/api/v3/work_packages/1492",
            "title": "FASE 1 - Preparación y Configuración Inicial"
          },
          "customActions": []
        }
      },
      {
        "derivedStartDate": null,
        "derivedDueDate": null,
        "spentTime": "PT6H",
        "laborCosts": "168,00 SOL",
        "materialCosts": "0,00 SOL",
        "overallCosts": "168,00 SOL",
        "_type": "WorkPackage",
        "id": 1496,
        "lockVersion": 14,
        "subject": "Configuración de parámetros compartidos",
        "description": {
          "format": "markdown",
          "raw": "",
          "html": ""
        },
        "scheduleManually": true,
        "startDate": "2025-12-29",
        "dueDate": "2026-01-17",
        "estimatedTime": "PT12H",
        "derivedEstimatedTime": null,
        "remainingTime": "PT12H",
        "derivedRemainingTime": null,
        "duration": "P20D",
        "ignoreNonWorkingDays": false,
        "percentageDone": 0,
        "derivedPercentageDone": null,
        "createdAt": "2025-12-19T23:24:24.160Z",
        "updatedAt": "2025-12-20T03:15:59.679Z",
        "readonly": false,
        "customField1": null,
        "customField2": null,
        "customField7": null,
        "customField8": null,
        "_links": {
          "addAttachment": {
            "href": "/api/v3/work_packages/1496/attachments",
            "method": "post"
          },
          "fileLinks": {
            "href": "/api/v3/work_packages/1496/file_links"
          },
          "addFileLink": {
            "href": "/api/v3/work_packages/1496/file_links",
            "method": "post"
          },
          "update": {
            "href": "/api/v3/work_packages/1496/form",
            "method": "post"
          },
          "schema": {
            "href": "/api/v3/work_packages/schemas/686-1"
          },
          "updateImmediately": {
            "href": "/api/v3/work_packages/1496",
            "method": "patch"
          },
          "delete": {
            "href": "/api/v3/work_packages/1496",
            "method": "delete"
          },
          "logTime": {
            "href": "/api/v3/time_entries",
            "title": "Log time on work package 'Configuración de parámetros compartidos'"
          },
          "move": {
            "href": "/work_packages/1496/move/new",
            "type": "text/html",
            "title": "Move work package 'Configuración de parámetros compartidos'"
          },
          "copy": {
            "href": "/work_packages/1496/copy",
            "type": "text/html",
            "title": "Copy work package 'Configuración de parámetros compartidos'"
          },
          "pdf": {
            "href": "/work_packages/1496.pdf",
            "type": "application/pdf",
            "title": "Export as PDF"
          },
          "generate_pdf": {
            "href": "/work_packages/1496/generate_pdf_dialog",
            "type": "text/vnd.turbo-stream.html",
            "title": "Generate PDF"
          },
          "atom": {
            "href": "/work_packages/1496.atom",
            "type": "application/rss+xml",
            "title": "Atom feed"
          },
          "availableRelationCandidates": {
            "href": "/api/v3/work_packages/1496/available_relation_candidates",
            "title": "Potential work packages to relate to"
          },
          "customFields": {
            "href": "/projects/arquitectura-3/settings/custom_fields",
            "type": "text/html",
            "title": "Custom fields"
          },
          "configureForm": {
            "href": "/types/1/edit?tab=form_configuration",
            "type": "text/html",
            "title": "Configure form"
          },
          "activities": {
            "href": "/api/v3/work_packages/1496/activities"
          },
          "availableWatchers": {
            "href": "/api/v3/work_packages/1496/available_watchers"
          },
          "relations": {
            "href": "/api/v3/work_packages/1496/relations"
          },
          "revisions": {
            "href": "/api/v3/work_packages/1496/revisions"
          },
          "watchers": {
            "href": "/api/v3/work_packages/1496/watchers"
          },
          "addWatcher": {
            "href": "/api/v3/work_packages/1496/watchers",
            "method": "post",
            "payload": {
              "user": {
                "href": "/api/v3/users/{user_id}"
              }
            },
            "templated": true
          },
          "removeWatcher": {
            "href": "/api/v3/work_packages/1496/watchers/{user_id}",
            "method": "delete",
            "templated": true
          },
          "addRelation": {
            "href": "/api/v3/work_packages/1496/relations",
            "method": "post",
            "title": "Add relation"
          },
          "addChild": {
            "href": "/api/v3/projects/arquitectura-3/work_packages",
            "method": "post",
            "title": "Add child of Configuración de parámetros compartidos"
          },
          "changeParent": {
            "href": "/api/v3/work_packages/1496",
            "method": "patch",
            "title": "Change parent of Configuración de parámetros compartidos"
          },
          "addComment": {
            "href": "/api/v3/work_packages/1496/activities",
            "method": "post",
            "title": "Add comment"
          },
          "previewMarkup": {
            "href": "/api/v3/render/markdown?context=/api/v3/work_packages/1496",
            "method": "post"
          },
          "timeEntries": {
            "href": "/api/v3/time_entries?filters=%5B%7B%22work_package_id%22%3A%7B%22operator%22%3A%22%3D%22%2C%22values%22%3A%5B%221496%22%5D%7D%7D%5D",
            "title": "Time entries"
          },
          "category": {
            "href": null
          },
          "type": {
            "href": "/api/v3/types/1",
            "title": "Tarea"
          },
          "priority": {
            "href": "/api/v3/priorities/4",
            "title": "Baja"
          },
          "project": {
            "href": "/api/v3/projects/686",
            "title": "ARQUITECTURA"
          },
          "projectPhaseDefinition": {
            "href": null,
            "title": null
          },
          "status": {
            "href": "/api/v3/statuses/1",
            "title": "(WIP) Trabajo en progresos"
          },
          "author": {
            "href": "/api/v3/users/4",
            "title": "Francis Vin"
          },
          "responsible": {
            "href": "/api/v3/groups/6",
            "title": "Coordinador BIM"
          },
          "assignee": {
            "href": "/api/v3/users/599",
            "title": "Modelador bim"
          },
          "version": {
            "href": null
          },
          "budget": {
            "href": "/api/v3/budgets/8",
            "title": "Presupuesto total Arquitectura LOD 300"
          },
          "logCosts": {
            "href": "/work_packages/1496/cost_entries/new",
            "type": "text/html",
            "title": "Log costs on Configuración de parámetros compartidos"
          },
          "showCosts": {
            "href": "/projects/686/cost_reports?fields%5B%5D=WorkPackageId&operators%5BWorkPackageId%5D=%3D&set_filter=1&values%5BWorkPackageId%5D=1496",
            "type": "text/html",
            "title": "Show cost entries"
          },
          "costsByType": {
            "href": "/api/v3/work_packages/1496/summarized_costs_by_type"
          },
          "github_pull_requests": {
            "href": "/api/v3/work_packages/1496/github_pull_requests",
            "title": "GitHub pull requests"
          },
          "gitlab_merge_requests": {
            "href": "/api/v3/work_packages/1496/gitlab_merge_requests",
            "title": "Gitlab merge requests"
          },
          "gitlab_issues": {
            "href": "/api/v3/work_packages/1496/gitlab_issues",
            "title": "Gitlab Issues"
          },
          "meetings": {
            "href": "/work_packages/1496/tabs/meetings",
            "title": "meetings"
          },
          "convertBCF": {
            "href": "/api/bcf/2.1/projects/arquitectura-3/topics",
            "title": "Convert to BCF",
            "payload": {
              "reference_links": [
                "/api/v3/work_packages/1496"
              ]
            },
            "method": "post"
          },
          "customField3": {
            "href": null,
            "title": null
          },
          "customField4": {
            "href": null,
            "title": null
          },
          "customField5": {
            "href": null,
            "title": null
          },
          "customField6": {
            "href": null,
            "title": null
          },
          "customField9": {
            "href": null,
            "title": null
          },
          "customField12": {
            "title": "PIM – Diseño",
            "href": "/api/v3/custom_options/193"
          },
          "customField11": {
            "href": null,
            "title": null
          },
          "self": {
            "href": "/api/v3/work_packages/1496",
            "title": "Configuración de parámetros compartidos"
          },
          "unwatch": {
            "href": "/api/v3/work_packages/1496/watchers/4",
            "method": "delete"
          },
          "ancestors": [
            {
              "href": "/api/v3/work_packages/1492",
              "title": "FASE 1 - Preparación y Configuración Inicial"
            }
          ],
          "parent": {
            "href": "/api/v3/work_packages/1492",
            "title": "FASE 1 - Preparación y Configuración Inicial"
          },
          "customActions": []
        }
      },
      {
        "derivedStartDate": null,
        "derivedDueDate": null,
        "spentTime": "PT3H",
        "laborCosts": "84,00 SOL",
        "materialCosts": "0,00 SOL",
        "overallCosts": "84,00 SOL",
        "_type": "WorkPackage",
        "id": 1497,
        "lockVersion": 16,
        "subject": "Configuración de niveles y rejillas",
        "description": {
          "format": "markdown",
          "raw": "",
          "html": ""
        },
        "scheduleManually": true,
        "startDate": "2025-12-29",
        "dueDate": "2026-01-13",
        "estimatedTime": "PT12H",
        "derivedEstimatedTime": null,
        "remainingTime": "PT12H",
        "derivedRemainingTime": null,
        "duration": "P16D",
        "ignoreNonWorkingDays": false,
        "percentageDone": 0,
        "derivedPercentageDone": null,
        "createdAt": "2025-12-19T23:24:31.705Z",
        "updatedAt": "2025-12-20T03:15:51.222Z",
        "readonly": false,
        "customField1": null,
        "customField2": null,
        "customField7": null,
        "customField8": null,
        "_links": {
          "addAttachment": {
            "href": "/api/v3/work_packages/1497/attachments",
            "method": "post"
          },
          "fileLinks": {
            "href": "/api/v3/work_packages/1497/file_links"
          },
          "addFileLink": {
            "href": "/api/v3/work_packages/1497/file_links",
            "method": "post"
          },
          "update": {
            "href": "/api/v3/work_packages/1497/form",
            "method": "post"
          },
          "schema": {
            "href": "/api/v3/work_packages/schemas/686-1"
          },
          "updateImmediately": {
            "href": "/api/v3/work_packages/1497",
            "method": "patch"
          },
          "delete": {
            "href": "/api/v3/work_packages/1497",
            "method": "delete"
          },
          "logTime": {
            "href": "/api/v3/time_entries",
            "title": "Log time on work package 'Configuración de niveles y rejillas'"
          },
          "move": {
            "href": "/work_packages/1497/move/new",
            "type": "text/html",
            "title": "Move work package 'Configuración de niveles y rejillas'"
          },
          "copy": {
            "href": "/work_packages/1497/copy",
            "type": "text/html",
            "title": "Copy work package 'Configuración de niveles y rejillas'"
          },
          "pdf": {
            "href": "/work_packages/1497.pdf",
            "type": "application/pdf",
            "title": "Export as PDF"
          },
          "generate_pdf": {
            "href": "/work_packages/1497/generate_pdf_dialog",
            "type": "text/vnd.turbo-stream.html",
            "title": "Generate PDF"
          },
          "atom": {
            "href": "/work_packages/1497.atom",
            "type": "application/rss+xml",
            "title": "Atom feed"
          },
          "availableRelationCandidates": {
            "href": "/api/v3/work_packages/1497/available_relation_candidates",
            "title": "Potential work packages to relate to"
          },
          "customFields": {
            "href": "/projects/arquitectura-3/settings/custom_fields",
            "type": "text/html",
            "title": "Custom fields"
          },
          "configureForm": {
            "href": "/types/1/edit?tab=form_configuration",
            "type": "text/html",
            "title": "Configure form"
          },
          "activities": {
            "href": "/api/v3/work_packages/1497/activities"
          },
          "availableWatchers": {
            "href": "/api/v3/work_packages/1497/available_watchers"
          },
          "relations": {
            "href": "/api/v3/work_packages/1497/relations"
          },
          "revisions": {
            "href": "/api/v3/work_packages/1497/revisions"
          },
          "watchers": {
            "href": "/api/v3/work_packages/1497/watchers"
          },
          "addWatcher": {
            "href": "/api/v3/work_packages/1497/watchers",
            "method": "post",
            "payload": {
              "user": {
                "href": "/api/v3/users/{user_id}"
              }
            },
            "templated": true
          },
          "removeWatcher": {
            "href": "/api/v3/work_packages/1497/watchers/{user_id}",
            "method": "delete",
            "templated": true
          },
          "addRelation": {
            "href": "/api/v3/work_packages/1497/relations",
            "method": "post",
            "title": "Add relation"
          },
          "addChild": {
            "href": "/api/v3/projects/arquitectura-3/work_packages",
            "method": "post",
            "title": "Add child of Configuración de niveles y rejillas"
          },
          "changeParent": {
            "href": "/api/v3/work_packages/1497",
            "method": "patch",
            "title": "Change parent of Configuración de niveles y rejillas"
          },
          "addComment": {
            "href": "/api/v3/work_packages/1497/activities",
            "method": "post",
            "title": "Add comment"
          },
          "previewMarkup": {
            "href": "/api/v3/render/markdown?context=/api/v3/work_packages/1497",
            "method": "post"
          },
          "timeEntries": {
            "href": "/api/v3/time_entries?filters=%5B%7B%22work_package_id%22%3A%7B%22operator%22%3A%22%3D%22%2C%22values%22%3A%5B%221497%22%5D%7D%7D%5D",
            "title": "Time entries"
          },
          "category": {
            "href": null
          },
          "type": {
            "href": "/api/v3/types/1",
            "title": "Tarea"
          },
          "priority": {
            "href": "/api/v3/priorities/4",
            "title": "Baja"
          },
          "project": {
            "href": "/api/v3/projects/686",
            "title": "ARQUITECTURA"
          },
          "projectPhaseDefinition": {
            "href": null,
            "title": null
          },
          "status": {
            "href": "/api/v3/statuses/1",
            "title": "(WIP) Trabajo en progresos"
          },
          "author": {
            "href": "/api/v3/users/4",
            "title": "Francis Vin"
          },
          "responsible": {
            "href": "/api/v3/groups/6",
            "title": "Coordinador BIM"
          },
          "assignee": {
            "href": "/api/v3/users/599",
            "title": "Modelador bim"
          },
          "version": {
            "href": null
          },
          "budget": {
            "href": "/api/v3/budgets/8",
            "title": "Presupuesto total Arquitectura LOD 300"
          },
          "logCosts": {
            "href": "/work_packages/1497/cost_entries/new",
            "type": "text/html",
            "title": "Log costs on Configuración de niveles y rejillas"
          },
          "showCosts": {
            "href": "/projects/686/cost_reports?fields%5B%5D=WorkPackageId&operators%5BWorkPackageId%5D=%3D&set_filter=1&values%5BWorkPackageId%5D=1497",
            "type": "text/html",
            "title": "Show cost entries"
          },
          "costsByType": {
            "href": "/api/v3/work_packages/1497/summarized_costs_by_type"
          },
          "github_pull_requests": {
            "href": "/api/v3/work_packages/1497/github_pull_requests",
            "title": "GitHub pull requests"
          },
          "gitlab_merge_requests": {
            "href": "/api/v3/work_packages/1497/gitlab_merge_requests",
            "title": "Gitlab merge requests"
          },
          "gitlab_issues": {
            "href": "/api/v3/work_packages/1497/gitlab_issues",
            "title": "Gitlab Issues"
          },
          "meetings": {
            "href": "/work_packages/1497/tabs/meetings",
            "title": "meetings"
          },
          "convertBCF": {
            "href": "/api/bcf/2.1/projects/arquitectura-3/topics",
            "title": "Convert to BCF",
            "payload": {
              "reference_links": [
                "/api/v3/work_packages/1497"
              ]
            },
            "method": "post"
          },
          "customField3": {
            "href": null,
            "title": null
          },
          "customField4": {
            "href": null,
            "title": null
          },
          "customField5": {
            "href": null,
            "title": null
          },
          "customField6": {
            "href": null,
            "title": null
          },
          "customField9": {
            "href": null,
            "title": null
          },
          "customField12": {
            "title": "PIM – Diseño",
            "href": "/api/v3/custom_options/193"
          },
          "customField11": {
            "href": null,
            "title": null
          },
          "self": {
            "href": "/api/v3/work_packages/1497",
            "title": "Configuración de niveles y rejillas"
          },
          "unwatch": {
            "href": "/api/v3/work_packages/1497/watchers/4",
            "method": "delete"
          },
          "ancestors": [
            {
              "href": "/api/v3/work_packages/1492",
              "title": "FASE 1 - Preparación y Configuración Inicial"
            }
          ],
          "parent": {
            "href": "/api/v3/work_packages/1492",
            "title": "FASE 1 - Preparación y Configuración Inicial"
          },
          "customActions": []
        }
      },
      {
        "derivedStartDate": null,
        "derivedDueDate": null,
        "spentTime": "PT4H",
        "laborCosts": "112,00 SOL",
        "materialCosts": "0,00 SOL",
        "overallCosts": "112,00 SOL",
        "_type": "WorkPackage",
        "id": 1498,
        "lockVersion": 12,
        "subject": "Configuración de subproyectos/Worksets",
        "description": {
          "format": "markdown",
          "raw": "",
          "html": ""
        },
        "scheduleManually": true,
        "startDate": "2026-01-05",
        "dueDate": "2026-01-21",
        "estimatedTime": "PT8H",
        "derivedEstimatedTime": null,
        "remainingTime": "PT4H",
        "derivedRemainingTime": null,
        "duration": "P17D",
        "ignoreNonWorkingDays": false,
        "percentageDone": 50,
        "derivedPercentageDone": null,
        "createdAt": "2025-12-19T23:24:38.247Z",
        "updatedAt": "2025-12-20T03:16:26.756Z",
        "readonly": false,
        "customField1": null,
        "customField2": null,
        "customField7": null,
        "customField8": null,
        "_links": {
          "addAttachment": {
            "href": "/api/v3/work_packages/1498/attachments",
            "method": "post"
          },
          "fileLinks": {
            "href": "/api/v3/work_packages/1498/file_links"
          },
          "addFileLink": {
            "href": "/api/v3/work_packages/1498/file_links",
            "method": "post"
          },
          "update": {
            "href": "/api/v3/work_packages/1498/form",
            "method": "post"
          },
          "schema": {
            "href": "/api/v3/work_packages/schemas/686-1"
          },
          "updateImmediately": {
            "href": "/api/v3/work_packages/1498",
            "method": "patch"
          },
          "delete": {
            "href": "/api/v3/work_packages/1498",
            "method": "delete"
          },
          "logTime": {
            "href": "/api/v3/time_entries",
            "title": "Log time on work package 'Configuración de subproyectos/Worksets'"
          },
          "move": {
            "href": "/work_packages/1498/move/new",
            "type": "text/html",
            "title": "Move work package 'Configuración de subproyectos/Worksets'"
          },
          "copy": {
            "href": "/work_packages/1498/copy",
            "type": "text/html",
            "title": "Copy work package 'Configuración de subproyectos/Worksets'"
          },
          "pdf": {
            "href": "/work_packages/1498.pdf",
            "type": "application/pdf",
            "title": "Export as PDF"
          },
          "generate_pdf": {
            "href": "/work_packages/1498/generate_pdf_dialog",
            "type": "text/vnd.turbo-stream.html",
            "title": "Generate PDF"
          },
          "atom": {
            "href": "/work_packages/1498.atom",
            "type": "application/rss+xml",
            "title": "Atom feed"
          },
          "availableRelationCandidates": {
            "href": "/api/v3/work_packages/1498/available_relation_candidates",
            "title": "Potential work packages to relate to"
          },
          "customFields": {
            "href": "/projects/arquitectura-3/settings/custom_fields",
            "type": "text/html",
            "title": "Custom fields"
          },
          "configureForm": {
            "href": "/types/1/edit?tab=form_configuration",
            "type": "text/html",
            "title": "Configure form"
          },
          "activities": {
            "href": "/api/v3/work_packages/1498/activities"
          },
          "availableWatchers": {
            "href": "/api/v3/work_packages/1498/available_watchers"
          },
          "relations": {
            "href": "/api/v3/work_packages/1498/relations"
          },
          "revisions": {
            "href": "/api/v3/work_packages/1498/revisions"
          },
          "watchers": {
            "href": "/api/v3/work_packages/1498/watchers"
          },
          "addWatcher": {
            "href": "/api/v3/work_packages/1498/watchers",
            "method": "post",
            "payload": {
              "user": {
                "href": "/api/v3/users/{user_id}"
              }
            },
            "templated": true
          },
          "removeWatcher": {
            "href": "/api/v3/work_packages/1498/watchers/{user_id}",
            "method": "delete",
            "templated": true
          },
          "addRelation": {
            "href": "/api/v3/work_packages/1498/relations",
            "method": "post",
            "title": "Add relation"
          },
          "addChild": {
            "href": "/api/v3/projects/arquitectura-3/work_packages",
            "method": "post",
            "title": "Add child of Configuración de subproyectos/Worksets"
          },
          "changeParent": {
            "href": "/api/v3/work_packages/1498",
            "method": "patch",
            "title": "Change parent of Configuración de subproyectos/Worksets"
          },
          "addComment": {
            "href": "/api/v3/work_packages/1498/activities",
            "method": "post",
            "title": "Add comment"
          },
          "previewMarkup": {
            "href": "/api/v3/render/markdown?context=/api/v3/work_packages/1498",
            "method": "post"
          },
          "timeEntries": {
            "href": "/api/v3/time_entries?filters=%5B%7B%22work_package_id%22%3A%7B%22operator%22%3A%22%3D%22%2C%22values%22%3A%5B%221498%22%5D%7D%7D%5D",
            "title": "Time entries"
          },
          "category": {
            "href": null
          },
          "type": {
            "href": "/api/v3/types/1",
            "title": "Tarea"
          },
          "priority": {
            "href": "/api/v3/priorities/4",
            "title": "Baja"
          },
          "project": {
            "href": "/api/v3/projects/686",
            "title": "ARQUITECTURA"
          },
          "projectPhaseDefinition": {
            "href": null,
            "title": null
          },
          "status": {
            "href": "/api/v3/statuses/1",
            "title": "(WIP) Trabajo en progresos"
          },
          "author": {
            "href": "/api/v3/users/4",
            "title": "Francis Vin"
          },
          "responsible": {
            "href": "/api/v3/groups/6",
            "title": "Coordinador BIM"
          },
          "assignee": {
            "href": "/api/v3/users/599",
            "title": "Modelador bim"
          },
          "version": {
            "href": null
          },
          "budget": {
            "href": "/api/v3/budgets/8",
            "title": "Presupuesto total Arquitectura LOD 300"
          },
          "logCosts": {
            "href": "/work_packages/1498/cost_entries/new",
            "type": "text/html",
            "title": "Log costs on Configuración de subproyectos/Worksets"
          },
          "showCosts": {
            "href": "/projects/686/cost_reports?fields%5B%5D=WorkPackageId&operators%5BWorkPackageId%5D=%3D&set_filter=1&values%5BWorkPackageId%5D=1498",
            "type": "text/html",
            "title": "Show cost entries"
          },
          "costsByType": {
            "href": "/api/v3/work_packages/1498/summarized_costs_by_type"
          },
          "github_pull_requests": {
            "href": "/api/v3/work_packages/1498/github_pull_requests",
            "title": "GitHub pull requests"
          },
          "gitlab_merge_requests": {
            "href": "/api/v3/work_packages/1498/gitlab_merge_requests",
            "title": "Gitlab merge requests"
          },
          "gitlab_issues": {
            "href": "/api/v3/work_packages/1498/gitlab_issues",
            "title": "Gitlab Issues"
          },
          "meetings": {
            "href": "/work_packages/1498/tabs/meetings",
            "title": "meetings"
          },
          "convertBCF": {
            "href": "/api/bcf/2.1/projects/arquitectura-3/topics",
            "title": "Convert to BCF",
            "payload": {
              "reference_links": [
                "/api/v3/work_packages/1498"
              ]
            },
            "method": "post"
          },
          "customField11": {
            "href": null,
            "title": null
          },
          "customField3": {
            "href": null,
            "title": null
          },
          "customField4": {
            "href": null,
            "title": null
          },
          "customField5": {
            "href": null,
            "title": null
          },
          "customField6": {
            "href": null,
            "title": null
          },
          "customField9": {
            "href": null,
            "title": null
          },
          "customField12": {
            "title": "PIM – Diseño",
            "href": "/api/v3/custom_options/193"
          },
          "self": {
            "href": "/api/v3/work_packages/1498",
            "title": "Configuración de subproyectos/Worksets"
          },
          "unwatch": {
            "href": "/api/v3/work_packages/1498/watchers/4",
            "method": "delete"
          },
          "ancestors": [
            {
              "href": "/api/v3/work_packages/1492",
              "title": "FASE 1 - Preparación y Configuración Inicial"
            }
          ],
          "parent": {
            "href": "/api/v3/work_packages/1492",
            "title": "FASE 1 - Preparación y Configuración Inicial"
          },
          "customActions": []
        }
      },
      {
        "derivedStartDate": "2026-01-22",
        "derivedDueDate": "2026-02-24",
        "spentTime": "P1DT2H",
        "laborCosts": "728,00 SOL",
        "materialCosts": "0,00 SOL",
        "overallCosts": "728,00 SOL",
        "_type": "WorkPackage",
        "id": 1499,
        "lockVersion": 30,
        "subject": "FASE 2 - Modelado Arquitectónico LOD 300",
        "description": {
          "format": "markdown",
          "raw": "",
          "html": ""
        },
        "scheduleManually": false,
        "startDate": "2026-01-22",
        "dueDate": "2026-02-24",
        "estimatedTime": null,
        "derivedEstimatedTime": "P3DT8H",
        "derivedRemainingTime": "P2DT7H12M",
        "duration": "P34D",
        "ignoreNonWorkingDays": false,
        "percentageDone": null,
        "derivedPercentageDone": 31,
        "createdAt": "2025-12-19T23:30:40.967Z",
        "updatedAt": "2025-12-20T03:16:50.307Z",
        "readonly": false,
        "position": 1,
        "storyPoints": null,
        "customField1": null,
        "customField2": null,
        "customField7": null,
        "customField8": null,
        "_links": {
          "addAttachment": {
            "href": "/api/v3/work_packages/1499/attachments",
            "method": "post"
          },
          "fileLinks": {
            "href": "/api/v3/work_packages/1499/file_links"
          },
          "addFileLink": {
            "href": "/api/v3/work_packages/1499/file_links",
            "method": "post"
          },
          "update": {
            "href": "/api/v3/work_packages/1499/form",
            "method": "post"
          },
          "schema": {
            "href": "/api/v3/work_packages/schemas/686-3"
          },
          "updateImmediately": {
            "href": "/api/v3/work_packages/1499",
            "method": "patch"
          },
          "delete": {
            "href": "/api/v3/work_packages/1499",
            "method": "delete"
          },
          "logTime": {
            "href": "/api/v3/time_entries",
            "title": "Log time on work package 'FASE 2 - Modelado Arquitectónico LOD 300'"
          },
          "move": {
            "href": "/work_packages/1499/move/new",
            "type": "text/html",
            "title": "Move work package 'FASE 2 - Modelado Arquitectónico LOD 300'"
          },
          "copy": {
            "href": "/work_packages/1499/copy",
            "type": "text/html",
            "title": "Copy work package 'FASE 2 - Modelado Arquitectónico LOD 300'"
          },
          "pdf": {
            "href": "/work_packages/1499.pdf",
            "type": "application/pdf",
            "title": "Export as PDF"
          },
          "generate_pdf": {
            "href": "/work_packages/1499/generate_pdf_dialog",
            "type": "text/vnd.turbo-stream.html",
            "title": "Generate PDF"
          },
          "atom": {
            "href": "/work_packages/1499.atom",
            "type": "application/rss+xml",
            "title": "Atom feed"
          },
          "availableRelationCandidates": {
            "href": "/api/v3/work_packages/1499/available_relation_candidates",
            "title": "Potential work packages to relate to"
          },
          "customFields": {
            "href": "/projects/arquitectura-3/settings/custom_fields",
            "type": "text/html",
            "title": "Custom fields"
          },
          "configureForm": {
            "href": "/types/3/edit?tab=form_configuration",
            "type": "text/html",
            "title": "Configure form"
          },
          "activities": {
            "href": "/api/v3/work_packages/1499/activities"
          },
          "availableWatchers": {
            "href": "/api/v3/work_packages/1499/available_watchers"
          },
          "relations": {
            "href": "/api/v3/work_packages/1499/relations"
          },
          "revisions": {
            "href": "/api/v3/work_packages/1499/revisions"
          },
          "watchers": {
            "href": "/api/v3/work_packages/1499/watchers"
          },
          "addWatcher": {
            "href": "/api/v3/work_packages/1499/watchers",
            "method": "post",
            "payload": {
              "user": {
                "href": "/api/v3/users/{user_id}"
              }
            },
            "templated": true
          },
          "removeWatcher": {
            "href": "/api/v3/work_packages/1499/watchers/{user_id}",
            "method": "delete",
            "templated": true
          },
          "addRelation": {
            "href": "/api/v3/work_packages/1499/relations",
            "method": "post",
            "title": "Add relation"
          },
          "addChild": {
            "href": "/api/v3/projects/arquitectura-3/work_packages",
            "method": "post",
            "title": "Add child of FASE 2 - Modelado Arquitectónico LOD 300"
          },
          "changeParent": {
            "href": "/api/v3/work_packages/1499",
            "method": "patch",
            "title": "Change parent of FASE 2 - Modelado Arquitectónico LOD 300"
          },
          "addComment": {
            "href": "/api/v3/work_packages/1499/activities",
            "method": "post",
            "title": "Add comment"
          },
          "previewMarkup": {
            "href": "/api/v3/render/markdown?context=/api/v3/work_packages/1499",
            "method": "post"
          },
          "timeEntries": {
            "href": "/api/v3/time_entries?filters=%5B%7B%22work_package_id%22%3A%7B%22operator%22%3A%22%3D%22%2C%22values%22%3A%5B%221499%22%5D%7D%7D%5D",
            "title": "Time entries"
          },
          "category": {
            "href": null
          },
          "type": {
            "href": "/api/v3/types/3",
            "title": "Fase"
          },
          "priority": {
            "href": "/api/v3/priorities/4",
            "title": "Baja"
          },
          "project": {
            "href": "/api/v3/projects/686",
            "title": "ARQUITECTURA"
          },
          "projectPhaseDefinition": {
            "href": null,
            "title": null
          },
          "status": {
            "href": "/api/v3/statuses/1",
            "title": "(WIP) Trabajo en progresos"
          },
          "author": {
            "href": "/api/v3/users/4",
            "title": "Francis Vin"
          },
          "responsible": {
            "href": "/api/v3/groups/454",
            "title": "Gerente de Proyecto BIM"
          },
          "assignee": {
            "href": "/api/v3/groups/16",
            "title": "BIM Manager"
          },
          "version": {
            "href": null
          },
          "budget": {
            "href": "/api/v3/budgets/8",
            "title": "Presupuesto total Arquitectura LOD 300"
          },
          "logCosts": {
            "href": "/work_packages/1499/cost_entries/new",
            "type": "text/html",
            "title": "Log costs on FASE 2 - Modelado Arquitectónico LOD 300"
          },
          "showCosts": {
            "href": "/projects/686/cost_reports?fields%5B%5D=WorkPackageId&operators%5BWorkPackageId%5D=%3D&set_filter=1&values%5BWorkPackageId%5D=1499",
            "type": "text/html",
            "title": "Show cost entries"
          },
          "costsByType": {
            "href": "/api/v3/work_packages/1499/summarized_costs_by_type"
          },
          "github_pull_requests": {
            "href": "/api/v3/work_packages/1499/github_pull_requests",
            "title": "GitHub pull requests"
          },
          "gitlab_merge_requests": {
            "href": "/api/v3/work_packages/1499/gitlab_merge_requests",
            "title": "Gitlab merge requests"
          },
          "gitlab_issues": {
            "href": "/api/v3/work_packages/1499/gitlab_issues",
            "title": "Gitlab Issues"
          },
          "meetings": {
            "href": "/work_packages/1499/tabs/meetings",
            "title": "meetings"
          },
          "convertBCF": {
            "href": "/api/bcf/2.1/projects/arquitectura-3/topics",
            "title": "Convert to BCF",
            "payload": {
              "reference_links": [
                "/api/v3/work_packages/1499"
              ]
            },
            "method": "post"
          },
          "customField3": {
            "href": null,
            "title": null
          },
          "customField4": {
            "href": null,
            "title": null
          },
          "customField5": {
            "href": null,
            "title": null
          },
          "customField6": {
            "href": null,
            "title": null
          },
          "customField9": {
            "href": null,
            "title": null
          },
          "customField12": {
            "title": "PIM – Diseño",
            "href": "/api/v3/custom_options/193"
          },
          "customField73": {
            "href": null,
            "title": null
          },
          "customField74": {
            "href": null,
            "title": null
          },
          "self": {
            "href": "/api/v3/work_packages/1499",
            "title": "FASE 2 - Modelado Arquitectónico LOD 300"
          },
          "unwatch": {
            "href": "/api/v3/work_packages/1499/watchers/4",
            "method": "delete"
          },
          "children": [
            {
              "href": "/api/v3/work_packages/1503",
              "title": "Modelado de pisos y techos"
            },
            {
              "href": "/api/v3/work_packages/1509",
              "title": "Hito 2 - Revisión de modelado"
            },
            {
              "href": "/api/v3/work_packages/1501",
              "title": "Modelado de muros"
            },
            {
              "href": "/api/v3/work_packages/1504",
              "title": "Modelado de cubiertas"
            },
            {
              "href": "/api/v3/work_packages/1506",
              "title": "Modelado de elementos arquitectónicos detallados"
            },
            {
              "href": "/api/v3/work_packages/1507",
              "title": "Modelado de materiales (acabados)"
            },
            {
              "href": "/api/v3/work_packages/1505",
              "title": "Modelado de barandas y escaleras"
            },
            {
              "href": "/api/v3/work_packages/1502",
              "title": "Modelado de puertas y ventanas"
            }
          ],
          "ancestors": [],
          "parent": {
            "href": null,
            "title": null
          },
          "customActions": []
        }
      },
      {
        "spentTime": "PT0S",
        "laborCosts": "0,00 SOL",
        "materialCosts": "0,00 SOL",
        "overallCosts": "0,00 SOL",
        "_type": "WorkPackage",
        "id": 1500,
        "lockVersion": 9,
        "subject": "Hito 1 - Entrega de PEB y Plantillas",
        "description": {
          "format": "markdown",
          "raw": "*   [ ] &nbsp;BEP aprobado\n*   [ ] Template LOD 300 listo\n*   [ ] Parámetros normalizados",
          "html": "<ul class=\"op-uc-list_task-list op-uc-list\">\n<li class=\"op-uc-list--item\">\n<input type=\"checkbox\" class=\"op-uc-list--task-checkbox\" disabled>  BEP aprobado</li>\n<li class=\"op-uc-list--item\">\n<input type=\"checkbox\" class=\"op-uc-list--task-checkbox\" disabled> Template LOD 300 listo</li>\n<li class=\"op-uc-list--item\">\n<input type=\"checkbox\" class=\"op-uc-list--task-checkbox\" disabled> Parámetros normalizados</li>\n</ul>"
        },
        "scheduleManually": true,
        "date": "2026-01-21",
        "estimatedTime": null,
        "derivedEstimatedTime": null,
        "derivedRemainingTime": null,
        "ignoreNonWorkingDays": false,
        "percentageDone": null,
        "derivedPercentageDone": null,
        "createdAt": "2025-12-19T23:33:03.068Z",
        "updatedAt": "2025-12-20T03:16:30.456Z",
        "readonly": false,
        "customField7": null,
        "customField2": null,
        "customField1": null,
        "customField8": null,
        "_links": {
          "addAttachment": {
            "href": "/api/v3/work_packages/1500/attachments",
            "method": "post"
          },
          "fileLinks": {
            "href": "/api/v3/work_packages/1500/file_links"
          },
          "addFileLink": {
            "href": "/api/v3/work_packages/1500/file_links",
            "method": "post"
          },
          "update": {
            "href": "/api/v3/work_packages/1500/form",
            "method": "post"
          },
          "schema": {
            "href": "/api/v3/work_packages/schemas/686-2"
          },
          "updateImmediately": {
            "href": "/api/v3/work_packages/1500",
            "method": "patch"
          },
          "delete": {
            "href": "/api/v3/work_packages/1500",
            "method": "delete"
          },
          "logTime": {
            "href": "/api/v3/time_entries",
            "title": "Log time on work package 'Hito 1 - Entrega de PEB y Plantillas'"
          },
          "move": {
            "href": "/work_packages/1500/move/new",
            "type": "text/html",
            "title": "Move work package 'Hito 1 - Entrega de PEB y Plantillas'"
          },
          "copy": {
            "href": "/work_packages/1500/copy",
            "type": "text/html",
            "title": "Copy work package 'Hito 1 - Entrega de PEB y Plantillas'"
          },
          "pdf": {
            "href": "/work_packages/1500.pdf",
            "type": "application/pdf",
            "title": "Export as PDF"
          },
          "generate_pdf": {
            "href": "/work_packages/1500/generate_pdf_dialog",
            "type": "text/vnd.turbo-stream.html",
            "title": "Generate PDF"
          },
          "atom": {
            "href": "/work_packages/1500.atom",
            "type": "application/rss+xml",
            "title": "Atom feed"
          },
          "availableRelationCandidates": {
            "href": "/api/v3/work_packages/1500/available_relation_candidates",
            "title": "Potential work packages to relate to"
          },
          "customFields": {
            "href": "/projects/arquitectura-3/settings/custom_fields",
            "type": "text/html",
            "title": "Custom fields"
          },
          "configureForm": {
            "href": "/types/2/edit?tab=form_configuration",
            "type": "text/html",
            "title": "Configure form"
          },
          "activities": {
            "href": "/api/v3/work_packages/1500/activities"
          },
          "availableWatchers": {
            "href": "/api/v3/work_packages/1500/available_watchers"
          },
          "relations": {
            "href": "/api/v3/work_packages/1500/relations"
          },
          "revisions": {
            "href": "/api/v3/work_packages/1500/revisions"
          },
          "watchers": {
            "href": "/api/v3/work_packages/1500/watchers"
          },
          "addWatcher": {
            "href": "/api/v3/work_packages/1500/watchers",
            "method": "post",
            "payload": {
              "user": {
                "href": "/api/v3/users/{user_id}"
              }
            },
            "templated": true
          },
          "removeWatcher": {
            "href": "/api/v3/work_packages/1500/watchers/{user_id}",
            "method": "delete",
            "templated": true
          },
          "addRelation": {
            "href": "/api/v3/work_packages/1500/relations",
            "method": "post",
            "title": "Add relation"
          },
          "changeParent": {
            "href": "/api/v3/work_packages/1500",
            "method": "patch",
            "title": "Change parent of Hito 1 - Entrega de PEB y Plantillas"
          },
          "addComment": {
            "href": "/api/v3/work_packages/1500/activities",
            "method": "post",
            "title": "Add comment"
          },
          "previewMarkup": {
            "href": "/api/v3/render/markdown?context=/api/v3/work_packages/1500",
            "method": "post"
          },
          "timeEntries": {
            "href": "/api/v3/time_entries?filters=%5B%7B%22work_package_id%22%3A%7B%22operator%22%3A%22%3D%22%2C%22values%22%3A%5B%221500%22%5D%7D%7D%5D",
            "title": "Time entries"
          },
          "category": {
            "href": null
          },
          "type": {
            "href": "/api/v3/types/2",
            "title": "Hito"
          },
          "priority": {
            "href": "/api/v3/priorities/4",
            "title": "Baja"
          },
          "project": {
            "href": "/api/v3/projects/686",
            "title": "ARQUITECTURA"
          },
          "projectPhaseDefinition": {
            "href": null,
            "title": null
          },
          "status": {
            "href": "/api/v3/statuses/1",
            "title": "(WIP) Trabajo en progresos"
          },
          "author": {
            "href": "/api/v3/users/4",
            "title": "Francis Vin"
          },
          "responsible": {
            "href": "/api/v3/groups/16",
            "title": "BIM Manager"
          },
          "assignee": {
            "href": "/api/v3/groups/6",
            "title": "Coordinador BIM"
          },
          "version": {
            "href": null
          },
          "budget": {
            "href": "/api/v3/budgets/8",
            "title": "Presupuesto total Arquitectura LOD 300"
          },
          "logCosts": {
            "href": "/work_packages/1500/cost_entries/new",
            "type": "text/html",
            "title": "Log costs on Hito 1 - Entrega de PEB y Plantillas"
          },
          "showCosts": {
            "href": "/projects/686/cost_reports?fields%5B%5D=WorkPackageId&operators%5BWorkPackageId%5D=%3D&set_filter=1&values%5BWorkPackageId%5D=1500",
            "type": "text/html",
            "title": "Show cost entries"
          },
          "costsByType": {
            "href": "/api/v3/work_packages/1500/summarized_costs_by_type"
          },
          "github_pull_requests": {
            "href": "/api/v3/work_packages/1500/github_pull_requests",
            "title": "GitHub pull requests"
          },
          "gitlab_merge_requests": {
            "href": "/api/v3/work_packages/1500/gitlab_merge_requests",
            "title": "Gitlab merge requests"
          },
          "gitlab_issues": {
            "href": "/api/v3/work_packages/1500/gitlab_issues",
            "title": "Gitlab Issues"
          },
          "meetings": {
            "href": "/work_packages/1500/tabs/meetings",
            "title": "meetings"
          },
          "convertBCF": {
            "href": "/api/bcf/2.1/projects/arquitectura-3/topics",
            "title": "Convert to BCF",
            "payload": {
              "reference_links": [
                "/api/v3/work_packages/1500"
              ]
            },
            "method": "post"
          },
          "customField5": {
            "href": null,
            "title": null
          },
          "customField12": {
            "title": "PIM – Diseño",
            "href": "/api/v3/custom_options/193"
          },
          "customField4": {
            "href": null,
            "title": null
          },
          "customField6": {
            "href": null,
            "title": null
          },
          "customField9": {
            "href": null,
            "title": null
          },
          "customField3": {
            "href": null,
            "title": null
          },
          "self": {
            "href": "/api/v3/work_packages/1500",
            "title": "Hito 1 - Entrega de PEB y Plantillas"
          },
          "unwatch": {
            "href": "/api/v3/work_packages/1500/watchers/4",
            "method": "delete"
          },
          "ancestors": [
            {
              "href": "/api/v3/work_packages/1492",
              "title": "FASE 1 - Preparación y Configuración Inicial"
            }
          ],
          "parent": {
            "href": "/api/v3/work_packages/1492",
            "title": "FASE 1 - Preparación y Configuración Inicial"
          },
          "customActions": []
        }
      },
      {
        "derivedStartDate": null,
        "derivedDueDate": null,
        "spentTime": "PT2H",
        "laborCosts": "56,00 SOL",
        "materialCosts": "0,00 SOL",
        "overallCosts": "56,00 SOL",
        "_type": "WorkPackage",
        "id": 1501,
        "lockVersion": 12,
        "subject": "Modelado de muros",
        "description": {
          "format": "markdown",
          "raw": "",
          "html": ""
        },
        "scheduleManually": true,
        "startDate": "2026-01-22",
        "dueDate": "2026-01-27",
        "estimatedTime": "PT16H",
        "derivedEstimatedTime": null,
        "remainingTime": "PT14H24M",
        "derivedRemainingTime": null,
        "duration": "P6D",
        "ignoreNonWorkingDays": false,
        "percentageDone": 10,
        "derivedPercentageDone": null,
        "createdAt": "2025-12-19T23:34:42.221Z",
        "updatedAt": "2025-12-20T03:16:57.251Z",
        "readonly": false,
        "customField1": null,
        "customField2": null,
        "customField7": null,
        "customField8": null,
        "_links": {
          "addAttachment": {
            "href": "/api/v3/work_packages/1501/attachments",
            "method": "post"
          },
          "fileLinks": {
            "href": "/api/v3/work_packages/1501/file_links"
          },
          "addFileLink": {
            "href": "/api/v3/work_packages/1501/file_links",
            "method": "post"
          },
          "update": {
            "href": "/api/v3/work_packages/1501/form",
            "method": "post"
          },
          "schema": {
            "href": "/api/v3/work_packages/schemas/686-1"
          },
          "updateImmediately": {
            "href": "/api/v3/work_packages/1501",
            "method": "patch"
          },
          "delete": {
            "href": "/api/v3/work_packages/1501",
            "method": "delete"
          },
          "logTime": {
            "href": "/api/v3/time_entries",
            "title": "Log time on work package 'Modelado de muros'"
          },
          "move": {
            "href": "/work_packages/1501/move/new",
            "type": "text/html",
            "title": "Move work package 'Modelado de muros'"
          },
          "copy": {
            "href": "/work_packages/1501/copy",
            "type": "text/html",
            "title": "Copy work package 'Modelado de muros'"
          },
          "pdf": {
            "href": "/work_packages/1501.pdf",
            "type": "application/pdf",
            "title": "Export as PDF"
          },
          "generate_pdf": {
            "href": "/work_packages/1501/generate_pdf_dialog",
            "type": "text/vnd.turbo-stream.html",
            "title": "Generate PDF"
          },
          "atom": {
            "href": "/work_packages/1501.atom",
            "type": "application/rss+xml",
            "title": "Atom feed"
          },
          "availableRelationCandidates": {
            "href": "/api/v3/work_packages/1501/available_relation_candidates",
            "title": "Potential work packages to relate to"
          },
          "customFields": {
            "href": "/projects/arquitectura-3/settings/custom_fields",
            "type": "text/html",
            "title": "Custom fields"
          },
          "configureForm": {
            "href": "/types/1/edit?tab=form_configuration",
            "type": "text/html",
            "title": "Configure form"
          },
          "activities": {
            "href": "/api/v3/work_packages/1501/activities"
          },
          "availableWatchers": {
            "href": "/api/v3/work_packages/1501/available_watchers"
          },
          "relations": {
            "href": "/api/v3/work_packages/1501/relations"
          },
          "revisions": {
            "href": "/api/v3/work_packages/1501/revisions"
          },
          "watchers": {
            "href": "/api/v3/work_packages/1501/watchers"
          },
          "addWatcher": {
            "href": "/api/v3/work_packages/1501/watchers",
            "method": "post",
            "payload": {
              "user": {
                "href": "/api/v3/users/{user_id}"
              }
            },
            "templated": true
          },
          "removeWatcher": {
            "href": "/api/v3/work_packages/1501/watchers/{user_id}",
            "method": "delete",
            "templated": true
          },
          "addRelation": {
            "href": "/api/v3/work_packages/1501/relations",
            "method": "post",
            "title": "Add relation"
          },
          "addChild": {
            "href": "/api/v3/projects/arquitectura-3/work_packages",
            "method": "post",
            "title": "Add child of Modelado de muros"
          },
          "changeParent": {
            "href": "/api/v3/work_packages/1501",
            "method": "patch",
            "title": "Change parent of Modelado de muros"
          },
          "addComment": {
            "href": "/api/v3/work_packages/1501/activities",
            "method": "post",
            "title": "Add comment"
          },
          "previewMarkup": {
            "href": "/api/v3/render/markdown?context=/api/v3/work_packages/1501",
            "method": "post"
          },
          "timeEntries": {
            "href": "/api/v3/time_entries?filters=%5B%7B%22work_package_id%22%3A%7B%22operator%22%3A%22%3D%22%2C%22values%22%3A%5B%221501%22%5D%7D%7D%5D",
            "title": "Time entries"
          },
          "category": {
            "href": null
          },
          "type": {
            "href": "/api/v3/types/1",
            "title": "Tarea"
          },
          "priority": {
            "href": "/api/v3/priorities/4",
            "title": "Baja"
          },
          "project": {
            "href": "/api/v3/projects/686",
            "title": "ARQUITECTURA"
          },
          "projectPhaseDefinition": {
            "href": null,
            "title": null
          },
          "status": {
            "href": "/api/v3/statuses/1",
            "title": "(WIP) Trabajo en progresos"
          },
          "author": {
            "href": "/api/v3/users/4",
            "title": "Francis Vin"
          },
          "responsible": {
            "href": "/api/v3/groups/6",
            "title": "Coordinador BIM"
          },
          "assignee": {
            "href": "/api/v3/users/599",
            "title": "Modelador bim"
          },
          "version": {
            "href": null
          },
          "budget": {
            "href": "/api/v3/budgets/8",
            "title": "Presupuesto total Arquitectura LOD 300"
          },
          "logCosts": {
            "href": "/work_packages/1501/cost_entries/new",
            "type": "text/html",
            "title": "Log costs on Modelado de muros"
          },
          "showCosts": {
            "href": "/projects/686/cost_reports?fields%5B%5D=WorkPackageId&operators%5BWorkPackageId%5D=%3D&set_filter=1&values%5BWorkPackageId%5D=1501",
            "type": "text/html",
            "title": "Show cost entries"
          },
          "costsByType": {
            "href": "/api/v3/work_packages/1501/summarized_costs_by_type"
          },
          "github_pull_requests": {
            "href": "/api/v3/work_packages/1501/github_pull_requests",
            "title": "GitHub pull requests"
          },
          "gitlab_merge_requests": {
            "href": "/api/v3/work_packages/1501/gitlab_merge_requests",
            "title": "Gitlab merge requests"
          },
          "gitlab_issues": {
            "href": "/api/v3/work_packages/1501/gitlab_issues",
            "title": "Gitlab Issues"
          },
          "meetings": {
            "href": "/work_packages/1501/tabs/meetings",
            "title": "meetings"
          },
          "convertBCF": {
            "href": "/api/bcf/2.1/projects/arquitectura-3/topics",
            "title": "Convert to BCF",
            "payload": {
              "reference_links": [
                "/api/v3/work_packages/1501"
              ]
            },
            "method": "post"
          },
          "customField11": {
            "href": null,
            "title": null
          },
          "customField3": {
            "href": null,
            "title": null
          },
          "customField4": {
            "href": null,
            "title": null
          },
          "customField5": {
            "href": null,
            "title": null
          },
          "customField6": {
            "href": null,
            "title": null
          },
          "customField9": {
            "href": null,
            "title": null
          },
          "customField12": {
            "title": "PIM – Diseño",
            "href": "/api/v3/custom_options/193"
          },
          "self": {
            "href": "/api/v3/work_packages/1501",
            "title": "Modelado de muros"
          },
          "unwatch": {
            "href": "/api/v3/work_packages/1501/watchers/4",
            "method": "delete"
          },
          "ancestors": [
            {
              "href": "/api/v3/work_packages/1499",
              "title": "FASE 2 - Modelado Arquitectónico LOD 300"
            }
          ],
          "parent": {
            "href": "/api/v3/work_packages/1499",
            "title": "FASE 2 - Modelado Arquitectónico LOD 300"
          },
          "customActions": []
        }
      },
      {
        "derivedStartDate": null,
        "derivedDueDate": null,
        "spentTime": "PT3H",
        "laborCosts": "84,00 SOL",
        "materialCosts": "0,00 SOL",
        "overallCosts": "84,00 SOL",
        "_type": "WorkPackage",
        "id": 1502,
        "lockVersion": 10,
        "subject": "Modelado de puertas y ventanas",
        "description": {
          "format": "markdown",
          "raw": "",
          "html": ""
        },
        "scheduleManually": true,
        "startDate": "2026-01-24",
        "dueDate": "2026-01-30",
        "estimatedTime": "PT12H",
        "derivedEstimatedTime": null,
        "remainingTime": "PT9H36M",
        "derivedRemainingTime": null,
        "duration": "P7D",
        "ignoreNonWorkingDays": false,
        "percentageDone": 20,
        "derivedPercentageDone": null,
        "createdAt": "2025-12-19T23:34:48.929Z",
        "updatedAt": "2025-12-20T03:11:12.354Z",
        "readonly": false,
        "customField1": null,
        "customField2": null,
        "customField7": null,
        "customField8": null,
        "_links": {
          "addAttachment": {
            "href": "/api/v3/work_packages/1502/attachments",
            "method": "post"
          },
          "fileLinks": {
            "href": "/api/v3/work_packages/1502/file_links"
          },
          "addFileLink": {
            "href": "/api/v3/work_packages/1502/file_links",
            "method": "post"
          },
          "update": {
            "href": "/api/v3/work_packages/1502/form",
            "method": "post"
          },
          "schema": {
            "href": "/api/v3/work_packages/schemas/686-1"
          },
          "updateImmediately": {
            "href": "/api/v3/work_packages/1502",
            "method": "patch"
          },
          "delete": {
            "href": "/api/v3/work_packages/1502",
            "method": "delete"
          },
          "logTime": {
            "href": "/api/v3/time_entries",
            "title": "Log time on work package 'Modelado de puertas y ventanas'"
          },
          "move": {
            "href": "/work_packages/1502/move/new",
            "type": "text/html",
            "title": "Move work package 'Modelado de puertas y ventanas'"
          },
          "copy": {
            "href": "/work_packages/1502/copy",
            "type": "text/html",
            "title": "Copy work package 'Modelado de puertas y ventanas'"
          },
          "pdf": {
            "href": "/work_packages/1502.pdf",
            "type": "application/pdf",
            "title": "Export as PDF"
          },
          "generate_pdf": {
            "href": "/work_packages/1502/generate_pdf_dialog",
            "type": "text/vnd.turbo-stream.html",
            "title": "Generate PDF"
          },
          "atom": {
            "href": "/work_packages/1502.atom",
            "type": "application/rss+xml",
            "title": "Atom feed"
          },
          "availableRelationCandidates": {
            "href": "/api/v3/work_packages/1502/available_relation_candidates",
            "title": "Potential work packages to relate to"
          },
          "customFields": {
            "href": "/projects/arquitectura-3/settings/custom_fields",
            "type": "text/html",
            "title": "Custom fields"
          },
          "configureForm": {
            "href": "/types/1/edit?tab=form_configuration",
            "type": "text/html",
            "title": "Configure form"
          },
          "activities": {
            "href": "/api/v3/work_packages/1502/activities"
          },
          "availableWatchers": {
            "href": "/api/v3/work_packages/1502/available_watchers"
          },
          "relations": {
            "href": "/api/v3/work_packages/1502/relations"
          },
          "revisions": {
            "href": "/api/v3/work_packages/1502/revisions"
          },
          "watchers": {
            "href": "/api/v3/work_packages/1502/watchers"
          },
          "addWatcher": {
            "href": "/api/v3/work_packages/1502/watchers",
            "method": "post",
            "payload": {
              "user": {
                "href": "/api/v3/users/{user_id}"
              }
            },
            "templated": true
          },
          "removeWatcher": {
            "href": "/api/v3/work_packages/1502/watchers/{user_id}",
            "method": "delete",
            "templated": true
          },
          "addRelation": {
            "href": "/api/v3/work_packages/1502/relations",
            "method": "post",
            "title": "Add relation"
          },
          "addChild": {
            "href": "/api/v3/projects/arquitectura-3/work_packages",
            "method": "post",
            "title": "Add child of Modelado de puertas y ventanas"
          },
          "changeParent": {
            "href": "/api/v3/work_packages/1502",
            "method": "patch",
            "title": "Change parent of Modelado de puertas y ventanas"
          },
          "addComment": {
            "href": "/api/v3/work_packages/1502/activities",
            "method": "post",
            "title": "Add comment"
          },
          "previewMarkup": {
            "href": "/api/v3/render/markdown?context=/api/v3/work_packages/1502",
            "method": "post"
          },
          "timeEntries": {
            "href": "/api/v3/time_entries?filters=%5B%7B%22work_package_id%22%3A%7B%22operator%22%3A%22%3D%22%2C%22values%22%3A%5B%221502%22%5D%7D%7D%5D",
            "title": "Time entries"
          },
          "category": {
            "href": null
          },
          "type": {
            "href": "/api/v3/types/1",
            "title": "Tarea"
          },
          "priority": {
            "href": "/api/v3/priorities/4",
            "title": "Baja"
          },
          "project": {
            "href": "/api/v3/projects/686",
            "title": "ARQUITECTURA"
          },
          "projectPhaseDefinition": {
            "href": null,
            "title": null
          },
          "status": {
            "href": "/api/v3/statuses/1",
            "title": "(WIP) Trabajo en progresos"
          },
          "author": {
            "href": "/api/v3/users/4",
            "title": "Francis Vin"
          },
          "responsible": {
            "href": "/api/v3/groups/6",
            "title": "Coordinador BIM"
          },
          "assignee": {
            "href": "/api/v3/users/599",
            "title": "Modelador bim"
          },
          "version": {
            "href": null
          },
          "budget": {
            "href": "/api/v3/budgets/8",
            "title": "Presupuesto total Arquitectura LOD 300"
          },
          "logCosts": {
            "href": "/work_packages/1502/cost_entries/new",
            "type": "text/html",
            "title": "Log costs on Modelado de puertas y ventanas"
          },
          "showCosts": {
            "href": "/projects/686/cost_reports?fields%5B%5D=WorkPackageId&operators%5BWorkPackageId%5D=%3D&set_filter=1&values%5BWorkPackageId%5D=1502",
            "type": "text/html",
            "title": "Show cost entries"
          },
          "costsByType": {
            "href": "/api/v3/work_packages/1502/summarized_costs_by_type"
          },
          "github_pull_requests": {
            "href": "/api/v3/work_packages/1502/github_pull_requests",
            "title": "GitHub pull requests"
          },
          "gitlab_merge_requests": {
            "href": "/api/v3/work_packages/1502/gitlab_merge_requests",
            "title": "Gitlab merge requests"
          },
          "gitlab_issues": {
            "href": "/api/v3/work_packages/1502/gitlab_issues",
            "title": "Gitlab Issues"
          },
          "meetings": {
            "href": "/work_packages/1502/tabs/meetings",
            "title": "meetings"
          },
          "convertBCF": {
            "href": "/api/bcf/2.1/projects/arquitectura-3/topics",
            "title": "Convert to BCF",
            "payload": {
              "reference_links": [
                "/api/v3/work_packages/1502"
              ]
            },
            "method": "post"
          },
          "customField3": {
            "href": null,
            "title": null
          },
          "customField4": {
            "href": null,
            "title": null
          },
          "customField5": {
            "href": null,
            "title": null
          },
          "customField6": {
            "href": null,
            "title": null
          },
          "customField9": {
            "href": null,
            "title": null
          },
          "customField12": {
            "title": "PIM – Diseño",
            "href": "/api/v3/custom_options/193"
          },
          "customField11": {
            "href": null,
            "title": null
          },
          "self": {
            "href": "/api/v3/work_packages/1502",
            "title": "Modelado de puertas y ventanas"
          },
          "unwatch": {
            "href": "/api/v3/work_packages/1502/watchers/4",
            "method": "delete"
          },
          "ancestors": [
            {
              "href": "/api/v3/work_packages/1499",
              "title": "FASE 2 - Modelado Arquitectónico LOD 300"
            }
          ],
          "parent": {
            "href": "/api/v3/work_packages/1499",
            "title": "FASE 2 - Modelado Arquitectónico LOD 300"
          },
          "customActions": []
        }
      },
      {
        "derivedStartDate": null,
        "derivedDueDate": null,
        "spentTime": "PT4H",
        "laborCosts": "112,00 SOL",
        "materialCosts": "0,00 SOL",
        "overallCosts": "112,00 SOL",
        "_type": "WorkPackage",
        "id": 1503,
        "lockVersion": 11,
        "subject": "Modelado de pisos y techos",
        "description": {
          "format": "markdown",
          "raw": "",
          "html": ""
        },
        "scheduleManually": true,
        "startDate": "2026-01-26",
        "dueDate": "2026-02-02",
        "estimatedTime": "PT12H",
        "derivedEstimatedTime": null,
        "remainingTime": "PT8H24M",
        "derivedRemainingTime": null,
        "duration": "P8D",
        "ignoreNonWorkingDays": false,
        "percentageDone": 30,
        "derivedPercentageDone": null,
        "createdAt": "2025-12-19T23:34:55.722Z",
        "updatedAt": "2025-12-20T03:17:03.412Z",
        "readonly": false,
        "customField1": null,
        "customField2": null,
        "customField7": null,
        "customField8": null,
        "_links": {
          "addAttachment": {
            "href": "/api/v3/work_packages/1503/attachments",
            "method": "post"
          },
          "fileLinks": {
            "href": "/api/v3/work_packages/1503/file_links"
          },
          "addFileLink": {
            "href": "/api/v3/work_packages/1503/file_links",
            "method": "post"
          },
          "update": {
            "href": "/api/v3/work_packages/1503/form",
            "method": "post"
          },
          "schema": {
            "href": "/api/v3/work_packages/schemas/686-1"
          },
          "updateImmediately": {
            "href": "/api/v3/work_packages/1503",
            "method": "patch"
          },
          "delete": {
            "href": "/api/v3/work_packages/1503",
            "method": "delete"
          },
          "logTime": {
            "href": "/api/v3/time_entries",
            "title": "Log time on work package 'Modelado de pisos y techos'"
          },
          "move": {
            "href": "/work_packages/1503/move/new",
            "type": "text/html",
            "title": "Move work package 'Modelado de pisos y techos'"
          },
          "copy": {
            "href": "/work_packages/1503/copy",
            "type": "text/html",
            "title": "Copy work package 'Modelado de pisos y techos'"
          },
          "pdf": {
            "href": "/work_packages/1503.pdf",
            "type": "application/pdf",
            "title": "Export as PDF"
          },
          "generate_pdf": {
            "href": "/work_packages/1503/generate_pdf_dialog",
            "type": "text/vnd.turbo-stream.html",
            "title": "Generate PDF"
          },
          "atom": {
            "href": "/work_packages/1503.atom",
            "type": "application/rss+xml",
            "title": "Atom feed"
          },
          "availableRelationCandidates": {
            "href": "/api/v3/work_packages/1503/available_relation_candidates",
            "title": "Potential work packages to relate to"
          },
          "customFields": {
            "href": "/projects/arquitectura-3/settings/custom_fields",
            "type": "text/html",
            "title": "Custom fields"
          },
          "configureForm": {
            "href": "/types/1/edit?tab=form_configuration",
            "type": "text/html",
            "title": "Configure form"
          },
          "activities": {
            "href": "/api/v3/work_packages/1503/activities"
          },
          "availableWatchers": {
            "href": "/api/v3/work_packages/1503/available_watchers"
          },
          "relations": {
            "href": "/api/v3/work_packages/1503/relations"
          },
          "revisions": {
            "href": "/api/v3/work_packages/1503/revisions"
          },
          "watchers": {
            "href": "/api/v3/work_packages/1503/watchers"
          },
          "addWatcher": {
            "href": "/api/v3/work_packages/1503/watchers",
            "method": "post",
            "payload": {
              "user": {
                "href": "/api/v3/users/{user_id}"
              }
            },
            "templated": true
          },
          "removeWatcher": {
            "href": "/api/v3/work_packages/1503/watchers/{user_id}",
            "method": "delete",
            "templated": true
          },
          "addRelation": {
            "href": "/api/v3/work_packages/1503/relations",
            "method": "post",
            "title": "Add relation"
          },
          "addChild": {
            "href": "/api/v3/projects/arquitectura-3/work_packages",
            "method": "post",
            "title": "Add child of Modelado de pisos y techos"
          },
          "changeParent": {
            "href": "/api/v3/work_packages/1503",
            "method": "patch",
            "title": "Change parent of Modelado de pisos y techos"
          },
          "addComment": {
            "href": "/api/v3/work_packages/1503/activities",
            "method": "post",
            "title": "Add comment"
          },
          "previewMarkup": {
            "href": "/api/v3/render/markdown?context=/api/v3/work_packages/1503",
            "method": "post"
          },
          "timeEntries": {
            "href": "/api/v3/time_entries?filters=%5B%7B%22work_package_id%22%3A%7B%22operator%22%3A%22%3D%22%2C%22values%22%3A%5B%221503%22%5D%7D%7D%5D",
            "title": "Time entries"
          },
          "category": {
            "href": null
          },
          "type": {
            "href": "/api/v3/types/1",
            "title": "Tarea"
          },
          "priority": {
            "href": "/api/v3/priorities/4",
            "title": "Baja"
          },
          "project": {
            "href": "/api/v3/projects/686",
            "title": "ARQUITECTURA"
          },
          "projectPhaseDefinition": {
            "href": null,
            "title": null
          },
          "status": {
            "href": "/api/v3/statuses/1",
            "title": "(WIP) Trabajo en progresos"
          },
          "author": {
            "href": "/api/v3/users/4",
            "title": "Francis Vin"
          },
          "responsible": {
            "href": "/api/v3/groups/6",
            "title": "Coordinador BIM"
          },
          "assignee": {
            "href": "/api/v3/users/599",
            "title": "Modelador bim"
          },
          "version": {
            "href": null
          },
          "budget": {
            "href": "/api/v3/budgets/8",
            "title": "Presupuesto total Arquitectura LOD 300"
          },
          "logCosts": {
            "href": "/work_packages/1503/cost_entries/new",
            "type": "text/html",
            "title": "Log costs on Modelado de pisos y techos"
          },
          "showCosts": {
            "href": "/projects/686/cost_reports?fields%5B%5D=WorkPackageId&operators%5BWorkPackageId%5D=%3D&set_filter=1&values%5BWorkPackageId%5D=1503",
            "type": "text/html",
            "title": "Show cost entries"
          },
          "costsByType": {
            "href": "/api/v3/work_packages/1503/summarized_costs_by_type"
          },
          "github_pull_requests": {
            "href": "/api/v3/work_packages/1503/github_pull_requests",
            "title": "GitHub pull requests"
          },
          "gitlab_merge_requests": {
            "href": "/api/v3/work_packages/1503/gitlab_merge_requests",
            "title": "Gitlab merge requests"
          },
          "gitlab_issues": {
            "href": "/api/v3/work_packages/1503/gitlab_issues",
            "title": "Gitlab Issues"
          },
          "meetings": {
            "href": "/work_packages/1503/tabs/meetings",
            "title": "meetings"
          },
          "convertBCF": {
            "href": "/api/bcf/2.1/projects/arquitectura-3/topics",
            "title": "Convert to BCF",
            "payload": {
              "reference_links": [
                "/api/v3/work_packages/1503"
              ]
            },
            "method": "post"
          },
          "customField3": {
            "href": null,
            "title": null
          },
          "customField4": {
            "href": null,
            "title": null
          },
          "customField5": {
            "href": null,
            "title": null
          },
          "customField6": {
            "href": null,
            "title": null
          },
          "customField9": {
            "href": null,
            "title": null
          },
          "customField12": {
            "title": "PIM – Diseño",
            "href": "/api/v3/custom_options/193"
          },
          "customField11": {
            "href": null,
            "title": null
          },
          "self": {
            "href": "/api/v3/work_packages/1503",
            "title": "Modelado de pisos y techos"
          },
          "unwatch": {
            "href": "/api/v3/work_packages/1503/watchers/4",
            "method": "delete"
          },
          "ancestors": [
            {
              "href": "/api/v3/work_packages/1499",
              "title": "FASE 2 - Modelado Arquitectónico LOD 300"
            }
          ],
          "parent": {
            "href": "/api/v3/work_packages/1499",
            "title": "FASE 2 - Modelado Arquitectónico LOD 300"
          },
          "customActions": []
        }
      },
      {
        "derivedStartDate": null,
        "derivedDueDate": null,
        "spentTime": "PT4H",
        "laborCosts": "112,00 SOL",
        "materialCosts": "0,00 SOL",
        "overallCosts": "112,00 SOL",
        "_type": "WorkPackage",
        "id": 1504,
        "lockVersion": 13,
        "subject": "Modelado de cubiertas",
        "description": {
          "format": "markdown",
          "raw": "",
          "html": ""
        },
        "scheduleManually": true,
        "startDate": "2026-01-28",
        "dueDate": "2026-02-07",
        "estimatedTime": "PT8H",
        "derivedEstimatedTime": null,
        "remainingTime": "PT4H48M",
        "derivedRemainingTime": null,
        "duration": "P11D",
        "ignoreNonWorkingDays": false,
        "percentageDone": 40,
        "derivedPercentageDone": null,
        "createdAt": "2025-12-19T23:35:01.870Z",
        "updatedAt": "2025-12-20T03:17:07.714Z",
        "readonly": false,
        "customField1": null,
        "customField2": null,
        "customField7": null,
        "customField8": null,
        "_links": {
          "addAttachment": {
            "href": "/api/v3/work_packages/1504/attachments",
            "method": "post"
          },
          "fileLinks": {
            "href": "/api/v3/work_packages/1504/file_links"
          },
          "addFileLink": {
            "href": "/api/v3/work_packages/1504/file_links",
            "method": "post"
          },
          "update": {
            "href": "/api/v3/work_packages/1504/form",
            "method": "post"
          },
          "schema": {
            "href": "/api/v3/work_packages/schemas/686-1"
          },
          "updateImmediately": {
            "href": "/api/v3/work_packages/1504",
            "method": "patch"
          },
          "delete": {
            "href": "/api/v3/work_packages/1504",
            "method": "delete"
          },
          "logTime": {
            "href": "/api/v3/time_entries",
            "title": "Log time on work package 'Modelado de cubiertas'"
          },
          "move": {
            "href": "/work_packages/1504/move/new",
            "type": "text/html",
            "title": "Move work package 'Modelado de cubiertas'"
          },
          "copy": {
            "href": "/work_packages/1504/copy",
            "type": "text/html",
            "title": "Copy work package 'Modelado de cubiertas'"
          },
          "pdf": {
            "href": "/work_packages/1504.pdf",
            "type": "application/pdf",
            "title": "Export as PDF"
          },
          "generate_pdf": {
            "href": "/work_packages/1504/generate_pdf_dialog",
            "type": "text/vnd.turbo-stream.html",
            "title": "Generate PDF"
          },
          "atom": {
            "href": "/work_packages/1504.atom",
            "type": "application/rss+xml",
            "title": "Atom feed"
          },
          "availableRelationCandidates": {
            "href": "/api/v3/work_packages/1504/available_relation_candidates",
            "title": "Potential work packages to relate to"
          },
          "customFields": {
            "href": "/projects/arquitectura-3/settings/custom_fields",
            "type": "text/html",
            "title": "Custom fields"
          },
          "configureForm": {
            "href": "/types/1/edit?tab=form_configuration",
            "type": "text/html",
            "title": "Configure form"
          },
          "activities": {
            "href": "/api/v3/work_packages/1504/activities"
          },
          "availableWatchers": {
            "href": "/api/v3/work_packages/1504/available_watchers"
          },
          "relations": {
            "href": "/api/v3/work_packages/1504/relations"
          },
          "revisions": {
            "href": "/api/v3/work_packages/1504/revisions"
          },
          "watchers": {
            "href": "/api/v3/work_packages/1504/watchers"
          },
          "addWatcher": {
            "href": "/api/v3/work_packages/1504/watchers",
            "method": "post",
            "payload": {
              "user": {
                "href": "/api/v3/users/{user_id}"
              }
            },
            "templated": true
          },
          "removeWatcher": {
            "href": "/api/v3/work_packages/1504/watchers/{user_id}",
            "method": "delete",
            "templated": true
          },
          "addRelation": {
            "href": "/api/v3/work_packages/1504/relations",
            "method": "post",
            "title": "Add relation"
          },
          "addChild": {
            "href": "/api/v3/projects/arquitectura-3/work_packages",
            "method": "post",
            "title": "Add child of Modelado de cubiertas"
          },
          "changeParent": {
            "href": "/api/v3/work_packages/1504",
            "method": "patch",
            "title": "Change parent of Modelado de cubiertas"
          },
          "addComment": {
            "href": "/api/v3/work_packages/1504/activities",
            "method": "post",
            "title": "Add comment"
          },
          "previewMarkup": {
            "href": "/api/v3/render/markdown?context=/api/v3/work_packages/1504",
            "method": "post"
          },
          "timeEntries": {
            "href": "/api/v3/time_entries?filters=%5B%7B%22work_package_id%22%3A%7B%22operator%22%3A%22%3D%22%2C%22values%22%3A%5B%221504%22%5D%7D%7D%5D",
            "title": "Time entries"
          },
          "category": {
            "href": null
          },
          "type": {
            "href": "/api/v3/types/1",
            "title": "Tarea"
          },
          "priority": {
            "href": "/api/v3/priorities/4",
            "title": "Baja"
          },
          "project": {
            "href": "/api/v3/projects/686",
            "title": "ARQUITECTURA"
          },
          "projectPhaseDefinition": {
            "href": null,
            "title": null
          },
          "status": {
            "href": "/api/v3/statuses/1",
            "title": "(WIP) Trabajo en progresos"
          },
          "author": {
            "href": "/api/v3/users/4",
            "title": "Francis Vin"
          },
          "responsible": {
            "href": "/api/v3/groups/6",
            "title": "Coordinador BIM"
          },
          "assignee": {
            "href": "/api/v3/users/599",
            "title": "Modelador bim"
          },
          "version": {
            "href": null
          },
          "budget": {
            "href": "/api/v3/budgets/8",
            "title": "Presupuesto total Arquitectura LOD 300"
          },
          "logCosts": {
            "href": "/work_packages/1504/cost_entries/new",
            "type": "text/html",
            "title": "Log costs on Modelado de cubiertas"
          },
          "showCosts": {
            "href": "/projects/686/cost_reports?fields%5B%5D=WorkPackageId&operators%5BWorkPackageId%5D=%3D&set_filter=1&values%5BWorkPackageId%5D=1504",
            "type": "text/html",
            "title": "Show cost entries"
          },
          "costsByType": {
            "href": "/api/v3/work_packages/1504/summarized_costs_by_type"
          },
          "github_pull_requests": {
            "href": "/api/v3/work_packages/1504/github_pull_requests",
            "title": "GitHub pull requests"
          },
          "gitlab_merge_requests": {
            "href": "/api/v3/work_packages/1504/gitlab_merge_requests",
            "title": "Gitlab merge requests"
          },
          "gitlab_issues": {
            "href": "/api/v3/work_packages/1504/gitlab_issues",
            "title": "Gitlab Issues"
          },
          "meetings": {
            "href": "/work_packages/1504/tabs/meetings",
            "title": "meetings"
          },
          "convertBCF": {
            "href": "/api/bcf/2.1/projects/arquitectura-3/topics",
            "title": "Convert to BCF",
            "payload": {
              "reference_links": [
                "/api/v3/work_packages/1504"
              ]
            },
            "method": "post"
          },
          "customField3": {
            "href": null,
            "title": null
          },
          "customField4": {
            "href": null,
            "title": null
          },
          "customField5": {
            "href": null,
            "title": null
          },
          "customField6": {
            "href": null,
            "title": null
          },
          "customField9": {
            "href": null,
            "title": null
          },
          "customField12": {
            "title": "PIM – Diseño",
            "href": "/api/v3/custom_options/193"
          },
          "customField11": {
            "href": null,
            "title": null
          },
          "self": {
            "href": "/api/v3/work_packages/1504",
            "title": "Modelado de cubiertas"
          },
          "unwatch": {
            "href": "/api/v3/work_packages/1504/watchers/4",
            "method": "delete"
          },
          "ancestors": [
            {
              "href": "/api/v3/work_packages/1499",
              "title": "FASE 2 - Modelado Arquitectónico LOD 300"
            }
          ],
          "parent": {
            "href": "/api/v3/work_packages/1499",
            "title": "FASE 2 - Modelado Arquitectónico LOD 300"
          },
          "customActions": []
        }
      },
      {
        "derivedStartDate": null,
        "derivedDueDate": null,
        "spentTime": "PT6H",
        "laborCosts": "168,00 SOL",
        "materialCosts": "0,00 SOL",
        "overallCosts": "168,00 SOL",
        "_type": "WorkPackage",
        "id": 1505,
        "lockVersion": 14,
        "subject": "Modelado de barandas y escaleras",
        "description": {
          "format": "markdown",
          "raw": "",
          "html": ""
        },
        "scheduleManually": true,
        "startDate": "2026-01-31",
        "dueDate": "2026-02-14",
        "estimatedTime": "PT12H",
        "derivedEstimatedTime": null,
        "remainingTime": "PT6H",
        "derivedRemainingTime": null,
        "duration": "P15D",
        "ignoreNonWorkingDays": false,
        "percentageDone": 50,
        "derivedPercentageDone": null,
        "createdAt": "2025-12-19T23:35:07.815Z",
        "updatedAt": "2025-12-20T03:17:11.582Z",
        "readonly": false,
        "customField1": null,
        "customField2": null,
        "customField7": null,
        "customField8": null,
        "_links": {
          "addAttachment": {
            "href": "/api/v3/work_packages/1505/attachments",
            "method": "post"
          },
          "fileLinks": {
            "href": "/api/v3/work_packages/1505/file_links"
          },
          "addFileLink": {
            "href": "/api/v3/work_packages/1505/file_links",
            "method": "post"
          },
          "update": {
            "href": "/api/v3/work_packages/1505/form",
            "method": "post"
          },
          "schema": {
            "href": "/api/v3/work_packages/schemas/686-1"
          },
          "updateImmediately": {
            "href": "/api/v3/work_packages/1505",
            "method": "patch"
          },
          "delete": {
            "href": "/api/v3/work_packages/1505",
            "method": "delete"
          },
          "logTime": {
            "href": "/api/v3/time_entries",
            "title": "Log time on work package 'Modelado de barandas y escaleras'"
          },
          "move": {
            "href": "/work_packages/1505/move/new",
            "type": "text/html",
            "title": "Move work package 'Modelado de barandas y escaleras'"
          },
          "copy": {
            "href": "/work_packages/1505/copy",
            "type": "text/html",
            "title": "Copy work package 'Modelado de barandas y escaleras'"
          },
          "pdf": {
            "href": "/work_packages/1505.pdf",
            "type": "application/pdf",
            "title": "Export as PDF"
          },
          "generate_pdf": {
            "href": "/work_packages/1505/generate_pdf_dialog",
            "type": "text/vnd.turbo-stream.html",
            "title": "Generate PDF"
          },
          "atom": {
            "href": "/work_packages/1505.atom",
            "type": "application/rss+xml",
            "title": "Atom feed"
          },
          "availableRelationCandidates": {
            "href": "/api/v3/work_packages/1505/available_relation_candidates",
            "title": "Potential work packages to relate to"
          },
          "customFields": {
            "href": "/projects/arquitectura-3/settings/custom_fields",
            "type": "text/html",
            "title": "Custom fields"
          },
          "configureForm": {
            "href": "/types/1/edit?tab=form_configuration",
            "type": "text/html",
            "title": "Configure form"
          },
          "activities": {
            "href": "/api/v3/work_packages/1505/activities"
          },
          "availableWatchers": {
            "href": "/api/v3/work_packages/1505/available_watchers"
          },
          "relations": {
            "href": "/api/v3/work_packages/1505/relations"
          },
          "revisions": {
            "href": "/api/v3/work_packages/1505/revisions"
          },
          "watchers": {
            "href": "/api/v3/work_packages/1505/watchers"
          },
          "addWatcher": {
            "href": "/api/v3/work_packages/1505/watchers",
            "method": "post",
            "payload": {
              "user": {
                "href": "/api/v3/users/{user_id}"
              }
            },
            "templated": true
          },
          "removeWatcher": {
            "href": "/api/v3/work_packages/1505/watchers/{user_id}",
            "method": "delete",
            "templated": true
          },
          "addRelation": {
            "href": "/api/v3/work_packages/1505/relations",
            "method": "post",
            "title": "Add relation"
          },
          "addChild": {
            "href": "/api/v3/projects/arquitectura-3/work_packages",
            "method": "post",
            "title": "Add child of Modelado de barandas y escaleras"
          },
          "changeParent": {
            "href": "/api/v3/work_packages/1505",
            "method": "patch",
            "title": "Change parent of Modelado de barandas y escaleras"
          },
          "addComment": {
            "href": "/api/v3/work_packages/1505/activities",
            "method": "post",
            "title": "Add comment"
          },
          "previewMarkup": {
            "href": "/api/v3/render/markdown?context=/api/v3/work_packages/1505",
            "method": "post"
          },
          "timeEntries": {
            "href": "/api/v3/time_entries?filters=%5B%7B%22work_package_id%22%3A%7B%22operator%22%3A%22%3D%22%2C%22values%22%3A%5B%221505%22%5D%7D%7D%5D",
            "title": "Time entries"
          },
          "category": {
            "href": null
          },
          "type": {
            "href": "/api/v3/types/1",
            "title": "Tarea"
          },
          "priority": {
            "href": "/api/v3/priorities/4",
            "title": "Baja"
          },
          "project": {
            "href": "/api/v3/projects/686",
            "title": "ARQUITECTURA"
          },
          "projectPhaseDefinition": {
            "href": null,
            "title": null
          },
          "status": {
            "href": "/api/v3/statuses/1",
            "title": "(WIP) Trabajo en progresos"
          },
          "author": {
            "href": "/api/v3/users/4",
            "title": "Francis Vin"
          },
          "responsible": {
            "href": "/api/v3/groups/6",
            "title": "Coordinador BIM"
          },
          "assignee": {
            "href": "/api/v3/users/599",
            "title": "Modelador bim"
          },
          "version": {
            "href": null
          },
          "budget": {
            "href": "/api/v3/budgets/8",
            "title": "Presupuesto total Arquitectura LOD 300"
          },
          "logCosts": {
            "href": "/work_packages/1505/cost_entries/new",
            "type": "text/html",
            "title": "Log costs on Modelado de barandas y escaleras"
          },
          "showCosts": {
            "href": "/projects/686/cost_reports?fields%5B%5D=WorkPackageId&operators%5BWorkPackageId%5D=%3D&set_filter=1&values%5BWorkPackageId%5D=1505",
            "type": "text/html",
            "title": "Show cost entries"
          },
          "costsByType": {
            "href": "/api/v3/work_packages/1505/summarized_costs_by_type"
          },
          "github_pull_requests": {
            "href": "/api/v3/work_packages/1505/github_pull_requests",
            "title": "GitHub pull requests"
          },
          "gitlab_merge_requests": {
            "href": "/api/v3/work_packages/1505/gitlab_merge_requests",
            "title": "Gitlab merge requests"
          },
          "gitlab_issues": {
            "href": "/api/v3/work_packages/1505/gitlab_issues",
            "title": "Gitlab Issues"
          },
          "meetings": {
            "href": "/work_packages/1505/tabs/meetings",
            "title": "meetings"
          },
          "convertBCF": {
            "href": "/api/bcf/2.1/projects/arquitectura-3/topics",
            "title": "Convert to BCF",
            "payload": {
              "reference_links": [
                "/api/v3/work_packages/1505"
              ]
            },
            "method": "post"
          },
          "customField3": {
            "href": null,
            "title": null
          },
          "customField4": {
            "href": null,
            "title": null
          },
          "customField5": {
            "href": null,
            "title": null
          },
          "customField6": {
            "href": null,
            "title": null
          },
          "customField9": {
            "href": null,
            "title": null
          },
          "customField12": {
            "title": "PIM – Diseño",
            "href": "/api/v3/custom_options/193"
          },
          "customField11": {
            "href": null,
            "title": null
          },
          "self": {
            "href": "/api/v3/work_packages/1505",
            "title": "Modelado de barandas y escaleras"
          },
          "unwatch": {
            "href": "/api/v3/work_packages/1505/watchers/4",
            "method": "delete"
          },
          "ancestors": [
            {
              "href": "/api/v3/work_packages/1499",
              "title": "FASE 2 - Modelado Arquitectónico LOD 300"
            }
          ],
          "parent": {
            "href": "/api/v3/work_packages/1499",
            "title": "FASE 2 - Modelado Arquitectónico LOD 300"
          },
          "customActions": []
        }
      },
      {
        "derivedStartDate": null,
        "derivedDueDate": null,
        "spentTime": "PT6H",
        "laborCosts": "168,00 SOL",
        "materialCosts": "0,00 SOL",
        "overallCosts": "168,00 SOL",
        "_type": "WorkPackage",
        "id": 1506,
        "lockVersion": 9,
        "subject": "Modelado de elementos arquitectónicos detallados",
        "description": {
          "format": "markdown",
          "raw": "",
          "html": ""
        },
        "scheduleManually": true,
        "startDate": "2026-02-06",
        "dueDate": "2026-02-19",
        "estimatedTime": "PT12H",
        "derivedEstimatedTime": null,
        "remainingTime": "PT4H48M",
        "derivedRemainingTime": null,
        "duration": "P14D",
        "ignoreNonWorkingDays": false,
        "percentageDone": 60,
        "derivedPercentageDone": null,
        "createdAt": "2025-12-19T23:35:13.529Z",
        "updatedAt": "2025-12-20T03:17:15.800Z",
        "readonly": false,
        "customField1": null,
        "customField2": null,
        "customField7": null,
        "customField8": null,
        "_links": {
          "addAttachment": {
            "href": "/api/v3/work_packages/1506/attachments",
            "method": "post"
          },
          "fileLinks": {
            "href": "/api/v3/work_packages/1506/file_links"
          },
          "addFileLink": {
            "href": "/api/v3/work_packages/1506/file_links",
            "method": "post"
          },
          "update": {
            "href": "/api/v3/work_packages/1506/form",
            "method": "post"
          },
          "schema": {
            "href": "/api/v3/work_packages/schemas/686-1"
          },
          "updateImmediately": {
            "href": "/api/v3/work_packages/1506",
            "method": "patch"
          },
          "delete": {
            "href": "/api/v3/work_packages/1506",
            "method": "delete"
          },
          "logTime": {
            "href": "/api/v3/time_entries",
            "title": "Log time on work package 'Modelado de elementos arquitectónicos detallados'"
          },
          "move": {
            "href": "/work_packages/1506/move/new",
            "type": "text/html",
            "title": "Move work package 'Modelado de elementos arquitectónicos detallados'"
          },
          "copy": {
            "href": "/work_packages/1506/copy",
            "type": "text/html",
            "title": "Copy work package 'Modelado de elementos arquitectónicos detallados'"
          },
          "pdf": {
            "href": "/work_packages/1506.pdf",
            "type": "application/pdf",
            "title": "Export as PDF"
          },
          "generate_pdf": {
            "href": "/work_packages/1506/generate_pdf_dialog",
            "type": "text/vnd.turbo-stream.html",
            "title": "Generate PDF"
          },
          "atom": {
            "href": "/work_packages/1506.atom",
            "type": "application/rss+xml",
            "title": "Atom feed"
          },
          "availableRelationCandidates": {
            "href": "/api/v3/work_packages/1506/available_relation_candidates",
            "title": "Potential work packages to relate to"
          },
          "customFields": {
            "href": "/projects/arquitectura-3/settings/custom_fields",
            "type": "text/html",
            "title": "Custom fields"
          },
          "configureForm": {
            "href": "/types/1/edit?tab=form_configuration",
            "type": "text/html",
            "title": "Configure form"
          },
          "activities": {
            "href": "/api/v3/work_packages/1506/activities"
          },
          "availableWatchers": {
            "href": "/api/v3/work_packages/1506/available_watchers"
          },
          "relations": {
            "href": "/api/v3/work_packages/1506/relations"
          },
          "revisions": {
            "href": "/api/v3/work_packages/1506/revisions"
          },
          "watchers": {
            "href": "/api/v3/work_packages/1506/watchers"
          },
          "addWatcher": {
            "href": "/api/v3/work_packages/1506/watchers",
            "method": "post",
            "payload": {
              "user": {
                "href": "/api/v3/users/{user_id}"
              }
            },
            "templated": true
          },
          "removeWatcher": {
            "href": "/api/v3/work_packages/1506/watchers/{user_id}",
            "method": "delete",
            "templated": true
          },
          "addRelation": {
            "href": "/api/v3/work_packages/1506/relations",
            "method": "post",
            "title": "Add relation"
          },
          "addChild": {
            "href": "/api/v3/projects/arquitectura-3/work_packages",
            "method": "post",
            "title": "Add child of Modelado de elementos arquitectónicos detallados"
          },
          "changeParent": {
            "href": "/api/v3/work_packages/1506",
            "method": "patch",
            "title": "Change parent of Modelado de elementos arquitectónicos detallados"
          },
          "addComment": {
            "href": "/api/v3/work_packages/1506/activities",
            "method": "post",
            "title": "Add comment"
          },
          "previewMarkup": {
            "href": "/api/v3/render/markdown?context=/api/v3/work_packages/1506",
            "method": "post"
          },
          "timeEntries": {
            "href": "/api/v3/time_entries?filters=%5B%7B%22work_package_id%22%3A%7B%22operator%22%3A%22%3D%22%2C%22values%22%3A%5B%221506%22%5D%7D%7D%5D",
            "title": "Time entries"
          },
          "category": {
            "href": null
          },
          "type": {
            "href": "/api/v3/types/1",
            "title": "Tarea"
          },
          "priority": {
            "href": "/api/v3/priorities/4",
            "title": "Baja"
          },
          "project": {
            "href": "/api/v3/projects/686",
            "title": "ARQUITECTURA"
          },
          "projectPhaseDefinition": {
            "href": null,
            "title": null
          },
          "status": {
            "href": "/api/v3/statuses/1",
            "title": "(WIP) Trabajo en progresos"
          },
          "author": {
            "href": "/api/v3/users/4",
            "title": "Francis Vin"
          },
          "responsible": {
            "href": "/api/v3/groups/6",
            "title": "Coordinador BIM"
          },
          "assignee": {
            "href": "/api/v3/users/599",
            "title": "Modelador bim"
          },
          "version": {
            "href": null
          },
          "budget": {
            "href": "/api/v3/budgets/8",
            "title": "Presupuesto total Arquitectura LOD 300"
          },
          "logCosts": {
            "href": "/work_packages/1506/cost_entries/new",
            "type": "text/html",
            "title": "Log costs on Modelado de elementos arquitectónicos detallados"
          },
          "showCosts": {
            "href": "/projects/686/cost_reports?fields%5B%5D=WorkPackageId&operators%5BWorkPackageId%5D=%3D&set_filter=1&values%5BWorkPackageId%5D=1506",
            "type": "text/html",
            "title": "Show cost entries"
          },
          "costsByType": {
            "href": "/api/v3/work_packages/1506/summarized_costs_by_type"
          },
          "github_pull_requests": {
            "href": "/api/v3/work_packages/1506/github_pull_requests",
            "title": "GitHub pull requests"
          },
          "gitlab_merge_requests": {
            "href": "/api/v3/work_packages/1506/gitlab_merge_requests",
            "title": "Gitlab merge requests"
          },
          "gitlab_issues": {
            "href": "/api/v3/work_packages/1506/gitlab_issues",
            "title": "Gitlab Issues"
          },
          "meetings": {
            "href": "/work_packages/1506/tabs/meetings",
            "title": "meetings"
          },
          "convertBCF": {
            "href": "/api/bcf/2.1/projects/arquitectura-3/topics",
            "title": "Convert to BCF",
            "payload": {
              "reference_links": [
                "/api/v3/work_packages/1506"
              ]
            },
            "method": "post"
          },
          "customField3": {
            "href": null,
            "title": null
          },
          "customField4": {
            "href": null,
            "title": null
          },
          "customField5": {
            "href": null,
            "title": null
          },
          "customField6": {
            "href": null,
            "title": null
          },
          "customField9": {
            "href": null,
            "title": null
          },
          "customField12": {
            "title": "PIM – Diseño",
            "href": "/api/v3/custom_options/193"
          },
          "customField11": {
            "href": null,
            "title": null
          },
          "self": {
            "href": "/api/v3/work_packages/1506",
            "title": "Modelado de elementos arquitectónicos detallados"
          },
          "unwatch": {
            "href": "/api/v3/work_packages/1506/watchers/4",
            "method": "delete"
          },
          "ancestors": [
            {
              "href": "/api/v3/work_packages/1499",
              "title": "FASE 2 - Modelado Arquitectónico LOD 300"
            }
          ],
          "parent": {
            "href": "/api/v3/work_packages/1499",
            "title": "FASE 2 - Modelado Arquitectónico LOD 300"
          },
          "customActions": []
        }
      },
      {
        "derivedStartDate": null,
        "derivedDueDate": null,
        "spentTime": "PT1H",
        "laborCosts": "28,00 SOL",
        "materialCosts": "0,00 SOL",
        "overallCosts": "28,00 SOL",
        "_type": "WorkPackage",
        "id": 1507,
        "lockVersion": 12,
        "subject": "Modelado de materiales (acabados)",
        "description": {
          "format": "markdown",
          "raw": "",
          "html": ""
        },
        "scheduleManually": true,
        "startDate": "2026-02-09",
        "dueDate": "2026-02-24",
        "estimatedTime": "PT8H",
        "derivedEstimatedTime": null,
        "remainingTime": "PT7H12M",
        "derivedRemainingTime": null,
        "duration": "P16D",
        "ignoreNonWorkingDays": false,
        "percentageDone": 10,
        "derivedPercentageDone": null,
        "createdAt": "2025-12-19T23:35:18.962Z",
        "updatedAt": "2025-12-20T03:17:21.052Z",
        "readonly": false,
        "customField1": null,
        "customField2": null,
        "customField7": null,
        "customField8": null,
        "_links": {
          "addAttachment": {
            "href": "/api/v3/work_packages/1507/attachments",
            "method": "post"
          },
          "fileLinks": {
            "href": "/api/v3/work_packages/1507/file_links"
          },
          "addFileLink": {
            "href": "/api/v3/work_packages/1507/file_links",
            "method": "post"
          },
          "update": {
            "href": "/api/v3/work_packages/1507/form",
            "method": "post"
          },
          "schema": {
            "href": "/api/v3/work_packages/schemas/686-1"
          },
          "updateImmediately": {
            "href": "/api/v3/work_packages/1507",
            "method": "patch"
          },
          "delete": {
            "href": "/api/v3/work_packages/1507",
            "method": "delete"
          },
          "logTime": {
            "href": "/api/v3/time_entries",
            "title": "Log time on work package 'Modelado de materiales (acabados)'"
          },
          "move": {
            "href": "/work_packages/1507/move/new",
            "type": "text/html",
            "title": "Move work package 'Modelado de materiales (acabados)'"
          },
          "copy": {
            "href": "/work_packages/1507/copy",
            "type": "text/html",
            "title": "Copy work package 'Modelado de materiales (acabados)'"
          },
          "pdf": {
            "href": "/work_packages/1507.pdf",
            "type": "application/pdf",
            "title": "Export as PDF"
          },
          "generate_pdf": {
            "href": "/work_packages/1507/generate_pdf_dialog",
            "type": "text/vnd.turbo-stream.html",
            "title": "Generate PDF"
          },
          "atom": {
            "href": "/work_packages/1507.atom",
            "type": "application/rss+xml",
            "title": "Atom feed"
          },
          "availableRelationCandidates": {
            "href": "/api/v3/work_packages/1507/available_relation_candidates",
            "title": "Potential work packages to relate to"
          },
          "customFields": {
            "href": "/projects/arquitectura-3/settings/custom_fields",
            "type": "text/html",
            "title": "Custom fields"
          },
          "configureForm": {
            "href": "/types/1/edit?tab=form_configuration",
            "type": "text/html",
            "title": "Configure form"
          },
          "activities": {
            "href": "/api/v3/work_packages/1507/activities"
          },
          "availableWatchers": {
            "href": "/api/v3/work_packages/1507/available_watchers"
          },
          "relations": {
            "href": "/api/v3/work_packages/1507/relations"
          },
          "revisions": {
            "href": "/api/v3/work_packages/1507/revisions"
          },
          "watchers": {
            "href": "/api/v3/work_packages/1507/watchers"
          },
          "addWatcher": {
            "href": "/api/v3/work_packages/1507/watchers",
            "method": "post",
            "payload": {
              "user": {
                "href": "/api/v3/users/{user_id}"
              }
            },
            "templated": true
          },
          "removeWatcher": {
            "href": "/api/v3/work_packages/1507/watchers/{user_id}",
            "method": "delete",
            "templated": true
          },
          "addRelation": {
            "href": "/api/v3/work_packages/1507/relations",
            "method": "post",
            "title": "Add relation"
          },
          "addChild": {
            "href": "/api/v3/projects/arquitectura-3/work_packages",
            "method": "post",
            "title": "Add child of Modelado de materiales (acabados)"
          },
          "changeParent": {
            "href": "/api/v3/work_packages/1507",
            "method": "patch",
            "title": "Change parent of Modelado de materiales (acabados)"
          },
          "addComment": {
            "href": "/api/v3/work_packages/1507/activities",
            "method": "post",
            "title": "Add comment"
          },
          "previewMarkup": {
            "href": "/api/v3/render/markdown?context=/api/v3/work_packages/1507",
            "method": "post"
          },
          "timeEntries": {
            "href": "/api/v3/time_entries?filters=%5B%7B%22work_package_id%22%3A%7B%22operator%22%3A%22%3D%22%2C%22values%22%3A%5B%221507%22%5D%7D%7D%5D",
            "title": "Time entries"
          },
          "category": {
            "href": null
          },
          "type": {
            "href": "/api/v3/types/1",
            "title": "Tarea"
          },
          "priority": {
            "href": "/api/v3/priorities/4",
            "title": "Baja"
          },
          "project": {
            "href": "/api/v3/projects/686",
            "title": "ARQUITECTURA"
          },
          "projectPhaseDefinition": {
            "href": null,
            "title": null
          },
          "status": {
            "href": "/api/v3/statuses/1",
            "title": "(WIP) Trabajo en progresos"
          },
          "author": {
            "href": "/api/v3/users/4",
            "title": "Francis Vin"
          },
          "responsible": {
            "href": "/api/v3/groups/6",
            "title": "Coordinador BIM"
          },
          "assignee": {
            "href": "/api/v3/users/599",
            "title": "Modelador bim"
          },
          "version": {
            "href": null
          },
          "budget": {
            "href": "/api/v3/budgets/8",
            "title": "Presupuesto total Arquitectura LOD 300"
          },
          "logCosts": {
            "href": "/work_packages/1507/cost_entries/new",
            "type": "text/html",
            "title": "Log costs on Modelado de materiales (acabados)"
          },
          "showCosts": {
            "href": "/projects/686/cost_reports?fields%5B%5D=WorkPackageId&operators%5BWorkPackageId%5D=%3D&set_filter=1&values%5BWorkPackageId%5D=1507",
            "type": "text/html",
            "title": "Show cost entries"
          },
          "costsByType": {
            "href": "/api/v3/work_packages/1507/summarized_costs_by_type"
          },
          "github_pull_requests": {
            "href": "/api/v3/work_packages/1507/github_pull_requests",
            "title": "GitHub pull requests"
          },
          "gitlab_merge_requests": {
            "href": "/api/v3/work_packages/1507/gitlab_merge_requests",
            "title": "Gitlab merge requests"
          },
          "gitlab_issues": {
            "href": "/api/v3/work_packages/1507/gitlab_issues",
            "title": "Gitlab Issues"
          },
          "meetings": {
            "href": "/work_packages/1507/tabs/meetings",
            "title": "meetings"
          },
          "convertBCF": {
            "href": "/api/bcf/2.1/projects/arquitectura-3/topics",
            "title": "Convert to BCF",
            "payload": {
              "reference_links": [
                "/api/v3/work_packages/1507"
              ]
            },
            "method": "post"
          },
          "customField3": {
            "href": null,
            "title": null
          },
          "customField4": {
            "href": null,
            "title": null
          },
          "customField5": {
            "href": null,
            "title": null
          },
          "customField6": {
            "href": null,
            "title": null
          },
          "customField9": {
            "href": null,
            "title": null
          },
          "customField12": {
            "title": "PIM – Diseño",
            "href": "/api/v3/custom_options/193"
          },
          "customField11": {
            "href": null,
            "title": null
          },
          "self": {
            "href": "/api/v3/work_packages/1507",
            "title": "Modelado de materiales (acabados)"
          },
          "unwatch": {
            "href": "/api/v3/work_packages/1507/watchers/4",
            "method": "delete"
          },
          "ancestors": [
            {
              "href": "/api/v3/work_packages/1499",
              "title": "FASE 2 - Modelado Arquitectónico LOD 300"
            }
          ],
          "parent": {
            "href": "/api/v3/work_packages/1499",
            "title": "FASE 2 - Modelado Arquitectónico LOD 300"
          },
          "customActions": []
        }
      },
      {
        "spentTime": "PT0S",
        "laborCosts": "0,00 SOL",
        "materialCosts": "0,00 SOL",
        "overallCosts": "0,00 SOL",
        "_type": "WorkPackage",
        "id": 1509,
        "lockVersion": 7,
        "subject": "Hito 2 - Revisión de modelado",
        "description": {
          "format": "markdown",
          "raw": "*   [ ] Modelo Arquitectónico LOD 300 completo\n*   [ ] Vistas 3D de revisión\n*   [ ] Vistas 2D básicas (planta, cortes)",
          "html": "<ul class=\"op-uc-list_task-list op-uc-list\">\n<li class=\"op-uc-list--item\">\n<input type=\"checkbox\" class=\"op-uc-list--task-checkbox\" disabled> Modelo Arquitectónico LOD 300 completo</li>\n<li class=\"op-uc-list--item\">\n<input type=\"checkbox\" class=\"op-uc-list--task-checkbox\" disabled> Vistas 3D de revisión</li>\n<li class=\"op-uc-list--item\">\n<input type=\"checkbox\" class=\"op-uc-list--task-checkbox\" disabled> Vistas 2D básicas (planta, cortes)</li>\n</ul>"
        },
        "scheduleManually": true,
        "date": "2026-02-24",
        "estimatedTime": null,
        "derivedEstimatedTime": null,
        "derivedRemainingTime": null,
        "ignoreNonWorkingDays": false,
        "percentageDone": null,
        "derivedPercentageDone": null,
        "createdAt": "2025-12-19T23:47:39.232Z",
        "updatedAt": "2025-12-20T00:32:00.715Z",
        "readonly": false,
        "customField1": null,
        "customField7": null,
        "customField2": null,
        "customField8": null,
        "_links": {
          "addAttachment": {
            "href": "/api/v3/work_packages/1509/attachments",
            "method": "post"
          },
          "fileLinks": {
            "href": "/api/v3/work_packages/1509/file_links"
          },
          "addFileLink": {
            "href": "/api/v3/work_packages/1509/file_links",
            "method": "post"
          },
          "update": {
            "href": "/api/v3/work_packages/1509/form",
            "method": "post"
          },
          "schema": {
            "href": "/api/v3/work_packages/schemas/686-2"
          },
          "updateImmediately": {
            "href": "/api/v3/work_packages/1509",
            "method": "patch"
          },
          "delete": {
            "href": "/api/v3/work_packages/1509",
            "method": "delete"
          },
          "logTime": {
            "href": "/api/v3/time_entries",
            "title": "Log time on work package 'Hito 2 - Revisión de modelado'"
          },
          "move": {
            "href": "/work_packages/1509/move/new",
            "type": "text/html",
            "title": "Move work package 'Hito 2 - Revisión de modelado'"
          },
          "copy": {
            "href": "/work_packages/1509/copy",
            "type": "text/html",
            "title": "Copy work package 'Hito 2 - Revisión de modelado'"
          },
          "pdf": {
            "href": "/work_packages/1509.pdf",
            "type": "application/pdf",
            "title": "Export as PDF"
          },
          "generate_pdf": {
            "href": "/work_packages/1509/generate_pdf_dialog",
            "type": "text/vnd.turbo-stream.html",
            "title": "Generate PDF"
          },
          "atom": {
            "href": "/work_packages/1509.atom",
            "type": "application/rss+xml",
            "title": "Atom feed"
          },
          "availableRelationCandidates": {
            "href": "/api/v3/work_packages/1509/available_relation_candidates",
            "title": "Potential work packages to relate to"
          },
          "customFields": {
            "href": "/projects/arquitectura-3/settings/custom_fields",
            "type": "text/html",
            "title": "Custom fields"
          },
          "configureForm": {
            "href": "/types/2/edit?tab=form_configuration",
            "type": "text/html",
            "title": "Configure form"
          },
          "activities": {
            "href": "/api/v3/work_packages/1509/activities"
          },
          "availableWatchers": {
            "href": "/api/v3/work_packages/1509/available_watchers"
          },
          "relations": {
            "href": "/api/v3/work_packages/1509/relations"
          },
          "revisions": {
            "href": "/api/v3/work_packages/1509/revisions"
          },
          "watchers": {
            "href": "/api/v3/work_packages/1509/watchers"
          },
          "addWatcher": {
            "href": "/api/v3/work_packages/1509/watchers",
            "method": "post",
            "payload": {
              "user": {
                "href": "/api/v3/users/{user_id}"
              }
            },
            "templated": true
          },
          "removeWatcher": {
            "href": "/api/v3/work_packages/1509/watchers/{user_id}",
            "method": "delete",
            "templated": true
          },
          "addRelation": {
            "href": "/api/v3/work_packages/1509/relations",
            "method": "post",
            "title": "Add relation"
          },
          "changeParent": {
            "href": "/api/v3/work_packages/1509",
            "method": "patch",
            "title": "Change parent of Hito 2 - Revisión de modelado"
          },
          "addComment": {
            "href": "/api/v3/work_packages/1509/activities",
            "method": "post",
            "title": "Add comment"
          },
          "previewMarkup": {
            "href": "/api/v3/render/markdown?context=/api/v3/work_packages/1509",
            "method": "post"
          },
          "timeEntries": {
            "href": "/api/v3/time_entries?filters=%5B%7B%22work_package_id%22%3A%7B%22operator%22%3A%22%3D%22%2C%22values%22%3A%5B%221509%22%5D%7D%7D%5D",
            "title": "Time entries"
          },
          "category": {
            "href": null
          },
          "type": {
            "href": "/api/v3/types/2",
            "title": "Hito"
          },
          "priority": {
            "href": "/api/v3/priorities/4",
            "title": "Baja"
          },
          "project": {
            "href": "/api/v3/projects/686",
            "title": "ARQUITECTURA"
          },
          "projectPhaseDefinition": {
            "href": null,
            "title": null
          },
          "status": {
            "href": "/api/v3/statuses/1",
            "title": "(WIP) Trabajo en progresos"
          },
          "author": {
            "href": "/api/v3/users/4",
            "title": "Francis Vin"
          },
          "responsible": {
            "href": "/api/v3/groups/16",
            "title": "BIM Manager"
          },
          "assignee": {
            "href": "/api/v3/groups/6",
            "title": "Coordinador BIM"
          },
          "version": {
            "href": null
          },
          "budget": {
            "href": null
          },
          "logCosts": {
            "href": "/work_packages/1509/cost_entries/new",
            "type": "text/html",
            "title": "Log costs on Hito 2 - Revisión de modelado"
          },
          "showCosts": {
            "href": "/projects/686/cost_reports?fields%5B%5D=WorkPackageId&operators%5BWorkPackageId%5D=%3D&set_filter=1&values%5BWorkPackageId%5D=1509",
            "type": "text/html",
            "title": "Show cost entries"
          },
          "costsByType": {
            "href": "/api/v3/work_packages/1509/summarized_costs_by_type"
          },
          "github_pull_requests": {
            "href": "/api/v3/work_packages/1509/github_pull_requests",
            "title": "GitHub pull requests"
          },
          "gitlab_merge_requests": {
            "href": "/api/v3/work_packages/1509/gitlab_merge_requests",
            "title": "Gitlab merge requests"
          },
          "gitlab_issues": {
            "href": "/api/v3/work_packages/1509/gitlab_issues",
            "title": "Gitlab Issues"
          },
          "meetings": {
            "href": "/work_packages/1509/tabs/meetings",
            "title": "meetings"
          },
          "convertBCF": {
            "href": "/api/bcf/2.1/projects/arquitectura-3/topics",
            "title": "Convert to BCF",
            "payload": {
              "reference_links": [
                "/api/v3/work_packages/1509"
              ]
            },
            "method": "post"
          },
          "customField5": {
            "href": null,
            "title": null
          },
          "customField9": {
            "href": null,
            "title": null
          },
          "customField12": {
            "title": "PIM – Diseño",
            "href": "/api/v3/custom_options/193"
          },
          "customField3": {
            "href": null,
            "title": null
          },
          "customField4": {
            "href": null,
            "title": null
          },
          "customField6": {
            "href": null,
            "title": null
          },
          "self": {
            "href": "/api/v3/work_packages/1509",
            "title": "Hito 2 - Revisión de modelado"
          },
          "unwatch": {
            "href": "/api/v3/work_packages/1509/watchers/4",
            "method": "delete"
          },
          "ancestors": [
            {
              "href": "/api/v3/work_packages/1499",
              "title": "FASE 2 - Modelado Arquitectónico LOD 300"
            }
          ],
          "parent": {
            "href": "/api/v3/work_packages/1499",
            "title": "FASE 2 - Modelado Arquitectónico LOD 300"
          },
          "customActions": []
        }
      }
    ]
  },
  "_retrieval_info": {
    "mode": "full_retrieval",
    "total_retrieved": 17,
    "note": "All work packages retrieved successfully"
  }
}
`);

      let data;
      try {
        data = JSON.parse(raw);
      } catch (e) {
        data = fallback;
      }
      if (!data.items || !Array.isArray(data.items) || data.items.length === 0) {
        const embedded = data && data._embedded && data._embedded.elements;
        data.items = Array.isArray(embedded) ? embedded : [];
      }

      const fmtDate = (d) => d ? new Date(d).toISOString().slice(0, 10) : "--";
      const getStatus = (item) => {
        const linkStatus = item && item._links && item._links.status && item._links.status.title;
        return linkStatus || item.status || "--";
      };
      const statusPalette = [
        { bg: '#fef9c3', border: '#fde047', color: '#854d0e' }, // amarillo
        { bg: '#ffedd5', border: '#fdba74', color: '#9a3412' }, // naranja
        { bg: '#fee2e2', border: '#fca5a5', color: '#991b1b' }, // rojo
        { bg: '#dcfce7', border: '#86efac', color: '#166534' }, // verde
        { bg: '#e2e8f0', border: '#94a3b8', color: '#475569' }, // plomo
        { bg: '#dbeafe', border: '#60a5fa', color: '#1e40af' }, // azul
        { bg: '#f5f5f5', border: '#d4d4d4', color: '#404040' }  // neutro
      ];
      const statusColorCache = new Map();
      let statusColorIndex = 0;
      const hashStatus = (value) => {
        let hash = 0;
        for (let i = 0; i < value.length; i += 1) {
          hash = (hash * 31 + value.charCodeAt(i)) | 0;
        }
        return Math.abs(hash);
      };
      const getStatusStyle = (status) => {
        const value = String(status || '').trim();
        if (!value || value === '--') {
          return { className: 'status status-muted', style: '' };
        }
        if (!statusColorCache.has(value)) {
          let color;
          if (statusColorIndex < statusPalette.length) {
            color = statusPalette[statusColorIndex];
          } else {
            const hue = (statusColorIndex * 47) % 360;
            color = {
              bg: `hsl(${hue}, 85%, 85%)`,
              border: `hsl(${hue}, 70%, 60%)`,
              color: `hsl(${hue}, 40%, 25%)`
            };
          }
          statusColorCache.set(value, color);
          statusColorIndex += 1;
        }
        const color = statusColorCache.get(value);
        return {
          className: 'status',
          style: `background:${color.bg};color:${color.color};border:1px solid ${color.border};`
        };
      };
      const getTypeTitle = (item) => {
        return item && item._links && item._links.type && item._links.type.title;
      };
      const getParentId = (item) => {
        const href = item && item._links && item._links.parent && item._links.parent.href;
        if (!href) return null;
        const match = href.match(/work_packages\/(\d+)/);
        return match ? match[1] : null;
      };
      const parseCostNumber = (val) => {
        if (typeof val === 'number') return val;
        if (!val) return 0;
        const cleaned = String(val).replace(/[^0-9,.\-]/g, '').replace(',', '.');
        const num = Number(cleaned);
        return Number.isFinite(num) ? num : 0;
      };
      const parseDurationHours = (val) => {
        if (!val) return 0;
        const str = String(val);
        if (!str.startsWith('P')) return 0;
        let totalHours = 0;
        const dayMatch = str.match(/P(\d+)D/);
        if (dayMatch) totalHours += Number(dayMatch[1]) * 24;
        const timePart = str.split('T')[1] || '';
        const hourMatch = timePart.match(/(\d+)H/);
        const minMatch = timePart.match(/(\d+)M/);
        if (hourMatch) totalHours += Number(hourMatch[1]);
        if (minMatch) totalHours += Number(minMatch[1]) / 60;
        return Number.isFinite(totalHours) ? totalHours : 0;
      };
      const drawGauge = (canvas, value, labelText, color, displayValue) => {
        if (!canvas) return;
        const ctx = canvas.getContext('2d');
        const width = canvas.clientWidth || 200;
        const height = canvas.clientHeight || 110;
        const ratio = window.devicePixelRatio || 1;
        canvas.width = width * ratio;
        canvas.height = height * ratio;
        ctx.setTransform(1, 0, 0, 1, 0, 0);
        ctx.scale(ratio, ratio);
        ctx.clearRect(0, 0, width, height);

        const centerX = width / 2;
        const centerY = height * 0.9;
        const radius = Math.min(width * 0.42, height * 0.8);
        const start = Math.PI;
        const end = 2 * Math.PI;
        const pct = Math.max(0, Math.min(100, value));
        const angle = start + (pct / 100) * (end - start);

        ctx.lineWidth = 10;
        ctx.strokeStyle = '#e2e8f0';
        ctx.beginPath();
        ctx.arc(centerX, centerY, radius, start, end);
        ctx.stroke();

        ctx.strokeStyle = color || '#2563eb';
        ctx.beginPath();
        ctx.arc(centerX, centerY, radius, start, angle);
        ctx.stroke();

        const displayText = displayValue !== undefined && displayValue !== null
          ? String(displayValue)
          : `${pct.toFixed(1)}%`;
        ctx.fillStyle = '#0f172a';
        ctx.font = 'bold 16px Inter, sans-serif';
        ctx.textAlign = 'center';
        ctx.textBaseline = 'middle';
        ctx.fillText(displayText, centerX, centerY - radius * 0.55);

        ctx.fillStyle = '#64748b';
        ctx.font = '11px Inter, sans-serif';
        ctx.fillText(labelText || '', centerX, centerY - radius * 0.25);
      };

      const drawSegmentGauge = (canvas, segments, labelText, displayValue) => {
        if (!canvas) return;
        const ctx = canvas.getContext('2d');
        const width = canvas.clientWidth || 200;
        const height = canvas.clientHeight || 110;
        const ratio = window.devicePixelRatio || 1;
        canvas.width = width * ratio;
        canvas.height = height * ratio;
        ctx.setTransform(1, 0, 0, 1, 0, 0);
        ctx.scale(ratio, ratio);
        ctx.clearRect(0, 0, width, height);

        const centerX = width / 2;
        const centerY = height * 0.9;
        const radius = Math.min(width * 0.42, height * 0.8);
        const start = Math.PI;
        const end = 2 * Math.PI;
        const total = segments.reduce((sum, seg) => sum + seg.value, 0) || 1;

        let cursor = start;
        segments.forEach(seg => {
          const frac = seg.value / total;
          const segEnd = cursor + (end - start) * frac;
          ctx.lineWidth = 10;
          ctx.strokeStyle = seg.color;
          ctx.beginPath();
          ctx.arc(centerX, centerY, radius, cursor, segEnd);
          ctx.stroke();
          cursor = segEnd;
        });

        ctx.fillStyle = '#0f172a';
        ctx.font = 'bold 16px Inter, sans-serif';
        ctx.textAlign = 'center';
        ctx.textBaseline = 'middle';
        ctx.fillText(String(displayValue ?? ''), centerX, centerY - radius * 0.55);

        ctx.fillStyle = '#64748b';
        ctx.font = '11px Inter, sans-serif';
        ctx.fillText(labelText || '', centerX, centerY - radius * 0.25);
      };

      const statusFilter = document.getElementById('status-filter');
      const priorityFilter = document.getElementById('priority-filter');
      const searchInput = document.getElementById('search-input');
      const wpCount = document.getElementById('wp-count');
      const projectBadge = document.getElementById('project-badge');
      const generatedAt = document.getElementById('generated-at');
      const tablePanels = document.getElementById('table-panels');
      const statusChart = document.getElementById('status-chart');
      const statusTooltip = document.getElementById('status-tooltip');
      const agingHeatmap = document.getElementById('aging-heatmap');
      const agingTooltip = document.getElementById('aging-tooltip');
      const laborPeopleMothersChart = document.getElementById('labor-people-mothers-chart');
      const laborPeopleChildrenChart = document.getElementById('labor-people-children-chart');
      const realHoursMainChart = document.getElementById('real-hours-main-chart');
      const realHoursChildChart = document.getElementById('real-hours-child-chart');
      const rolePerformanceMainChart = document.getElementById('role-performance-main-chart');
      const rolePerformanceChildChart = document.getElementById('role-performance-child-chart');
      const startcurveMainChart = document.getElementById('startcurve-main-chart');
      const startcurveChildChart = document.getElementById('startcurve-child-chart');
      const startcurveMainTooltip = document.getElementById('startcurve-main-tooltip');
      const startcurveChildTooltip = document.getElementById('startcurve-child-tooltip');
      const startcurveMainLegend = document.getElementById('startcurve-main-legend');
      const startcurveChildLegend = document.getElementById('startcurve-child-legend');
      const graphSelect = document.getElementById('graph-select');
      const statusPanel = document.getElementById('status-panel');
      const agingPanel = document.getElementById('aging-panel');
      const laborPeoplePanel = document.getElementById('labor-people-panel');
      const progressCurvePanel = document.getElementById('progress-curve-panel');
      const progressCurveMainChart = document.getElementById('progress-curve-main-chart');
      const progressCurveChart = document.getElementById('progress-curve-chart');
      const progressMainScroll = document.getElementById('progress-main-scroll');
      const progressChildScroll = document.getElementById('progress-child-scroll');
      const progressRangeMain = document.getElementById('progress-range-main');
      const progressRangeChild = document.getElementById('progress-range-child');
      const realHoursPanel = document.getElementById('real-hours-panel');
      const rolePerformancePanel = document.getElementById('role-performance-panel');
      const laborPeopleTotal = document.getElementById('labor-people-total');
      const laborChildrenTotal = document.getElementById('labor-children-total');
      const realHoursTotal = document.getElementById('real-hours-total');
      const realHoursChildrenTotal = document.getElementById('real-hours-children-total');
      const startcurvePanel = document.getElementById('startcurve-panel');
      const kpiProgress = document.getElementById('kpi-progress');
      const kpiOverdue = document.getElementById('kpi-overdue');
      const kpiPriority = document.getElementById('kpi-priority');
      const kpiIgPhase = document.getElementById('kpi-ig-phase');
      const kpiAssignee = document.getElementById('kpi-assignee');
      const kpiPersonSelect = document.getElementById('kpi-person-select');
      const kpiProgressPersonSelect = document.getElementById('kpi-progress-person-select');
      const kpiOverduePersonSelect = document.getElementById('kpi-overdue-person-select');
      const kpiPrioritySelect = document.getElementById('kpi-priority-select');
      const kpiIgPhaseSelect = document.getElementById('kpi-ig-phase-select');
      const kpiRoleTitle = document.getElementById('kpi-role-title');
      const kpiProgressSub = document.getElementById('kpi-progress-sub');
      const kpiOverdueSub = document.getElementById('kpi-overdue-sub');
      const kpiPrioritySub = document.getElementById('kpi-priority-sub');
      const kpiIgPhaseSub = document.getElementById('kpi-ig-phase-sub');
      const kpiAssigneeSub = document.getElementById('kpi-assignee-sub');
      const downloadStatusIcon = document.getElementById('download-status-png');
      const downloadAgingIcon = document.getElementById('download-aging-png');
      const downloadStartcurveIcon = document.getElementById('download-startcurve-png');
      let laborPeopleMothersChartInstance = null;
      let laborPeopleChildrenChartInstance = null;
      let laborPeopleResizeObserver = null;
      let progressCurveMainChartInstance = null;
      let progressCurveChartInstance = null;
      let realHoursMainChartInstance = null;
      let realHoursChildChartInstance = null;
      let realHoursResizeObserver = null;
      let rolePerformanceMainChartInstance = null;
      let rolePerformanceChildChartInstance = null;
      let startCurveMainChartInstance = null;
      let startCurveChildChartInstance = null;
      let agingSnapshot = null;

      const inferredProject = data.items && data.items[0] && data.items[0]._links && data.items[0]._links.project && data.items[0]._links.project.title;
      projectBadge.textContent = `Proyecto: ${data.project_name || inferredProject || '--'}`;
      const inferredGenerated = (data.items || [])
        .map(item => item.updated_at || item.updatedAt || item.created_at || item.createdAt)
        .filter(Boolean)
        .sort()
        .slice(-1)[0];
      generatedAt.textContent = `Generado: ${fmtDate(data.generated_at || inferredGenerated)}`;

      const uniqueStatuses = Array.from(new Set((data.items || []).map(getStatus).filter(Boolean)));
      uniqueStatuses.forEach(st => {
        const opt = document.createElement('option');
        opt.value = st;
        opt.textContent = st;
        statusFilter.appendChild(opt);
      });
      if (priorityFilter) {
        const uniquePriorities = Array.from(new Set((data.items || []).map(item => {
          return item && item._links && item._links.priority && item._links.priority.title;
        }).filter(Boolean)));
        uniquePriorities.forEach(pr => {
          const opt = document.createElement('option');
          opt.value = pr;
          opt.textContent = pr;
          priorityFilter.appendChild(opt);
        });
      }

      function filterItems() {
        const term = (searchInput.value || '').toLowerCase();
        const status = String(statusFilter.value || '').trim();
        const priority = String(priorityFilter ? priorityFilter.value : '').trim();
        return (data.items || []).filter(item => {
          const name = (item.name || item.subject || '').toLowerCase();
          const st = String(getStatus(item) || '').trim();
          const pr = String((item && item._links && item._links.priority && item._links.priority.title) || '').trim();
          const matchesTerm = !term || name.includes(term) || String(item.id || '').includes(term) || st.toLowerCase().includes(term);
          const matchesStatus = !status || st === status;
          const matchesPriority = !priority || pr === priority;
          return matchesTerm && matchesStatus && matchesPriority;
        });
      }

      function buildPhasePanel(phaseItem, children, chunkIndex) {
        const chunk = document.createElement('div');
        chunk.className = 'table-chunk phase-chunk';
        chunk.setAttribute('data-chunk-index', String(chunkIndex));

        const label = document.createElement('div');
        label.className = 'badge';
        const phaseTitle = phaseItem
          ? `${phaseItem.subject || phaseItem.name || 'Fase'} (ID: ${phaseItem.id || '--'})`
          : 'Sin fase';
        label.textContent = `Fase: ${phaseTitle} | ${children.length} tareas`;
        label.style.marginBottom = '6px';
        chunk.appendChild(label);

        if (phaseItem) {
          const summary = document.createElement('div');
          summary.className = 'phase-summary';
          summary.innerHTML = `
            <div><strong>Estado:</strong> ${getStatus(phaseItem)}</div>
            <div><strong>Inicio:</strong> ${fmtDate(phaseItem.start_date || phaseItem.startDate)}</div>
            <div><strong>Fin:</strong> ${fmtDate(phaseItem.due_date || phaseItem.dueDate)}</div>
            <div><strong>Actualizado:</strong> ${fmtDate(phaseItem.updated_at || phaseItem.updatedAt)}</div>
            <div><strong>Costo:</strong> ${phaseItem.overall_costs || phaseItem.overallCosts || '--'}</div>
          `;
          chunk.appendChild(summary);
        }

        const wrapper = document.createElement('div');
        wrapper.className = 'table-wrapper';

        const table = document.createElement('table');
        table.innerHTML = `
          <thead>
            <tr>
              <th>ID</th>
              <th>Estado</th>
              <th>Nombre de la tarea</th>
              <th>Creado</th>
              <th>Fecha inicio</th>
              <th>Fecha fin</th>
              <th>Ultima actualizacion</th>
              <th>Costo total</th>
            </tr>
          </thead>
          <tbody></tbody>
        `;
        const tbody = table.querySelector('tbody');
        if (!children.length) {
          const tr = document.createElement('tr');
          tr.innerHTML = '<td colspan="8">Sin tareas para esta fase.</td>';
          tbody.appendChild(tr);
        }
        children.forEach(item => {
          const tr = document.createElement('tr');
          tr.innerHTML = `
            <td>${item.id || '--'}</td>
            <td>${(() => {
              const status = getStatus(item);
              const cfg = getStatusStyle(status);
              return `<span class="${cfg.className}" style="${cfg.style}">${status}</span>`;
            })()}</td>
            <td>${item.name || item.subject || '--'}</td>
            <td>${fmtDate(item.created_at || item.createdAt)}</td>
            <td>${fmtDate(item.start_date || item.startDate)}</td>
            <td>${fmtDate(item.due_date || item.dueDate)}</td>
            <td>${fmtDate(item.updated_at || item.updatedAt)}</td>
            <td class="cost">${item.overall_costs || item.overallCosts || '--'}</td>
          `;
          tbody.appendChild(tr);
        });
        wrapper.appendChild(table);
        chunk.appendChild(wrapper);
        return chunk;
      }

      function renderTablePanels(items) {
        tablePanels.innerHTML = '';
        const total = items.length;
        const allItems = data.items || [];
        const byId = new Map(allItems.map(it => [String(it.id), it]));
        const filteredIds = new Set(items.map(it => String(it.id)));
        const phases = new Map();
        const childByParent = new Map();
        const orphans = [];
        const indexMap = new Map(allItems.map((it, idx) => [String(it.id), idx]));

        allItems.forEach(item => {
          const parentId = getParentId(item);
          if (parentId) {
            if (!childByParent.has(parentId)) childByParent.set(parentId, []);
            childByParent.get(parentId).push(item);
          }
        });

        allItems.forEach(item => {
          const typeTitle = (getTypeTitle(item) || '').toLowerCase();
          if (typeTitle.includes('fase')) {
            phases.set(String(item.id), { phase: item, children: [] });
          }
        });

        phases.forEach((group, phaseId) => {
          const phase = group.phase;
          const linkedChildren = (phase && phase._links && phase._links.children) || [];
          const combined = [];
          const seen = new Set();

          linkedChildren.forEach(link => {
            const href = link && link.href;
            const match = href && href.match(/work_packages\/(\d+)/);
            const childId = match ? match[1] : null;
            if (childId && byId.has(childId) && !seen.has(childId)) {
              seen.add(childId);
              combined.push(byId.get(childId));
            }
          });

          (childByParent.get(phaseId) || []).forEach(child => {
            const cid = String(child.id);
            if (!seen.has(cid)) {
              seen.add(cid);
              combined.push(child);
            }
          });

          group.children = combined
            .filter(child => filteredIds.has(String(child.id)))
            .sort((a, b) => {
              const ai = indexMap.get(String(a.id));
              const bi = indexMap.get(String(b.id));
              if (Number.isFinite(ai) && Number.isFinite(bi) && ai !== bi) return ai - bi;
              return String(a.id || '').localeCompare(String(b.id || ''));
            });
        });

        items.forEach(item => {
          const typeTitle = (getTypeTitle(item) || '').toLowerCase();
          const parentId = getParentId(item);
          const isPhase = typeTitle.includes('fase');
          if (!isPhase && (!parentId || !phases.has(parentId))) {
            orphans.push(item);
          }
        });

        const phaseGroups = Array.from(phases.values()).sort((a, b) => {
          const ai = indexMap.get(String((a.phase || {}).id));
          const bi = indexMap.get(String((b.phase || {}).id));
          if (Number.isFinite(ai) && Number.isFinite(bi) && ai !== bi) return ai - bi;
          return String((a.phase || {}).id || '').localeCompare(String((b.phase || {}).id || ''));
        });

        let chunkIndex = 0;
        phaseGroups.forEach(group => {
          const chunk = buildPhasePanel(group.phase, group.children, chunkIndex);
          tablePanels.appendChild(chunk);
          chunkIndex += 1;
        });
        if (orphans.length) {
          orphans.sort((a, b) => {
            const ai = indexMap.get(String(a.id));
            const bi = indexMap.get(String(b.id));
            if (Number.isFinite(ai) && Number.isFinite(bi) && ai !== bi) return ai - bi;
            return String(a.id || '').localeCompare(String(b.id || ''));
          });
          const chunk = buildPhasePanel(null, orphans, chunkIndex);
          tablePanels.appendChild(chunk);
        }
        wpCount.textContent = `${items.length} paquetes de trabajo`;
      }

      function drawStatusChart(items) {
        if (!statusChart) return;
        const ctx = statusChart.getContext('2d');
        const counts = {};
        const costByStatus = {};
        const hoursByStatus = {};
        items.forEach(it => {
          const st = getStatus(it).trim() || '-';
          counts[st] = (counts[st] || 0) + 1;
          costByStatus[st] = (costByStatus[st] || 0) + parseCostNumber(it.overall_costs || it.overallCosts);
          hoursByStatus[st] = (hoursByStatus[st] || 0) + parseDurationHours(it.spent_time || it.spentTime);
        });
        const labels = Object.keys(counts);
        const values = labels.map(l => counts[l]);
        const palette = ['#2563eb','#16a34a','#f97316','#9333ea','#0ea5e9','#f59e0b','#22c55e','#64748b'];

        const width = statusChart.clientWidth || 300;
        const height = statusChart.clientHeight || 260;
        statusChart.width = width * window.devicePixelRatio;
        statusChart.height = height * window.devicePixelRatio;
        ctx.setTransform(1, 0, 0, 1, 0, 0);
        ctx.scale(window.devicePixelRatio, window.devicePixelRatio);
        ctx.clearRect(0, 0, width, height);

        if (!labels.length) {
          statusTooltip.style.opacity = 0;
          statusChart.onmousemove = null;
          statusChart.onmouseleave = null;
          return;
        }

        const cx = width / 2;
        const cy = height / 2;
        const radius = Math.min(cx, cy) - 16;
        const total = values.reduce((a, b) => a + b, 0) || 1;
        const slices = [];
        let start = -Math.PI / 2;

        values.forEach((v, idx) => {
          const angle = (v / total) * Math.PI * 2;
          const end = start + angle;
          ctx.beginPath();
          ctx.moveTo(cx, cy);
          ctx.fillStyle = palette[idx % palette.length];
          ctx.arc(cx, cy, radius, start, end);
          ctx.fill();
          slices.push({ start, end, label: labels[idx], value: v, color: palette[idx % palette.length] });
          start = end;
        });

        ctx.fillStyle = '#ffffff';
        ctx.font = '12px Inter, sans-serif';
        ctx.textAlign = 'center';
        ctx.textBaseline = 'middle';
        slices.forEach(s => {
          const mid = (s.start + s.end) / 2;
          const lx = cx + (radius * 0.6) * Math.cos(mid);
          const ly = cy + (radius * 0.6) * Math.sin(mid);
          ctx.fillText(`${s.value}`, lx, ly);
        });

        statusChart.onmousemove = (e) => {
          const rect = statusChart.getBoundingClientRect();
          const mx = e.clientX - rect.left;
          const my = e.clientY - rect.top;
          const dx = mx - cx;
          const dy = my - cy;
          const dist = Math.sqrt(dx * dx + dy * dy);
          if (dist > radius) { statusTooltip.style.opacity = 0; return; }
          let angle = Math.atan2(dy, dx);
          if (angle < -Math.PI / 2) angle += Math.PI * 2;
          const hit = slices.find(s => angle >= s.start && angle <= s.end);
          if (hit) {
            const pct = Math.round((hit.value / total) * 100);
            const cost = costByStatus[hit.label] || 0;
            const hours = hoursByStatus[hit.label] || 0;
            statusTooltip.style.opacity = 1;
            statusTooltip.textContent = `${hit.label}: ${hit.value} (${pct}%) | Costos: ${cost.toFixed(2)} | Horas: ${hours.toFixed(1)}`;
            statusTooltip.style.left = `${e.clientX + 10}px`;
            statusTooltip.style.top = `${e.clientY - 10}px`;
          } else {
            statusTooltip.style.opacity = 0;
          }
        };
        statusChart.onmouseleave = () => { statusTooltip.style.opacity = 0; };
      }

      function renderKpiGauges(items) {
        const total = items.length || 0;
        const progressValues = items
          .map(it => {
            const raw = it.derivedPercentageDone ?? it.percentageDone;
            return Number.isFinite(Number(raw)) ? Number(raw) : null;
          })
          .filter(v => v !== null);
        const avgProgress = progressValues.length
          ? progressValues.reduce((a, b) => a + b, 0) / progressValues.length
          : 0;

        const today = new Date().toISOString().slice(0, 10);
        const overdueCount = items.filter(it => {
          const due = it.due_date || it.dueDate;
          if (!due) return false;
          const pct = Number(it.derivedPercentageDone ?? it.percentageDone ?? 0);
          return due < today && pct < 100;
        }).length;
        const overduePct = total ? (overdueCount / total) * 100 : 0;

        const isPhaseItem = (it) => {
          const typeTitle = (getTypeTitle(it) || '').toLowerCase();
          return typeTitle.includes('fase');
        };
        const isParentlessItem = (it) => !getParentId(it);
        const shouldCountCost = (it) => isPhaseItem(it) || isParentlessItem(it);
        const priorityCounts = new Map();
        items.forEach(it => {
          const title = it && it._links && it._links.priority && it._links.priority.title;
          const key = title || 'Sin prioridad';
          priorityCounts.set(key, (priorityCounts.get(key) || 0) + 1);
        });
        const prioritySorted = Array.from(priorityCounts.entries())
          .sort((a, b) => b[1] - a[1]);
        const topPriority = prioritySorted[0] ? prioritySorted[0][0] : 'Sin prioridad';
        const topPriorityCount = prioritySorted[0] ? prioritySorted[0][1] : 0;
        const topPriorityPct = total ? (topPriorityCount / total) * 100 : 0;
        const igPhaseCounts = new Map();
        items.forEach(it => {
          const title = it && it._links && it._links.customField12 && it._links.customField12.title;
          const key = title || 'Sin fase';
          igPhaseCounts.set(key, (igPhaseCounts.get(key) || 0) + 1);
        });
        const igPhaseSorted = Array.from(igPhaseCounts.entries())
          .sort((a, b) => b[1] - a[1]);
        const topIgPhase = igPhaseSorted[0] ? igPhaseSorted[0][0] : 'Sin fase';
        const topIgPhaseCount = igPhaseSorted[0] ? igPhaseSorted[0][1] : 0;
        const topIgPhasePct = total ? (topIgPhaseCount / total) * 100 : 0;

        const populateKpiSelect = (selectEl, sorted, emptyLabel) => {
          if (!selectEl) return '';
          const current = selectEl.value;
          selectEl.innerHTML = '';
          const emptyOpt = document.createElement('option');
          emptyOpt.value = '';
          emptyOpt.textContent = emptyLabel;
          selectEl.appendChild(emptyOpt);
          sorted.forEach(([name]) => {
            const opt = document.createElement('option');
            opt.value = name;
            opt.textContent = name;
            selectEl.appendChild(opt);
          });
          if (current === '') {
            selectEl.value = '';
          } else if (current && sorted.some(([name]) => name === current)) {
            selectEl.value = current;
          } else {
            selectEl.value = '';
          }
          return selectEl.value;
        };

        const selectedPriority = populateKpiSelect(
          kpiPrioritySelect,
          prioritySorted,
          'Todas las prioridades'
        );
        const selectedIgPhase = populateKpiSelect(
          kpiIgPhaseSelect,
          igPhaseSorted,
          'Todas las fases'
        );

        const selectedPriorityCount = selectedPriority
          ? (priorityCounts.get(selectedPriority) || 0)
          : total;
        const selectedPriorityPct = total ? (selectedPriorityCount / total) * 100 : 0;
        const selectedIgPhaseCount = selectedIgPhase
          ? (igPhaseCounts.get(selectedIgPhase) || 0)
          : total;
        const selectedIgPhasePct = total ? (selectedIgPhaseCount / total) * 100 : 0;

        const peopleSet = new Set();
        items.forEach(it => {
          const links = it._links || {};
          const assignee = links.assignee && links.assignee.title;
          const responsible = links.responsible && links.responsible.title;
          const author = links.author && links.author.title;
          if (assignee) peopleSet.add(assignee);
          if (responsible) peopleSet.add(responsible);
          if (author) peopleSet.add(author);
        });
        const people = Array.from(peopleSet);
        const populatePersonSelect = (selectEl) => {
          if (!selectEl) return '';
          const current = selectEl.value;
          selectEl.innerHTML = '';
          people.forEach(name => {
            const opt = document.createElement('option');
            opt.value = name;
            opt.textContent = name;
            selectEl.appendChild(opt);
          });
          const emptyOpt = document.createElement('option');
          emptyOpt.value = '';
          emptyOpt.textContent = 'No hay involucrado';
          selectEl.appendChild(emptyOpt);
          if (current && people.includes(current)) {
            selectEl.value = current;
          } else if (people.length) {
            selectEl.value = people[0];
          } else {
            selectEl.value = '';
          }
          return selectEl.value;
        };
        const selectedPerson = populatePersonSelect(kpiPersonSelect);
        const progressPerson = populatePersonSelect(kpiProgressPersonSelect);
        const overduePerson = populatePersonSelect(kpiOverduePersonSelect);
        let involvedTasks = 0;
        const roleCounts = { asignado: 0, responsable: 0, autor: 0 };
        items.forEach(it => {
          const links = it._links || {};
          const assignee = links.assignee && links.assignee.title;
          const responsible = links.responsible && links.responsible.title;
          const author = links.author && links.author.title;
          const matched = selectedPerson &&
            (assignee === selectedPerson || responsible === selectedPerson || author === selectedPerson);
          if (matched) involvedTasks += 1;
          if (assignee === selectedPerson) roleCounts.asignado += 1;
          if (responsible === selectedPerson) roleCounts.responsable += 1;
          if (author === selectedPerson) roleCounts.autor += 1;
        });
        const involvedPct = total ? (involvedTasks / total) * 100 : 0;
        const progressData = items.reduce((acc, it) => {
          if (!progressPerson) return acc;
          const links = it._links || {};
          const assignee = links.assignee && links.assignee.title;
          const responsible = links.responsible && links.responsible.title;
          const author = links.author && links.author.title;
          if (assignee === progressPerson || responsible === progressPerson || author === progressPerson) {
            const raw = it.derivedPercentageDone ?? it.percentageDone;
            const num = Number(raw);
            if (Number.isFinite(num)) {
              acc.sum += num;
              acc.count += 1;
            }
          }
          return acc;
        }, { sum: 0, count: 0 });
        const avgProgressByPerson = progressData.count ? progressData.sum / progressData.count : 0;

        const overdueData = items.reduce((acc, it) => {
          if (!overduePerson) return acc;
          const links = it._links || {};
          const assignee = links.assignee && links.assignee.title;
          const responsible = links.responsible && links.responsible.title;
          const author = links.author && links.author.title;
          if (assignee === overduePerson || responsible === overduePerson || author === overduePerson) {
            const due = it.due_date || it.dueDate;
            if (due) {
              acc.total += 1;
              const pct = Number(it.derivedPercentageDone ?? it.percentageDone ?? 0);
              if (due < today && pct < 100) acc.overdue += 1;
            }
          }
          return acc;
        }, { total: 0, overdue: 0 });
        const overduePctByPerson = overdueData.total ? (overdueData.overdue / overdueData.total) * 100 : 0;

        drawGauge(kpiProgress, progressPerson ? avgProgressByPerson : avgProgress, 'avance', '#2563eb');
        drawGauge(kpiOverdue, overduePerson ? overduePctByPerson : overduePct, 'vencidas', '#ef4444');
        const palette = ['#2563eb', '#16a34a', '#f59e0b', '#ef4444', '#8b5cf6', '#0ea5e9'];
        const prioritySegments = prioritySorted.map(([name, count], idx) => ({
          label: name,
          value: count,
          color: palette[idx % palette.length]
        }));
        const igPhaseSegments = igPhaseSorted.map(([name, count], idx) => ({
          label: name,
          value: count,
          color: palette[idx % palette.length]
        }));

        drawSegmentGauge(
          kpiPriority,
          prioritySegments,
          'Total',
          total
        );
        drawSegmentGauge(
          kpiIgPhase,
          igPhaseSegments,
          'Total',
          total
        );
        drawGauge(kpiAssignee, involvedPct, 'participacion', '#8b5cf6');

        if (kpiProgressSub) {
          if (progressPerson) {
            kpiProgressSub.textContent = progressData.count
              ? `${progressPerson}: ${progressData.count} tareas`
              : `${progressPerson}: sin datos`;
          } else {
            kpiProgressSub.textContent = progressValues.length
              ? `Base: ${progressValues.length} tareas`
              : 'Sin porcentaje real';
          }
        }
        if (kpiOverdueSub) {
          if (overduePerson) {
            kpiOverdueSub.textContent = overdueData.total
              ? `${overduePerson}: ${overdueData.overdue} de ${overdueData.total}`
              : `${overduePerson}: sin datos`;
          } else {
            kpiOverdueSub.textContent = total ? `${overdueCount} de ${total} tareas` : 'Sin tareas';
          }
        }
        if (kpiPrioritySub) {
          if (selectedPriority) {
            kpiPrioritySub.textContent = total
              ? `${selectedPriority}: ${selectedPriorityCount} de ${total}`
              : 'Sin prioridades';
          } else {
            kpiPrioritySub.textContent = total ? `Total: ${total}` : 'Sin prioridades';
          }
        }
        if (kpiIgPhaseSub) {
          if (selectedIgPhase) {
            kpiIgPhaseSub.textContent = total
              ? `${selectedIgPhase}: ${selectedIgPhaseCount} de ${total}`
              : 'Sin fases';
          } else {
            kpiIgPhaseSub.textContent = total ? `Total: ${total}` : 'Sin fases';
          }
        }
        if (kpiAssigneeSub) {
          kpiAssigneeSub.textContent = selectedPerson
            ? `${involvedTasks} de ${total} tareas | Asig: ${roleCounts.asignado} Resp: ${roleCounts.responsable} Autor: ${roleCounts.autor}`
            : 'No hay involucrado';
        }
        if (kpiRoleTitle) {
          kpiRoleTitle.textContent = 'Participacion por persona';
        }
      }

      function renderAgingHeatmap(items) {
        if (!agingHeatmap) return;
        const now = Date.now();
        const buckets = [
          { label: '0-3 dias', min: 0, max: 3 },
          { label: '4-7 dias', min: 4, max: 7 },
          { label: '8-14 dias', min: 8, max: 14 },
          { label: '15-30 dias', min: 15, max: 30 },
          { label: '31+ dias', min: 31, max: Infinity }
        ];
        const counts = buckets.map(() => 0);
        (items || []).forEach(item => {
          const d = item.updated_at || item.updatedAt;
          if (!d) return;
          const ts = Date.parse(d);
          if (Number.isNaN(ts)) return;
          const days = Math.max(0, Math.floor((now - ts) / 86400000));
          const idx = buckets.findIndex(b => days >= b.min && days <= b.max);
          if (idx >= 0) counts[idx] += 1;
        });
        const max = counts.reduce((a, b) => Math.max(a, b), 0) || 1;
        agingHeatmap.innerHTML = '';
        buckets.forEach((b, i) => {
          const count = counts[i];
          const intensity = count / max;
          const color = `rgba(29,78,216, ${0.15 + intensity * 0.65})`;
          const cell = document.createElement('div');
          cell.className = 'heat-cell';
          cell.style.background = `linear-gradient(135deg, ${color} 0%, #ffffff 80%)`;
          cell.innerHTML = `
            <div class="heat-label">${b.label}</div>
            <div class="heat-value">${count}</div>
            <div class="heat-sub">Paquetes de trabajo</div>
          `;
          cell.addEventListener('mousemove', (e) => {
            agingTooltip.style.opacity = 1;
            agingTooltip.textContent = `${b.label}: ${count} Paquetes de trabajo`;
            agingTooltip.style.left = `${e.clientX + 10}px`;
            agingTooltip.style.top = `${e.clientY - 10}px`;
          });
          cell.addEventListener('mouseleave', () => { agingTooltip.style.opacity = 0; });
          agingHeatmap.appendChild(cell);
        });
        agingSnapshot = { buckets, counts, max };

        if (counts.every(c => c === 0)) {
          agingHeatmap.innerHTML = '<div class="heat-label">Sin datos de updatedAt para calcular el indice.</div>';
        }
      }

      function drawProgressCurve(items) {
        const isPhaseItem = (it) => (getTypeTitle(it) || '').toLowerCase().includes('fase');
        const isMainOrIndependent = (it) => isPhaseItem(it) || !getParentId(it);
        const isChildOnly = (it) => {
          const hasParent = !!getParentId(it);
          if (!hasParent) return false;
          const typeTitle = (getTypeTitle(it) || '').toLowerCase();
          return !typeTitle.includes('hito');
        };
        const getItemTimestamp = (it) => {
          const raw = it.created_at || it.createdAt || it.updated_at || it.updatedAt;
          const ts = Date.parse(raw);
          return Number.isNaN(ts) ? null : ts;
        };
        const getRangeStart = (rangeKey, now) => {
          const startOfDay = (d) => new Date(d.getFullYear(), d.getMonth(), d.getDate());
          const todayStart = startOfDay(now);
          switch (rangeKey) {
            case 'today':
              return todayStart.getTime();
            case 'last3': {
              const d = new Date(todayStart);
              d.setDate(d.getDate() - 2);
              return d.getTime();
            }
            case 'last7': {
              const d = new Date(todayStart);
              d.setDate(d.getDate() - 6);
              return d.getTime();
            }
            case 'month':
              return new Date(now.getFullYear(), now.getMonth(), 1).getTime();
            case 'year':
              return new Date(now.getFullYear(), 0, 1).getTime();
            default:
              return null;
          }
        };
        const filterByRange = (list, rangeKey) => {
          const now = new Date();
          const start = getRangeStart(rangeKey, now);
          if (!start) return list;
          const end = now.getTime();
          return (list || []).filter(it => {
            const ts = getItemTimestamp(it);
            if (!Number.isFinite(ts)) return false;
            return ts >= start && ts <= end;
          });
        };

        const renderProgressChart = (targetChart, sourceItems, height, showLine) => {
          if (!targetChart) return null;
          const daily = new Map();
          const byTimestamp = [];
          (sourceItems || []).forEach(it => {
            const rawDate = it.created_at || it.createdAt || it.updated_at || it.updatedAt;
            const ts = Date.parse(rawDate);
            if (Number.isNaN(ts)) return;
            const dateKey = new Date(ts).toISOString().slice(0, 10);
            if (!daily.has(dateKey)) {
              daily.set(dateKey, {
                count: 0,
                sum: 0,
                countProgress: 0,
                sumWeighted: 0,
                sumWeight: 0,
                spent: 0,
                estimated: 0,
                cost: 0,
                idLabel: '',
                fullLabel: ''
              });
            }
            const entry = daily.get(dateKey);
            entry.count += 1;
            if (!entry.idLabel) entry.idLabel = `ID ${it.id || ''}`.trim();
            if (!entry.fullLabel) {
              const clean = String(it.subject || it.name || `ID ${it.id || ''}`).replace(/\s+/g, ' ').trim();
              entry.fullLabel = `ID ${it.id || ''} - ${clean}`.trim();
            }
            const rawPct = it.derivedPercentageDone ?? it.percentageDone;
            const pct = Number.isFinite(Number(rawPct)) ? Number(rawPct) : 0;
            entry.sum += pct;
            entry.countProgress += 1;
            const spent = parseDurationHours(it.spent_time || it.spentTime);
            entry.spent += Number.isFinite(spent) ? spent : 0;
            const est = parseDurationHours(it.derived_estimated_time || it.derivedEstimatedTime || it.estimated_time || it.estimatedTime);
            entry.estimated += Number.isFinite(est) ? est : 0;
            const cost = parseCostNumber(it.overall_costs || it.overallCosts);
            entry.cost += Number.isFinite(cost) ? cost : 0;
            if (Number.isFinite(est) && est > 0) {
              entry.sumWeighted += pct * est;
              entry.sumWeight += est;
            }
            byTimestamp.push({
              ts,
              pct,
              est: Number.isFinite(est) ? est : 0,
              spent: Number.isFinite(spent) ? spent : 0,
              cost: Number.isFinite(cost) ? cost : 0,
              idLabel: `ID ${it.id || ''}`.trim(),
              fullLabel: `ID ${it.id || ''} - ${String(it.subject || it.name || '').replace(/\s+/g, ' ').trim()}`
            });
          });

          const dateKeys = Array.from(daily.keys()).sort();
          if (!dateKeys.length && !byTimestamp.length) return null;
          const formatShortDate = (ts) => {
            const d = new Date(ts);
            const day = String(d.getDate()).padStart(2, '0');
            const monthNames = ['Ene', 'Feb', 'Mar', 'Abr', 'May', 'Jun', 'Jul', 'Ago', 'Sep', 'Oct', 'Nov', 'Dic'];
            const month = monthNames[d.getMonth()] || '';
            const year = d.getFullYear();
            return `${day}-${month}-${year}`;
          };
          let labels = [];
          let countSlice = [];
          let avgSlice = [];
          let spentSlice = [];
          let estimatedSlice = [];
          let costSlice = [];
          let barLabels = [];
          let barFullLabels = [];
          let minTs = null;
          let maxTs = null;
          if (dateKeys.length <= 1) {
            byTimestamp.sort((a, b) => a.ts - b.ts);
            labels = byTimestamp.map(entry => formatShortDate(entry.ts));
            barLabels = byTimestamp.map(entry => entry.idLabel || '');
            barFullLabels = byTimestamp.map(entry => entry.fullLabel || entry.idLabel || '');
            spentSlice = byTimestamp.map(entry => entry.spent || 0);
            estimatedSlice = byTimestamp.map(entry => entry.est || 0);
            costSlice = byTimestamp.map(entry => entry.cost || 0);
            if (byTimestamp.length) {
              minTs = byTimestamp[0].ts;
              maxTs = byTimestamp[byTimestamp.length - 1].ts;
            }
            countSlice = [];
            let cumulativeSum = 0;
            let cumulativeCount = 0;
            let cumulativeWeighted = 0;
            let cumulativeWeight = 0;
            avgSlice = byTimestamp.map(entry => {
              cumulativeSum += entry.pct;
              cumulativeCount += 1;
              if (entry.est > 0) {
                cumulativeWeighted += entry.pct * entry.est;
                cumulativeWeight += entry.est;
              }
              const currentPct = entry.pct;
              countSlice.push(currentPct);
              if (cumulativeWeight > 0) return cumulativeWeighted / cumulativeWeight;
              return cumulativeCount ? cumulativeSum / cumulativeCount : 0;
            });
          } else {
            const startDate = new Date(dateKeys[0]);
            const endDate = new Date(dateKeys[dateKeys.length - 1]);
            const datesIso = [];
            for (let d = new Date(startDate); d <= endDate; d.setDate(d.getDate() + 1)) {
              datesIso.push(d.toISOString().slice(0, 10));
            }
            minTs = startDate.getTime();
            maxTs = endDate.getTime();
            let cumulativeSum = 0;
            let cumulativeCount = 0;
            let cumulativeWeighted = 0;
            let cumulativeWeight = 0;
            labels = datesIso.map(d => formatShortDate(Date.parse(d)));
            countSlice = [];
            avgSlice = [];
            spentSlice = [];
            estimatedSlice = [];
            costSlice = [];
            barLabels = [];
            barFullLabels = [];
            datesIso.forEach(dateIso => {
              const entry = daily.get(dateIso);
              const dayCount = entry ? entry.count : 0;
              const dayPct = entry
                ? (entry.sumWeight > 0 ? entry.sumWeighted / entry.sumWeight : (entry.countProgress ? entry.sum / entry.countProgress : 0))
                : 0;
              countSlice.push(dayPct);
              spentSlice.push(entry ? entry.spent : 0);
              estimatedSlice.push(entry ? entry.estimated : 0);
              costSlice.push(entry ? entry.cost : 0);
              if (entry && entry.idLabel) {
                if (dayCount > 1) {
                  barLabels.push(`${entry.idLabel} +${dayCount - 1}`);
                  barFullLabels.push(`${entry.fullLabel} +${dayCount - 1}`);
                } else {
                  barLabels.push(entry.idLabel);
                  barFullLabels.push(entry.fullLabel || entry.idLabel);
                }
              } else {
                barLabels.push('');
                barFullLabels.push('');
              }
              if (entry) {
                cumulativeSum += entry.sum;
                cumulativeCount += entry.countProgress;
                cumulativeWeighted += entry.sumWeighted;
                cumulativeWeight += entry.sumWeight;
              }
              if (cumulativeWeight > 0) {
                avgSlice.push(cumulativeWeighted / cumulativeWeight);
              } else {
                avgSlice.push(cumulativeCount ? cumulativeSum / cumulativeCount : 0);
              }
            });
          }

          const expectedSlice = spentSlice;

          if (progressCurvePanel) {
            const styles = window.getComputedStyle(progressCurvePanel);
            const padLeft = parseFloat(styles.paddingLeft) || 0;
            const padRight = parseFloat(styles.paddingRight) || 0;
            const baseWidth = Math.max(320, progressCurvePanel.clientWidth - padLeft - padRight);
            const width = Math.max(baseWidth, labels.length * 40);
            const scrollEl = targetChart === progressCurveMainChart ? progressMainScroll : progressChildScroll;
            if (scrollEl) scrollEl.style.overflowX = width > baseWidth ? 'auto' : 'hidden';
            targetChart.style.width = `${width}px`;
            targetChart.style.height = `${height}px`;
            targetChart.width = Math.round(width);
            targetChart.height = Math.round(height);
          }

          const barLabelPlugin = {
            id: `progressBarLabels-${Math.random().toString(36).slice(2)}`,
            afterDatasetsDraw(chart) {
              const { ctx, scales, chartArea } = chart;
              const meta = chart.getDatasetMeta(0);
              if (!meta || !meta.data) return;
              const yScale = scales.y;
              const zeroY = yScale ? yScale.getPixelForValue(0) : null;
              ctx.save();
              ctx.fillStyle = '#ffffff';
              ctx.font = '10px Inter, sans-serif';
              ctx.textAlign = 'center';
              ctx.textBaseline = 'middle';
              meta.data.forEach((bar, idx) => {
                const text = barLabels[idx] || '';
                if (!text) return;
                const x = bar.x;
                const yTop = bar.y;
                const yBase = bar.base;
                const height = Math.abs(yBase - yTop);
                if (!Number.isFinite(height) || height < 10) return;
                const y = yBase - height / 2;
                if (y > chartArea.bottom || y < chartArea.top) return;
                ctx.save();
                ctx.translate(x, y);
                ctx.rotate(-Math.PI / 2);
                ctx.fillText(text, 0, 0);
                ctx.restore();
              });
              ctx.restore();

              if (!yScale || !Number.isFinite(zeroY)) return;
              const values = chart.data.datasets[0] ? chart.data.datasets[0].data : [];
              ctx.save();
              ctx.fillStyle = '#2563eb';
              meta.data.forEach((bar, idx) => {
                const val = Number(values[idx] || 0);
                if (val !== 0) return;
                const x = bar.x;
                const barWidth = Math.max(6, bar.width || 8);
                const left = x - barWidth / 2;
                const top = chartArea.bottom + 1;
                const height = 4;
                ctx.fillRect(left, top, barWidth, height);
              });
              ctx.restore();

              ctx.save();
              ctx.fillStyle = '#0f172a';
              ctx.font = '10px Inter, sans-serif';
              ctx.textAlign = 'center';
              ctx.textBaseline = 'bottom';
              if (chart.isDatasetVisible(0)) {
                meta.data.forEach((bar, idx) => {
                  const cost = Number(costSlice[idx] || 0);
                  if (!Number.isFinite(cost) || cost <= 0) return;
                  const label = cost.toFixed(2);
                  const x = bar.x;
                  const yTop = bar.y;
                  const y = Math.max(chartArea.top + 2, yTop - 4);
                  ctx.fillText(label, x, y);
                });
              }
              ctx.restore();
            }
          };

          const datasets = [
            {
              type: 'bar',
              label: 'Progreso diario real',
              data: countSlice,
              yAxisID: 'y',
              backgroundColor: '#2563eb',
              borderColor: '#2563eb',
              borderWidth: 1,
              minBarLength: 0,
              order: 1
            }
          ];
          if (showLine) {
            datasets.push({
              type: 'line',
              label: 'Progreso acumulado real',
              data: avgSlice,
              yAxisID: 'y',
              borderColor: '#16a34a',
              backgroundColor: 'rgba(22, 163, 74, 0.15)',
              tension: 0.2,
              pointRadius: 2,
              pointHoverRadius: 3,
              order: 0
            });
          }
          datasets.push({
            type: 'line',
            label: 'Horas invertidas reales (h)',
            data: expectedSlice,
            yAxisID: 'y2',
            borderColor: '#94a3b8',
            borderDash: [6, 4],
            pointRadius: 0,
            tension: 0,
            order: 0
          });
          datasets.push({
            type: 'line',
            label: 'Horas estimadas de trabajo',
            data: estimatedSlice,
            yAxisID: 'y2',
            borderColor: '#ef4444',
            borderDash: [],
            pointRadius: 0,
            tension: 0,
            order: 0
          });
          const currencyLabel = 'Costos reales';
          datasets.push({
            type: 'line',
            label: currencyLabel,
            data: costSlice,
            yAxisID: 'y3',
            borderColor: '#f59e0b',
            borderDash: [6, 4],
            pointRadius: 0,
            tension: 0,
            order: 0
          });

          return new Chart(targetChart.getContext('2d'), {
            type: 'bar',
            data: {
              labels,
              datasets
            },
            options: {
              responsive: false,
              maintainAspectRatio: false,
              interaction: { mode: 'index', intersect: false },
              hover: { mode: 'index', intersect: false },
              plugins: {
                legend: { display: false },
                tooltip: {
                  callbacks: {
                    label: (ctx) => {
                      const val = Number(ctx.raw || 0);
                    if (ctx.dataset.type === 'line') {
                      if (ctx.dataset.label === 'Horas invertidas reales (h)') {
                        return `Horas invertidas reales: ${val.toFixed(1)} h`;
                      }
                      if (ctx.dataset.label === 'Horas estimadas de trabajo') {
                        return `Horas estimadas de trabajo: ${val.toFixed(1)} h`;
                      }
                      if (ctx.dataset.label === currencyLabel) {
                        return `${currencyLabel}: ${val.toFixed(2)}`;
                      }
                      return `Progreso acumulado real: ${val.toFixed(1)}%`;
                    }
                      const full = barFullLabels[ctx.dataIndex] || '';
                      return full
                        ? `${full} | ${val.toFixed(1)}%`
                        : `Progreso diario real: ${val.toFixed(1)}%`;
                    }
                  }
                }
              },
              scales: {
                x: {
                  ticks: { maxRotation: 90, minRotation: 90 }
                },
                y: {
                  min: 0,
                  max: 100,
                  title: { display: true, text: '% progreso' },
                  ticks: {
                    stepSize: 10,
                    callback: (val) => `${val}%`
                  }
                },
                y2: {
                  position: 'right',
                  beginAtZero: true,
                  title: { display: true, text: 'Horas' },
                  grid: { drawOnChartArea: false }
                },
                y3: {
                  position: 'right',
                  beginAtZero: true,
                  title: { display: true, text: currencyLabel },
                  grid: { drawOnChartArea: false }
                }
              }
            },
            plugins: [barLabelPlugin]
          });
        };

        const showLineMain = true;
        const showLineChild = true;
        const mainRange = progressRangeMain ? progressRangeMain.value : 'all';
        const childRange = progressRangeChild ? progressRangeChild.value : 'all';
        const mainItems = filterByRange((items || []).filter(it => isMainOrIndependent(it)), mainRange);
        if (progressCurveMainChartInstance) progressCurveMainChartInstance.destroy();
        progressCurveMainChartInstance = renderProgressChart(progressCurveMainChart, mainItems, 420, showLineMain);
        if (progressCurveChartInstance) progressCurveChartInstance.destroy();
        const childOnlyItems = filterByRange((items || []).filter(it => isChildOnly(it)), childRange);
        progressCurveChartInstance = renderProgressChart(progressCurveChart, childOnlyItems, 420, showLineChild);
      }


      function drawLaborPeopleChart(items) {
        if (!laborPeopleMothersChart || !laborPeopleChildrenChart) return;
        const panelWidth = laborPeoplePanel ? laborPeoplePanel.getBoundingClientRect().width : 0;
        if (panelWidth < 10) {
          setTimeout(() => drawLaborPeopleChart(items), 120);
          return;
        }
        const palette = ['#2563eb', '#16a34a', '#f59e0b', '#ef4444', '#8b5cf6', '#0ea5e9'];
        const colorForIndex = (idx) => {
          if (idx < palette.length) return palette[idx];
          const hue = (idx * 47) % 360;
          return `hsl(${hue}, 70%, 50%)`;
        };
        const buildLabelLookup = (labels, buckets) => {
          const lookup = {};
          labels.forEach(label => {
            const bucket = buckets.get(label) || {};
            if (bucket.__full) lookup[label] = bucket.__full;
          });
          return lookup;
        };
        const buildRoleLookup = (labels, buckets) => {
          const lookup = {};
          labels.forEach(label => {
            const bucket = buckets.get(label) || {};
            if (bucket.__roles && bucket.__roles.size) {
              const roles = Array.from(bucket.__roles);
              lookup[label] = roles.join(' | ');
            }
          });
          return lookup;
        };
        const buildDatasets = (labels, buckets) => {
          const personTotals = {};
          labels.forEach(label => {
            const bucket = buckets.get(label) || {};
            Object.keys(bucket).forEach(name => {
              if (name.startsWith('__')) return;
              personTotals[name] = (personTotals[name] || 0) + bucket[name];
            });
          });
          const peopleSorted = Object.keys(personTotals)
            .sort((a, b) => personTotals[b] - personTotals[a]);
          const topPeople = peopleSorted.slice(0, 5);
          const others = peopleSorted.slice(5);
          const datasets = [];
          topPeople.forEach((name, idx) => {
            datasets.push({
              label: name,
              data: labels.map(label => (buckets.get(label) || {})[name] || 0),
              backgroundColor: colorForIndex(idx),
              minBarLength: 6
            });
          });
          if (others.length) {
            datasets.push({
              label: 'Otros',
              data: labels.map(label => {
                const bucket = buckets.get(label) || {};
                return others.reduce((sum, name) => sum + (bucket[name] || 0), 0);
              }),
              backgroundColor: '#94a3b8',
              minBarLength: 6
            });
          }
          return datasets;
        };

        const mothersBuckets = new Map();
        const childrenBuckets = new Map();
        const independentLabels = [];
        const childLabels = [];

        const buildRoleLabel = (it) => {
          const links = it._links || {};
          const assignee = links.assignee && links.assignee.title;
          const responsible = links.responsible && links.responsible.title;
          if (assignee && responsible) return `Asig: ${assignee} | Resp: ${responsible}`;
          if (assignee) return `Asig: ${assignee}`;
          if (responsible) return `Resp: ${responsible}`;
          return 'Sin involucrado';
        };
        const shortenText = (value, maxLen) => {
          const text = String(value || '').replace(/\s+/g, ' ').trim();
          if (text.length <= maxLen) return text;
          return `${text.slice(0, Math.max(0, maxLen - 3))}...`;
        };
        const getFullLabel = (it) => {
          const id = it.id || '--';
          const name = it.subject || it.name || String(getTypeTitle(it) || 'Sin nombre');
          const clean = name.replace(/\s+/g, ' ').trim();
          return `ID ${id} - ${clean}`;
        };
        const formatLabel = (it, wordCount) => {
          const id = it.id || '--';
          const name = it.subject || it.name || String(getTypeTitle(it) || 'Sin nombre');
          const clean = name.replace(/\s+/g, ' ').trim();
          const words = clean.split(' ');
          let short = clean;
          if (wordCount && words.length > wordCount) {
            short = `${words.slice(0, wordCount).join(' ')}...`;
          }
          return `ID ${id} - ${short}`;
        };

        let totalItems = 0;
        let laborItems = 0;
        let withPerson = 0;
        (items || []).forEach(it => {
          totalItems += 1;
          const labor = parseCostNumber(it.labor_costs || it.laborCosts);
          if (labor > 0) laborItems += 1;
          const links = it._links || {};
          const assignee = links.assignee && links.assignee.title;
          const responsible = links.responsible && links.responsible.title;
          const author = links.author && links.author.title;
          const person = assignee || responsible || author || 'Sin involucrado';
          withPerson += 1;
          const isPhase = (getTypeTitle(it) || '').toLowerCase().includes('fase');
          const label = formatLabel(it, isPhase ? 4 : 1);
          const hasParent = !!getParentId(it);
          const target = isPhase ? mothersBuckets : childrenBuckets;
          if (!target.has(label)) {
            target.set(label, { __full: getFullLabel(it), __roles: new Set() });
            if (isPhase) {
              // mothers order stays as encountered
            } else if (hasParent) {
              childLabels.push(label);
            } else {
              independentLabels.push(label);
            }
          }
          const bucket = target.get(label);
          bucket.__roles.add(buildRoleLabel(it));
          const laborValue = Number.isFinite(labor) ? labor : 0;
          bucket[person] = (bucket[person] || 0) + laborValue;
        });

        const motherLabels = Array.from(mothersBuckets.keys());
        const childrenLabels = independentLabels.concat(childLabels);
        const motherLabelLookup = buildLabelLookup(motherLabels, mothersBuckets);
        const childLabelLookup = buildLabelLookup(childrenLabels, childrenBuckets);
        const motherRoleLookup = buildRoleLookup(motherLabels, mothersBuckets);
        const childRoleLookup = buildRoleLookup(childrenLabels, childrenBuckets);
        const motherTitleLookup = Object.fromEntries(
          motherLabels.map(label => [label, [motherLabelLookup[label], motherRoleLookup[label]].filter(Boolean).join(' | ')])
        );
        const childTitleLookup = Object.fromEntries(
          childrenLabels.map(label => [label, [childLabelLookup[label], childRoleLookup[label]].filter(Boolean).join(' | ')])
        );
        const motherDatasets = buildDatasets(motherLabels, mothersBuckets);
        const childDatasets = buildDatasets(childrenLabels, childrenBuckets);
        const totalLabor = (items || []).reduce((sum, it) => {
          const isPhase = (getTypeTitle(it) || '').toLowerCase().includes('fase');
          const hasParent = !!getParentId(it);
          const isMainOrIndependent = isPhase || !hasParent;
          if (!isMainOrIndependent) return sum;
          const val = parseCostNumber(it.labor_costs || it.laborCosts);
          return sum + (Number(val) || 0);
        }, 0);
        if (laborPeopleTotal) {
          laborPeopleTotal.textContent = `Total: ${totalLabor.toFixed(2)}`;
        }
        const totalChildren = (items || []).reduce((sum, it) => {
          const hasParent = !!getParentId(it);
          if (!hasParent) return sum;
          const val = parseCostNumber(it.labor_costs || it.laborCosts);
          return sum + (Number(val) || 0);
        }, 0);
        if (laborChildrenTotal) {
          laborChildrenTotal.textContent = `Total: ${totalChildren.toFixed(2)}`;
        }
        const getParentWidth = (canvas) => {
          if (laborPeoplePanel) {
            const styles = window.getComputedStyle(laborPeoplePanel);
            const padLeft = parseFloat(styles.paddingLeft) || 0;
            const padRight = parseFloat(styles.paddingRight) || 0;
            const inner = laborPeoplePanel.getBoundingClientRect().width - padLeft - padRight;
            if (inner > 0) return inner;
          }
          const direct = canvas.parentElement ? canvas.parentElement.clientWidth : 0;
          if (direct) return direct;
          return canvas.clientWidth || 0;
        };
        const rowHeight = 35;
        const basePadding = 100;
        const calcHeight = (labelCount) => {
          return Math.max(140, basePadding + labelCount * rowHeight);
        };
        const setCanvasSize = (canvas, height) => {
          const width = Math.max(320, getParentWidth(canvas));
          let maxWidth = width;
          if (realHoursPanel) {
            const styles = window.getComputedStyle(realHoursPanel);
            const padLeft = parseFloat(styles.paddingLeft) || 0;
            const padRight = parseFloat(styles.paddingRight) || 0;
            const inner = realHoursPanel.clientWidth - padLeft - padRight;
            if (inner > 0) maxWidth = inner;
          }
          const clamped = Math.min(width, maxWidth);
          canvas.style.width = `${clamped}px`;
          canvas.style.height = `${height}px`;
          canvas.width = Math.round(clamped);
          canvas.height = Math.round(height);
        };
        setCanvasSize(laborPeopleMothersChart, calcHeight(motherLabels.length));
        setCanvasSize(laborPeopleChildrenChart, calcHeight(childrenLabels.length));

        const createLabelHoverPlugin = (labels) => ({
          id: `labelHover-${Math.random().toString(36).slice(2)}`,
          afterEvent(chart, args) {
            const event = args && args.event;
            if (!event) return;
            const { chartArea, scales } = chart;
            const yScale = scales.y;
            if (!chartArea || !yScale) return;
            const x = event.x;
            const y = event.y;
            const inY = y >= chartArea.top && y <= chartArea.bottom;
            const inLabelZone = x >= (chartArea.left - yScale.width) && x <= chartArea.left;
            if (!inY || !inLabelZone) {
              if (chart.$labelHoverActive) {
                chart.$labelHoverActive = false;
                chart.setActiveElements([]);
                if (chart.tooltip) chart.tooltip.setActiveElements([], { x, y });
                chart.update();
              }
              return;
            }
            const value = yScale.getValueForPixel(y);
            const index = labels.indexOf(String(value));
            if (index < 0) return;
            chart.$labelHoverActive = true;
            chart.setActiveElements([{ datasetIndex: 0, index }]);
            if (chart.tooltip) chart.tooltip.setActiveElements([{ datasetIndex: 0, index }], { x, y });
            chart.update();
          }
        });
        const rolePluginMothers = {
          id: 'roleLabelsMothers',
          afterDatasetsDraw(chart) {
            const { ctx, scales } = chart;
            const yScale = scales.y;
            const xScale = scales.x;
            if (!yScale || !xScale) return;
            const meta = chart.getDatasetMeta(0);
            const fitText = (text, maxWidth) => {
              if (ctx.measureText(text).width <= maxWidth) return text;
              let clipped = text;
              while (clipped.length > 0 && ctx.measureText(`${clipped}...`).width > maxWidth) {
                clipped = clipped.slice(0, -1);
              }
              return clipped ? `${clipped}...` : '';
            };
            ctx.save();
            ctx.fillStyle = '#ffffff';
            ctx.font = '10px Inter, sans-serif';
            ctx.textBaseline = 'middle';
            ctx.textAlign = 'left';
            motherLabels.forEach((label, idx) => {
              const roleText = motherRoleLookup[label];
              if (!roleText) return;
              const total = (chart.data.datasets || []).reduce((sum, ds) => {
                const val = ds.data && ds.data[idx];
                return sum + (Number(val) || 0);
              }, 0);
              if (!total) return;
              const xStart = xScale.getPixelForValue(0);
              const xEnd = xScale.getPixelForValue(total);
              const left = Math.min(xStart, xEnd);
              const right = Math.max(xStart, xEnd);
              const barWidth = right - left;
              if (barWidth < 12) return;
              const bar = meta.data && meta.data[idx];
              const y = bar ? bar.y : yScale.getPixelForValue(label);
              if (!Number.isFinite(y)) return;
              const text = fitText(roleText, barWidth - 8);
              if (!text) return;
              ctx.save();
              ctx.beginPath();
              ctx.rect(left, y - 10, barWidth, 20);
              ctx.clip();
              ctx.fillText(text, left + 4, y);
              ctx.restore();
            });
            ctx.restore();
          }
        };
        const valuePluginMothers = {
          id: 'valueLabelsMothers',
          afterDatasetsDraw(chart) {
            const { ctx, scales, chartArea } = chart;
            const yScale = scales.y;
            const xScale = scales.x;
            if (!yScale || !xScale) return;
            ctx.save();
            ctx.fillStyle = '#0f172a';
            ctx.font = '10px Inter, sans-serif';
            ctx.textBaseline = 'middle';
            ctx.textAlign = 'left';
            motherLabels.forEach((label, idx) => {
              const total = (chart.data.datasets || []).reduce((sum, ds) => {
                const val = ds.data && ds.data[idx];
                return sum + (Number(val) || 0);
              }, 0);
              const y = yScale.getPixelForValue(label);
              if (!Number.isFinite(y)) return;
              const text = total > 0 ? total.toFixed(2) : 'N.D.';
              const xValue = xScale.getPixelForValue(total || 0);
              let x = xValue + 6;
              const maxX = chartArea.right - ctx.measureText(text).width - 24;
              if (x > maxX) x = maxX;
              if (x < chartArea.left) x = chartArea.left;
              ctx.fillText(text, x, y);
            });
            ctx.restore();
          }
        };
        if (laborPeopleMothersChartInstance) laborPeopleMothersChartInstance.destroy();
        const labelHoverMothers = createLabelHoverPlugin(motherLabels);
        laborPeopleMothersChartInstance = new Chart(laborPeopleMothersChart.getContext('2d'), {
          type: 'bar',
          data: {
            labels: motherLabels,
            datasets: motherDatasets
          },
          options: {
            indexAxis: 'y',
            devicePixelRatio: 1,
            responsive: false,
            maintainAspectRatio: false,
            layout: { padding: { right: 30 } },
            datasets: {
              bar: {
                barThickness: 24,
                maxBarThickness: 28
              }
            },
            plugins: {
              legend: {
                display: false,
                position: 'bottom',
                align: 'center',
                labels: { boxWidth: 12, boxHeight: 12, font: { size: 11 } }
              },
              tooltip: {
                enabled: true,
                bodyFont: { size: 10 },
                filter: (ctx) => ctx.datasetIndex === 0,
                callbacks: {
                  title: (items) => {
                    const first = items && items[0];
                    const key = first ? first.label : '';
                    return motherLabelLookup[key] || key;
                  },
                  label: (ctx) => {
                    const key = ctx && ctx.label ? ctx.label : '';
                    return motherRoleLookup[key] || '';
                  }
                }
              }
            },
            scales: {
              x: {
                stacked: true,
                title: { display: true, text: 'Costos de mano de obra', font: { size: 11 } },
                ticks: { font: { size: 10 } },
                grid: { color: 'rgba(203, 213, 225, 0.65)', lineWidth: 0.75 }
              },
              y: {
                stacked: true,
                ticks: { align: 'start', padding: 6, font: { size: 10 } },
                afterFit: (scale) => { scale.width = 180; },
                grid: { color: 'rgba(203, 213, 225, 0.65)', lineWidth: 0.75 }
              }
            }
          },
          plugins: [rolePluginMothers, valuePluginMothers, labelHoverMothers]
        });

        const rolePluginChildren = {
          id: 'roleLabelsChildren',
          afterDatasetsDraw(chart) {
            const { ctx, scales } = chart;
            const yScale = scales.y;
            const xScale = scales.x;
            if (!yScale || !xScale) return;
            const meta = chart.getDatasetMeta(0);
            const fitText = (text, maxWidth) => {
              if (ctx.measureText(text).width <= maxWidth) return text;
              let clipped = text;
              while (clipped.length > 0 && ctx.measureText(`${clipped}...`).width > maxWidth) {
                clipped = clipped.slice(0, -1);
              }
              return clipped ? `${clipped}...` : '';
            };
            ctx.save();
            ctx.fillStyle = '#ffffff';
            ctx.font = '10px Inter, sans-serif';
            ctx.textBaseline = 'middle';
            ctx.textAlign = 'left';
            childrenLabels.forEach((label, idx) => {
              const roleText = childRoleLookup[label];
              if (!roleText) return;
              const total = (chart.data.datasets || []).reduce((sum, ds) => {
                const val = ds.data && ds.data[idx];
                return sum + (Number(val) || 0);
              }, 0);
              if (!total) return;
              const xStart = xScale.getPixelForValue(0);
              const xEnd = xScale.getPixelForValue(total);
              const left = Math.min(xStart, xEnd);
              const right = Math.max(xStart, xEnd);
              const barWidth = right - left;
              if (barWidth < 12) return;
              const bar = meta.data && meta.data[idx];
              const y = bar ? bar.y : yScale.getPixelForValue(label);
              if (!Number.isFinite(y)) return;
              const text = fitText(roleText, barWidth - 8);
              if (!text) return;
              ctx.save();
              ctx.beginPath();
              ctx.rect(left, y - 10, barWidth, 20);
              ctx.clip();
              ctx.fillText(text, left + 4, y);
              ctx.restore();
            });
            ctx.restore();
          }
        };
        const valuePluginChildren = {
          id: 'valueLabelsChildren',
          afterDatasetsDraw(chart) {
            const { ctx, scales, chartArea } = chart;
            const yScale = scales.y;
            const xScale = scales.x;
            if (!yScale || !xScale) return;
            ctx.save();
            ctx.fillStyle = '#0f172a';
            ctx.font = '10px Inter, sans-serif';
            ctx.textBaseline = 'middle';
            ctx.textAlign = 'left';
            childrenLabels.forEach((label, idx) => {
              const total = (chart.data.datasets || []).reduce((sum, ds) => {
                const val = ds.data && ds.data[idx];
                return sum + (Number(val) || 0);
              }, 0);
              const y = yScale.getPixelForValue(label);
              if (!Number.isFinite(y)) return;
              const text = total > 0 ? total.toFixed(2) : 'N.D.';
              const xValue = xScale.getPixelForValue(total || 0);
              let x = xValue + 6;
              const maxX = chartArea.right - ctx.measureText(text).width - 8;
              if (x > maxX) x = maxX;
              if (x < chartArea.left) x = chartArea.left;
              ctx.fillText(text, x, y);
            });
            ctx.restore();
          }
        };
        if (laborPeopleChildrenChartInstance) laborPeopleChildrenChartInstance.destroy();
        const labelHoverChildren = createLabelHoverPlugin(childrenLabels);
        laborPeopleChildrenChartInstance = new Chart(laborPeopleChildrenChart.getContext('2d'), {
          type: 'bar',
          data: {
            labels: childrenLabels,
            datasets: childDatasets
          },
          options: {
            indexAxis: 'y',
            devicePixelRatio: 1,
            responsive: false,
            maintainAspectRatio: false,
            layout: { padding: { right: 30 } },
            datasets: {
              bar: {
                barThickness: 20,
                maxBarThickness: 24
              }
            },
            plugins: {
              legend: {
                display: false,
                position: 'bottom',
                align: 'center',
                labels: { boxWidth: 12, boxHeight: 12, font: { size: 11 } }
              },
              tooltip: {
                enabled: true,
                bodyFont: { size: 10 },
                filter: (ctx) => ctx.datasetIndex === 0,
                callbacks: {
                  title: (items) => {
                    const first = items && items[0];
                    const key = first ? first.label : '';
                    return childLabelLookup[key] || key;
                  },
                  label: (ctx) => {
                    const key = ctx && ctx.label ? ctx.label : '';
                    return childRoleLookup[key] || '';
                  }
                }
              }
            },
            scales: {
              x: {
                stacked: true,
                title: { display: true, text: 'Costos de mano de obra', font: { size: 11 } },
                ticks: { font: { size: 10 } },
                grid: { color: 'rgba(203, 213, 225, 0.65)', lineWidth: 0.75 }
              },
              y: {
                stacked: true,
                ticks: { align: 'start', padding: 6, font: { size: 10 } },
                afterFit: (scale) => { scale.width = 180; },
                grid: { color: 'rgba(203, 213, 225, 0.65)', lineWidth: 0.75 }
              }
            }
          },
          plugins: [rolePluginChildren, valuePluginChildren, labelHoverChildren]
        });
      }

      function drawRealHoursChart(items) {
        if (!realHoursMainChart || !realHoursChildChart) return;
        const panelWidth = realHoursPanel ? realHoursPanel.getBoundingClientRect().width : 0;
        if (panelWidth < 10) {
          setTimeout(() => drawRealHoursChart(items), 120);
          return;
        }
        const palette = ['#2563eb', '#16a34a', '#f59e0b', '#ef4444', '#8b5cf6', '#0ea5e9'];
        const colorForIndex = (idx) => {
          if (idx < palette.length) return palette[idx];
          const hue = (idx * 47) % 360;
          return `hsl(${hue}, 70%, 50%)`;
        };
        const buildLabelLookup = (labels, buckets) => {
          const lookup = {};
          labels.forEach(label => {
            const bucket = buckets.get(label) || {};
            if (bucket.__full) lookup[label] = bucket.__full;
          });
          return lookup;
        };
        const buildRoleLookup = (labels, buckets) => {
          const lookup = {};
          labels.forEach(label => {
            const bucket = buckets.get(label) || {};
            if (bucket.__roles && bucket.__roles.size) {
              lookup[label] = Array.from(bucket.__roles).join(' | ');
            }
          });
          return lookup;
        };
        const buildDatasets = (labels, buckets) => {
          const personTotals = {};
          labels.forEach(label => {
            const bucket = buckets.get(label) || {};
            Object.keys(bucket).forEach(name => {
              if (name.startsWith('__')) return;
              personTotals[name] = (personTotals[name] || 0) + bucket[name];
            });
          });
          const peopleSorted = Object.keys(personTotals)
            .sort((a, b) => personTotals[b] - personTotals[a]);
          const topPeople = peopleSorted.slice(0, 5);
          const others = peopleSorted.slice(5);
          const datasets = [];
          topPeople.forEach((name, idx) => {
            datasets.push({
              label: name,
              data: labels.map(label => (buckets.get(label) || {})[name] || 0),
              backgroundColor: colorForIndex(idx)
            });
          });
          if (others.length) {
            datasets.push({
              label: 'Otros',
              data: labels.map(label => {
                const bucket = buckets.get(label) || {};
                return others.reduce((sum, name) => sum + (bucket[name] || 0), 0);
              }),
              backgroundColor: '#94a3b8'
            });
          }
          return datasets;
        };

        const buildRoleLabel = (it) => {
          const links = it._links || {};
          const assignee = links.assignee && links.assignee.title;
          const responsible = links.responsible && links.responsible.title;
          if (assignee && responsible) return `Asig: ${assignee} | Resp: ${responsible}`;
          if (assignee) return `Asig: ${assignee}`;
          if (responsible) return `Resp: ${responsible}`;
          return 'Sin involucrado';
        };
        const getFullLabel = (it) => {
          const id = it.id || '--';
          const name = it.subject || it.name || String(getTypeTitle(it) || 'Sin nombre');
          const clean = name.replace(/\s+/g, ' ').trim();
          return `ID ${id} - ${clean}`;
        };
        const formatLabel = (it, wordCount) => {
          const id = it.id || '--';
          const name = it.subject || it.name || String(getTypeTitle(it) || 'Sin nombre');
          const clean = name.replace(/\s+/g, ' ').trim();
          const words = clean.split(' ');
          let short = clean;
          if (wordCount && words.length > wordCount) {
            short = `${words.slice(0, wordCount).join(' ')}...`;
          }
          return `ID ${id} - ${short}`;
        };

        const mainBuckets = new Map();
        const childBuckets = new Map();
        const independentLabels = [];
        const childLabels = [];

        (items || []).forEach(it => {
          const hours = parseDurationHours(it.spent_time || it.spentTime);
          const links = it._links || {};
          const assignee = links.assignee && links.assignee.title;
          const responsible = links.responsible && links.responsible.title;
          const author = links.author && links.author.title;
          const person = assignee || responsible || author || 'Sin involucrado';
          const isPhase = (getTypeTitle(it) || '').toLowerCase().includes('fase');
          const hasParent = !!getParentId(it);
          const label = formatLabel(it, isPhase ? 4 : 1);
          const target = isPhase || !hasParent ? mainBuckets : childBuckets;
          if (!target.has(label)) {
            target.set(label, { __full: getFullLabel(it), __roles: new Set() });
            if (target === childBuckets) {
              if (hasParent) childLabels.push(label);
              else independentLabels.push(label);
            }
          }
          const bucket = target.get(label);
          bucket.__roles.add(buildRoleLabel(it));
          bucket[person] = (bucket[person] || 0) + (Number(hours) || 0);
        });

        const mainLabels = Array.from(mainBuckets.keys());
        const childrenLabels = independentLabels.concat(childLabels);
        const mainLabelLookup = buildLabelLookup(mainLabels, mainBuckets);
        const childLabelLookup = buildLabelLookup(childrenLabels, childBuckets);
        const mainRoleLookup = buildRoleLookup(mainLabels, mainBuckets);
        const childRoleLookup = buildRoleLookup(childrenLabels, childBuckets);
        const mainTitleLookup = Object.fromEntries(
          mainLabels.map(label => [label, [mainLabelLookup[label], mainRoleLookup[label]].filter(Boolean).join(' | ')])
        );
        const childTitleLookup = Object.fromEntries(
          childrenLabels.map(label => [label, [childLabelLookup[label], childRoleLookup[label]].filter(Boolean).join(' | ')])
        );
        const mainDatasets = buildDatasets(mainLabels, mainBuckets);
        const childDatasets = buildDatasets(childrenLabels, childBuckets);
        const mainTotals = mainLabels.map((_, idx) => {
          return (mainDatasets || []).reduce((sum, ds) => {
            const val = ds.data && ds.data[idx];
            return sum + (Number(val) || 0);
          }, 0);
        });
        const childTotals = childrenLabels.map((_, idx) => {
          return (childDatasets || []).reduce((sum, ds) => {
            const val = ds.data && ds.data[idx];
            return sum + (Number(val) || 0);
          }, 0);
        });
        const mainMaxValue = Math.max(0, ...mainTotals);
        const childMaxValue = Math.max(0, ...childTotals);

        const totalMainHours = (items || []).reduce((sum, it) => {
          const isPhase = (getTypeTitle(it) || '').toLowerCase().includes('fase');
          const hasParent = !!getParentId(it);
          const isMainOrIndependent = isPhase || !hasParent;
          if (!isMainOrIndependent) return sum;
          return sum + (Number(parseDurationHours(it.spent_time || it.spentTime)) || 0);
        }, 0);
        const totalChildHours = (items || []).reduce((sum, it) => {
          const hasParent = !!getParentId(it);
          if (!hasParent) return sum;
          return sum + (Number(parseDurationHours(it.spent_time || it.spentTime)) || 0);
        }, 0);
        if (realHoursTotal) realHoursTotal.textContent = `Total: ${totalMainHours.toFixed(1)} h`;
        if (realHoursChildrenTotal) realHoursChildrenTotal.textContent = `Total: ${totalChildHours.toFixed(1)} h`;

        const getParentWidth = (canvas) => {
          if (realHoursPanel) {
            const styles = window.getComputedStyle(realHoursPanel);
            const padLeft = parseFloat(styles.paddingLeft) || 0;
            const padRight = parseFloat(styles.paddingRight) || 0;
            const inner = realHoursPanel.clientWidth - padLeft - padRight;
            if (inner > 0) return inner;
          }
          const direct = canvas.parentElement ? canvas.parentElement.clientWidth : 0;
          if (direct) return direct;
          return canvas.clientWidth || 0;
        };
        const rowHeight = 35;
        const basePadding = 100;
        const calcHeight = (labelCount) => Math.max(140, basePadding + labelCount * rowHeight);
        const setCanvasSize = (canvas, height) => {
          const width = Math.max(320, getParentWidth(canvas));
          canvas.style.width = '100%';
          canvas.style.height = `${height}px`;
          canvas.width = Math.round(width);
          canvas.height = Math.round(height);
        };
        setCanvasSize(realHoursMainChart, calcHeight(mainLabels.length));
        setCanvasSize(realHoursChildChart, calcHeight(childrenLabels.length));

        const createLabelHoverPlugin = (labels) => ({
          id: `labelHover-${Math.random().toString(36).slice(2)}`,
          afterEvent(chart, args) {
            const event = args && args.event;
            if (!event) return;
            const { chartArea, scales } = chart;
            const yScale = scales.y;
            if (!chartArea || !yScale) return;
            const x = event.x;
            const y = event.y;
            const inY = y >= chartArea.top && y <= chartArea.bottom;
            const inLabelZone = x >= (chartArea.left - yScale.width) && x <= chartArea.left;
            if (!inY || !inLabelZone) {
              if (chart.$labelHoverActive) {
                chart.$labelHoverActive = false;
                chart.setActiveElements([]);
                if (chart.tooltip) chart.tooltip.setActiveElements([], { x, y });
                chart.update();
              }
              return;
            }
            const value = yScale.getValueForPixel(y);
            const index = labels.indexOf(String(value));
            if (index < 0) return;
            chart.$labelHoverActive = true;
            chart.setActiveElements([{ datasetIndex: 0, index }]);
            if (chart.tooltip) chart.tooltip.setActiveElements([{ datasetIndex: 0, index }], { x, y });
            chart.update();
          }
        });

        const rolePluginMain = {
          id: 'roleLabelsRealHoursMain',
          afterDatasetsDraw(chart) {
            const { ctx, scales } = chart;
            const yScale = scales.y;
            const xScale = scales.x;
            if (!yScale || !xScale) return;
            const meta = chart.getDatasetMeta(0);
            const fitText = (text, maxWidth) => {
              if (ctx.measureText(text).width <= maxWidth) return text;
              let clipped = text;
              while (clipped.length > 0 && ctx.measureText(`${clipped}...`).width > maxWidth) {
                clipped = clipped.slice(0, -1);
              }
              return clipped ? `${clipped}...` : '';
            };
            ctx.save();
            ctx.fillStyle = '#ffffff';
            ctx.font = '10px Inter, sans-serif';
            ctx.textBaseline = 'middle';
            ctx.textAlign = 'left';
            mainLabels.forEach((label, idx) => {
              const roleText = mainRoleLookup[label];
              if (!roleText) return;
              const total = (chart.data.datasets || []).reduce((sum, ds) => {
                const val = ds.data && ds.data[idx];
                return sum + (Number(val) || 0);
              }, 0);
              if (!total) return;
              const xStart = xScale.getPixelForValue(0);
              const xEnd = xScale.getPixelForValue(total);
              const left = Math.min(xStart, xEnd);
              const right = Math.max(xStart, xEnd);
              const barWidth = right - left;
              if (barWidth < 12) return;
              const bar = meta.data && meta.data[idx];
              const y = bar ? bar.y : yScale.getPixelForValue(label);
              if (!Number.isFinite(y)) return;
              const text = fitText(roleText, barWidth - 8);
              if (!text) return;
              ctx.save();
              ctx.beginPath();
              ctx.rect(left, y - 10, barWidth, 20);
              ctx.clip();
              ctx.fillText(text, left + 4, y);
              ctx.restore();
            });
            ctx.restore();
          }
        };

        const rolePluginChild = {
          id: 'roleLabelsRealHoursChild',
          afterDatasetsDraw(chart) {
            const { ctx, scales } = chart;
            const yScale = scales.y;
            const xScale = scales.x;
            if (!yScale || !xScale) return;
            const meta = chart.getDatasetMeta(0);
            const fitText = (text, maxWidth) => {
              if (ctx.measureText(text).width <= maxWidth) return text;
              let clipped = text;
              while (clipped.length > 0 && ctx.measureText(`${clipped}...`).width > maxWidth) {
                clipped = clipped.slice(0, -1);
              }
              return clipped ? `${clipped}...` : '';
            };
            ctx.save();
            ctx.fillStyle = '#ffffff';
            ctx.font = '10px Inter, sans-serif';
            ctx.textBaseline = 'middle';
            ctx.textAlign = 'left';
            childrenLabels.forEach((label, idx) => {
              const roleText = childRoleLookup[label];
              if (!roleText) return;
              const total = (chart.data.datasets || []).reduce((sum, ds) => {
                const val = ds.data && ds.data[idx];
                return sum + (Number(val) || 0);
              }, 0);
              if (!total) return;
              const xStart = xScale.getPixelForValue(0);
              const xEnd = xScale.getPixelForValue(total);
              const left = Math.min(xStart, xEnd);
              const right = Math.max(xStart, xEnd);
              const barWidth = right - left;
              if (barWidth < 12) return;
              const bar = meta.data && meta.data[idx];
              const y = bar ? bar.y : yScale.getPixelForValue(label);
              if (!Number.isFinite(y)) return;
              const text = fitText(roleText, barWidth - 8);
              if (!text) return;
              ctx.save();
              ctx.beginPath();
              ctx.rect(left, y - 10, barWidth, 20);
              ctx.clip();
              ctx.fillText(text, left + 4, y);
              ctx.restore();
            });
            ctx.restore();
          }
        };

        const valuePluginMain = {
          id: 'valueLabelsRealHoursMain',
          afterDatasetsDraw(chart) {
            const { ctx, scales, chartArea } = chart;
            const yScale = scales.y;
            const xScale = scales.x;
            if (!yScale || !xScale) return;
            ctx.save();
            ctx.font = '10px Inter, sans-serif';
            ctx.textBaseline = 'middle';
            ctx.textAlign = 'left';
            const meta = chart.getDatasetMeta(0);
            mainLabels.forEach((label, idx) => {
              const total = (chart.data.datasets || []).reduce((sum, ds) => {
                const val = ds.data && ds.data[idx];
                return sum + (Number(val) || 0);
              }, 0);
              const y = yScale.getPixelForValue(label);
              if (!Number.isFinite(y)) return;
              const text = total > 0 ? `${total.toFixed(1)} h` : 'N.D.';
              if (total > 0) {
                const xStart = xScale.getPixelForValue(0);
                const xEnd = xScale.getPixelForValue(total);
                const textWidth = ctx.measureText(text).width;
                let x = xEnd + 6;
                ctx.fillStyle = '#0f172a';
                if (x + textWidth > chartArea.right - 2) {
                  x = xEnd - textWidth - 6;
                  if (x < xStart + 2) x = xStart + 2;
                }
                ctx.fillText(text, x, y);
              } else {
                ctx.fillStyle = '#0f172a';
                const x = Math.min(chartArea.right - 4, xScale.getPixelForValue(0) + 6);
                ctx.fillText(text, x, y);
              }
            });
            ctx.restore();
          }
        };

        const valuePluginChild = {
          id: 'valueLabelsRealHoursChild',
          afterDatasetsDraw(chart) {
            const { ctx, scales, chartArea } = chart;
            const yScale = scales.y;
            const xScale = scales.x;
            if (!yScale || !xScale) return;
            ctx.save();
            ctx.fillStyle = '#0f172a';
            ctx.font = '10px Inter, sans-serif';
            ctx.textBaseline = 'middle';
            ctx.textAlign = 'left';
            childrenLabels.forEach((label, idx) => {
              const total = (chart.data.datasets || []).reduce((sum, ds) => {
                const val = ds.data && ds.data[idx];
                return sum + (Number(val) || 0);
              }, 0);
              const y = yScale.getPixelForValue(label);
              if (!Number.isFinite(y)) return;
              const text = total > 0 ? `${total.toFixed(1)} h` : 'N.D.';
              const xValue = xScale.getPixelForValue(total || 0);
              let x = xValue + 6;
              const maxX = chartArea.right - ctx.measureText(text).width - 2;
              if (x > maxX) x = maxX;
              if (x < chartArea.left) x = chartArea.left;
              ctx.fillText(text, x, y);
            });
            ctx.restore();
          }
        };

        const labelHoverMain = createLabelHoverPlugin(mainLabels);
        const labelHoverChild = createLabelHoverPlugin(childrenLabels);

        if (realHoursMainChartInstance) realHoursMainChartInstance.destroy();
        realHoursMainChartInstance = new Chart(realHoursMainChart.getContext('2d'), {
          type: 'bar',
          data: {
            labels: mainLabels,
            datasets: mainDatasets
          },
          options: {
            indexAxis: 'y',
            devicePixelRatio: 1,
            responsive: false,
            maintainAspectRatio: false,
            layout: { padding: { right: 30 } },
            datasets: {
              bar: { barThickness: 24, maxBarThickness: 28 }
            },
            plugins: {
              legend: { display: false },
              tooltip: {
                enabled: true,
                bodyFont: { size: 10 },
                callbacks: {
                  title: (items) => {
                    const first = items && items[0];
                    const key = first ? first.label : '';
                    return mainLabelLookup[key] || key;
                  },
                  label: (ctx) => {
                    const key = ctx && ctx.label ? ctx.label : '';
                    return mainRoleLookup[key] || '';
                  }
                }
              }
            },
            scales: {
              x: {
                stacked: true,
                title: { display: true, text: 'Horas reales', font: { size: 11 } },
                ticks: { font: { size: 10 }, stepSize: 1 },
                grid: { color: 'rgba(203, 213, 225, 0.65)', lineWidth: 0.75 },
                max: mainMaxValue ? Math.ceil(mainMaxValue) + 2 : undefined,
                beginAtZero: true
              },
              y: {
                stacked: true,
                ticks: { align: 'start', padding: 6, font: { size: 10 } },
                afterFit: (scale) => { scale.width = 180; },
                grid: { color: 'rgba(203, 213, 225, 0.65)', lineWidth: 0.75 }
              }
            }
          },
          plugins: [rolePluginMain, valuePluginMain, labelHoverMain]
        });

        if (realHoursChildChartInstance) realHoursChildChartInstance.destroy();
        realHoursChildChartInstance = new Chart(realHoursChildChart.getContext('2d'), {
          type: 'bar',
          data: {
            labels: childrenLabels,
            datasets: childDatasets
          },
          options: {
            indexAxis: 'y',
            devicePixelRatio: 1,
            responsive: false,
            maintainAspectRatio: false,
            layout: { padding: { right: 30 } },
            datasets: {
              bar: { barThickness: 20, maxBarThickness: 24 }
            },
            plugins: {
              legend: { display: false },
              tooltip: {
                enabled: true,
                bodyFont: { size: 10 },
                callbacks: {
                  title: (items) => {
                    const first = items && items[0];
                    const key = first ? first.label : '';
                    return childLabelLookup[key] || key;
                  },
                  label: (ctx) => {
                    const key = ctx && ctx.label ? ctx.label : '';
                    return childRoleLookup[key] || '';
                  }
                }
              }
            },
            scales: {
              x: {
                stacked: true,
                title: { display: true, text: 'Horas reales', font: { size: 11 } },
                ticks: { font: { size: 10 } },
                grid: { color: 'rgba(203, 213, 225, 0.65)', lineWidth: 0.75 },
                max: childMaxValue ? Math.ceil(childMaxValue) + 1 : undefined,
                beginAtZero: true
              },
              y: {
                stacked: true,
                ticks: { align: 'start', padding: 6, font: { size: 10 } },
                afterFit: (scale) => { scale.width = 180; },
                grid: { color: 'rgba(203, 213, 225, 0.65)', lineWidth: 0.75 }
              }
            }
          },
          plugins: [rolePluginChild, valuePluginChild, labelHoverChild]
        });
      }

      function drawRolePerformanceChart(items) {
        if (!rolePerformanceMainChart || !rolePerformanceChildChart) return;
        const mainItems = (items || []).filter(it => {
          const isPhase = (getTypeTitle(it) || '').toLowerCase().includes('fase');
          const hasParent = !!getParentId(it);
          return isPhase || !hasParent;
        });
        const childItems = (items || []).filter(it => {
          const typeTitle = (getTypeTitle(it) || '').toLowerCase();
          const isPhase = typeTitle.includes('fase');
          const isMilestone = typeTitle.includes('hito');
          const hasParent = !!getParentId(it);
          return !isPhase && !isMilestone && hasParent;
        });
        buildRolePerformanceChart(mainItems, rolePerformanceMainChart, rolePerformanceMainChartInstance, (inst) => {
          rolePerformanceMainChartInstance = inst;
        });
        buildRolePerformanceChart(childItems, rolePerformanceChildChart, rolePerformanceChildChartInstance, (inst) => {
          rolePerformanceChildChartInstance = inst;
        });
      }

      function buildRolePerformanceChart(items, chartEl, currentInstance, setInstance) {
        if (!chartEl) return;
        const buildRoleLabel = (it) => {
          const links = it._links || {};
          const assignee = links.assignee && links.assignee.title;
          const responsible = links.responsible && links.responsible.title;
          if (assignee && responsible) return `Asig: ${assignee} | Resp: ${responsible}`;
          if (assignee) return `Asig: ${assignee}`;
          if (responsible) return `Resp: ${responsible}`;
          return 'Sin involucrado';
        };
        const getFullLabel = (it) => {
          const id = it.id || '--';
          const name = it.subject || it.name || String(getTypeTitle(it) || 'Sin nombre');
          const clean = name.replace(/\s+/g, ' ').trim();
          return `ID ${id} - ${clean}`;
        };
        const formatLabel = (it, wordCount) => {
          const id = it.id || '--';
          const name = it.subject || it.name || String(getTypeTitle(it) || 'Sin nombre');
          const clean = name.replace(/\s+/g, ' ').trim();
          const words = clean.split(' ');
          let short = clean;
          if (wordCount && words.length > wordCount) {
            short = `${words.slice(0, wordCount).join(' ')}...`;
          }
          return `ID ${id} - ${short}`;
        };
        const rows = (items || []).map(it => {
          const rawPct = it.derivedPercentageDone ?? it.percentageDone;
          const pct = Number.isFinite(Number(rawPct)) ? Number(rawPct) : 0;
          return {
            id: it.id,
            shortLabel: formatLabel(it, 6),
            fullLabel: getFullLabel(it),
            roleLabel: buildRoleLabel(it),
            pct
          };
        });

        rows.forEach((row, idx) => {
          row.displayLabel = `${idx + 1}. ${row.roleLabel}`;
        });
        const labels = rows.map(r => r.displayLabel);
        const pctData = rows.map(r => r.pct);

        const height = Math.max(240, labels.length * 30 + 80);
        chartEl.style.height = `${height}px`;
        chartEl.height = Math.round(height);

        if (currentInstance) currentInstance.destroy();
        const labelPlugin = {
          id: 'rolePerformanceLabels',
          afterDatasetsDraw(chart) {
            const { ctx, scales, chartArea } = chart;
            const xScale = scales.x;
            const yScale = scales.y;
            if (!xScale || !yScale) return;
            ctx.save();
            ctx.fillStyle = '#ffffff';
            ctx.font = '10px Inter, sans-serif';
            ctx.textBaseline = 'middle';
            ctx.textAlign = 'left';
            const meta = chart.getDatasetMeta(0);
            rows.forEach((row, idx) => {
              const y = yScale.getPixelForValue(row.displayLabel);
              const barEnd = xScale.getPixelForValue(row.pct || 0);
              const barStart = xScale.getPixelForValue(0);
              const barEl = meta && meta.data ? meta.data[idx] : null;
              const barHeight = barEl && Number.isFinite(barEl.height) ? barEl.height : 18;
              const textX = barStart + 6;
              const clipWidth = Math.max(0, barEnd - barStart - 4);
              ctx.save();
              ctx.beginPath();
              ctx.rect(barStart + 2, y - barHeight / 2, clipWidth, barHeight);
              ctx.clip();
              ctx.fillText(row.shortLabel, textX, y);
              ctx.restore();
            });
            ctx.restore();
          }
        };
        const nextInstance = new Chart(chartEl.getContext('2d'), {
          type: 'bar',
          data: {
            labels,
            datasets: [
              {
                label: '% completado',
                data: pctData,
                backgroundColor: '#2563eb',
                borderColor: '#1d4ed8',
                borderWidth: 1,
                borderSkipped: false,
                minBarLength: 6
              }
            ]
          },
          options: {
            indexAxis: 'y',
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
              legend: { display: false },
              tooltip: {
                callbacks: {
                  title: (items) => {
                    const row = rows[items[0]?.dataIndex];
                    return row ? row.fullLabel : '';
                  },
                  label: (ctx) => {
                    const row = rows[ctx.dataIndex];
                    if (!row) return `% completado: ${Number(ctx.raw || 0).toFixed(1)}%`;
                    return `${row.roleLabel} · ${row.pct.toFixed(1)}%`;
                  }
                }
              }
            },
            scales: {
              x: {
                beginAtZero: true,
                max: 100,
                title: { display: true, text: '% completado' },
                ticks: { callback: (val) => `${val}%`, stepSize: 10 }
              },
              y: {
                ticks: { font: { size: 10 } }
              }
            }
          },
          plugins: [labelPlugin]
        });
        setInstance(nextInstance);
      }

      function renderStartcurveLegend(container, chart) {
        if (!container || !chart) return;
        container.innerHTML = '';
        const datasets = chart.data && chart.data.datasets ? chart.data.datasets : [];
        datasets.forEach((ds, idx) => {
          const item = document.createElement('div');
          item.className = 'startcurve-legend-item';
          if (!chart.isDatasetVisible(idx)) item.classList.add('legend-disabled');
          const swatch = document.createElement('span');
          swatch.className = 'legend-dot';
          swatch.style.backgroundColor = ds.pointBackgroundColor || ds.borderColor || '#94a3b8';
          const label = document.createElement('span');
          label.textContent = ds.label || `Serie ${idx + 1}`;
          item.appendChild(swatch);
          item.appendChild(label);
          item.addEventListener('click', () => {
            const nextVisible = !chart.isDatasetVisible(idx);
            chart.setDatasetVisibility(idx, nextVisible);
            item.classList.toggle('legend-disabled', !nextVisible);
            chart.update();
          });
          container.appendChild(item);
        });
      }

      function drawStartCurve(items) {
        if (!startcurveMainChart || !startcurveChildChart) return;
        const mainItems = (items || []).filter(it => {
          const typeTitle = (getTypeTitle(it) || '').toLowerCase();
          const isPhase = typeTitle.includes('fase');
          const hasParent = !!getParentId(it);
          return isPhase || !hasParent;
        });
        const childItems = (items || []).filter(it => {
          const typeTitle = (getTypeTitle(it) || '').toLowerCase();
          const isPhase = typeTitle.includes('fase');
          const isMilestone = typeTitle.includes('hito');
          const hasParent = !!getParentId(it);
          return !isPhase && !isMilestone && hasParent;
        });
        drawStartCurveChart(mainItems, startcurveMainChart, startcurveMainTooltip, startCurveMainChartInstance, (inst) => {
          startCurveMainChartInstance = inst;
        }, startcurveMainLegend);
        drawStartCurveChart(childItems, startcurveChildChart, startcurveChildTooltip, startCurveChildChartInstance, (inst) => {
          startCurveChildChartInstance = inst;
        }, startcurveChildLegend);
      }

      function drawStartCurveChart(items, chartEl, tooltipEl, currentInstance, setInstance, legendEl) {
        if (!chartEl) return;
        const tasks = (items || []).map(it => ({
          id: it.id,
          subject: it.subject || it.name || `Tarea ${it.id || ''}`,
          created: it.created_at || it.createdAt,
          start: it.start_date || it.startDate,
          due: it.due_date || it.dueDate,
          updated: it.updated_at || it.updatedAt
        })).filter(t => t.id !== undefined && t.id !== null && t.id !== '');

        const toDayStr = (d) => {
          const ts = Date.parse(d);
          if (Number.isNaN(ts)) return null;
          return new Date(ts).toISOString().slice(0, 10);
        };

        const dateSet = new Set();

        const bars = tasks
          .map(t => {
            const startDay = toDayStr(t.created);
            const endDay = toDayStr(t.due) ?? startDay;
            if (startDay === null || endDay === null) return null;
            dateSet.add(startDay);
            dateSet.add(endDay);
            return {
              y: String(t.id),
              startDay,
              endDay,
              subject: t.subject
            };
          })
          .filter(Boolean);

        const startPoints = tasks
          .map(t => {
            const d = toDayStr(t.start);
            if (d === null) return null;
            dateSet.add(d);
            return { x: d, y: String(t.id), subject: t.subject };
          })
          .filter(Boolean);

        const createdPoints = tasks
          .map(t => {
            const d = toDayStr(t.created);
            if (d === null) return null;
            dateSet.add(d);
            return { x: d, y: String(t.id), subject: t.subject };
          })
          .filter(Boolean);

        const duePoints = tasks
          .map(t => {
            const d = toDayStr(t.due);
            if (d === null) return null;
            dateSet.add(d);
            return { x: d, y: String(t.id), subject: t.subject };
          })
          .filter(Boolean);

        const updatedPoints = tasks
          .map(t => {
            const d = toDayStr(t.updated);
            if (d === null) return null;
            dateSet.add(d);
            return { x: d, y: String(t.id), subject: t.subject };
          })
          .filter(Boolean);

        const dateLabels = Array.from(dateSet).sort();
        const formatDateLabel = (value) => {
          const raw = String(value || '');
          const match = raw.match(/^(\d{4})-(\d{2})-(\d{2})$/);
          if (!match) return raw;
          const months = ['Ene','Feb','Mar','Abr','May','Jun','Jul','Ago','Sep','Oct','Nov','Dic'];
          const year = match[1].slice(-2);
          const monthIdx = Math.max(0, Math.min(11, Number(match[2]) - 1));
          const day = match[3];
          return `${day}-${months[monthIdx]}-${year}`;
        };

        if (!bars.length || !dateLabels.length) {
          if (currentInstance) currentInstance.destroy();
          setInstance(null);
          if (tooltipEl) tooltipEl.style.opacity = 0;
          return;
        }

        const yLabels = Array.from(new Set([
          ...bars.map(b => b.y),
          ...startPoints.map(p => p.y),
          ...updatedPoints.map(p => p.y)
        ])).sort((a, b) => Number(a) - Number(b)).reverse();

        const barRects = bars.map(b => ({
          y: b.y,
          start: b.startDay,
          end: b.endDay,
          subject: b.subject
        }));

        const pointWithIndex = (arr) => arr.map(p => ({
          y: p.y,
          x: p.x,
          subject: p.subject
        }));

        const startData = pointWithIndex(startPoints);
        const createdData = pointWithIndex(createdPoints);
        const dueData = pointWithIndex(duePoints);
        const updatedData = pointWithIndex(updatedPoints);

        const barPlugin = {
          id: 'startRangeBars',
          beforeDatasetsDraw(chart, args, pluginOptions) {
            const bars = pluginOptions?.bars || [];
            const { ctx, scales } = chart;
            const xScale = scales.x;
            const yScale = scales.y;
            if (!xScale || !yScale) return;
            const yStep = Math.abs((yScale.getPixelForValue(yLabels[1] || yLabels[0]) || 0) - (yScale.getPixelForValue(yLabels[0]) || 0));
            const baseHeight = Math.max(12, yStep - 6);
            const heightFactor = chart.canvas && chart.canvas.id === 'startcurve-main-chart' ? 0.6 : 0.95;
            const height = Math.max(12, baseHeight * heightFactor);
            ctx.save();
            bars.forEach(b => {
              const yPix = yScale.getPixelForValue(b.y);
              const startPix = xScale.getPixelForValue(b.start);
              const endPix = xScale.getPixelForValue(b.end);
              if (!Number.isFinite(yPix) || !Number.isFinite(startPix) || !Number.isFinite(endPix)) return;
              const left = Math.min(startPix, endPix);
              const width = Math.abs(endPix - startPix) || 2;
              const top = yPix - height / 2;
              ctx.fillStyle = '#2563eb';
              ctx.strokeStyle = '#2563eb';
              ctx.lineWidth = 0;
              ctx.beginPath();
              ctx.rect(left, top, width, height);
              ctx.fill();
              const markers = [
                { label: 'Creacion', data: createdData, color: '#f97316' },
                { label: 'Inicio (startDate)', data: startData, color: '#ef4444' },
                { label: 'Vencimiento', data: dueData, color: '#facc15' },
                { label: 'Ultima actualizacion', data: updatedData, color: '#10b981' }
              ];
              markers.forEach((marker, markerIdx) => {
                const visible = chart.isDatasetVisible(markerIdx);
                if (!visible) return;
                const match = marker.data.find(p => p.y === b.y);
                if (!match) return;
                const xPos = xScale.getPixelForValue(match.x);
                if (!Number.isFinite(xPos)) return;
                if (xPos < left || xPos > left + width) return;
                ctx.save();
                ctx.strokeStyle = marker.color;
                ctx.lineWidth = 6;
                ctx.beginPath();
                ctx.moveTo(xPos, top + 2);
                ctx.lineTo(xPos, top + height - 2);
                ctx.stroke();
                ctx.restore();
              });
              const text = String(b.subject || '').replace(/\s+/g, ' ').trim();
              if (text && width > 16) {
                const maxWidth = width - 8;
                const fitText = (value) => {
                  if (ctx.measureText(value).width <= maxWidth) return value;
                  let clipped = value;
                  while (clipped.length > 0 && ctx.measureText(`${clipped}...`).width > maxWidth) {
                    clipped = clipped.slice(0, -1);
                  }
                  return clipped ? `${clipped}...` : '';
                };
                const label = fitText(text);
                if (label) {
                  ctx.fillStyle = '#ffffff';
                  ctx.font = '10px Inter, sans-serif';
                  ctx.textBaseline = 'middle';
                  ctx.textAlign = 'left';
                  ctx.fillText(label, left + 4, yPix);
                }
              }
            });
            ctx.restore();
          }
        };

        if (currentInstance) currentInstance.destroy();
        const nextInstance = new Chart(chartEl.getContext('2d'), {
          type: 'scatter',
          data: {
            datasets: [
              {
                type: 'scatter',
                label: 'Creacion',
                data: createdData,
                pointBackgroundColor: '#f97316',
                pointBorderColor: '#f97316',
                pointRadius: 0,
                pointHoverRadius: 0,
                pointHitRadius: 10,
                order: 1,
                showLine: false,
                parsing: { xAxisKey: 'x', yAxisKey: 'y' }
              },
              {
                type: 'scatter',
                label: 'Inicio (startDate)',
                data: startData,
                pointBackgroundColor: '#ef4444',
                pointBorderColor: '#ef4444',
                pointRadius: 0,
                pointHoverRadius: 0,
                pointHitRadius: 10,
                order: 1,
                showLine: false,
                parsing: { xAxisKey: 'x', yAxisKey: 'y' }
              },
              {
                type: 'scatter',
                label: 'Vencimiento',
                data: dueData,
                pointBackgroundColor: '#facc15',
                pointBorderColor: '#facc15',
                pointRadius: 0,
                pointHoverRadius: 0,
                pointHitRadius: 10,
                order: 1,
                showLine: false,
                parsing: { xAxisKey: 'x', yAxisKey: 'y' }
              },
              {
                type: 'scatter',
                label: 'Ultima actualizacion',
                data: updatedData,
                pointBackgroundColor: '#10b981',
                pointBorderColor: '#10b981',
                pointRadius: 0,
                pointHoverRadius: 0,
                pointHitRadius: 10,
                order: 1,
                showLine: false,
                parsing: { xAxisKey: 'x', yAxisKey: 'y' }
              }
            ]
          },
          options: {
            indexAxis: 'y',
            responsive: true,
            interaction: { mode: 'nearest', intersect: true },
            plugins: {
              legend: { display: false },
              tooltip: {
                enabled: true,
                callbacks: {
                  label: (ctx) => {
                    const raw = ctx.raw;
                    const xLabel = raw.x || '';
                    return `${ctx.dataset.label}: ${raw.subject} (ID: ${raw.y}) | ${xLabel}`;
                  }
                }
              },
              startRangeBars: { bars: barRects },
              zoom: {
                pan: {
                  enabled: true,
                  mode: 'xy',
                  modifierKey: null
                },
                zoom: {
                  wheel: { enabled: false },
                  pinch: { enabled: false },
                  drag: { enabled: false }
                }
              }
            },
            layout: { padding: { top: 16, right: 16, bottom: 48, left: 12 } },
            scales: {
              x: {
                type: 'category',
                labels: dateLabels,
                title: { display: false, text: '' },
                ticks: {
                  maxRotation: 90,
                  minRotation: 90,
                  padding: 8,
                  callback: (val) => {
                    const label = typeof val === 'string' ? val : dateLabels[val];
                    return formatDateLabel(label);
                  }
                }
              },
              y: {
                type: 'category',
                labels: yLabels,
                title: { display: true, text: 'ID de tarea' },
                ticks: { padding: 8 },
                offset: true,
                grid: { offset: true }
              }
            }
          },
          plugins: [barPlugin]
        });
        setInstance(nextInstance);
        renderStartcurveLegend(legendEl, nextInstance);

      }

      function refresh() {
        const items = filterItems();
        renderTablePanels(items);
        drawStatusChart(items);
        renderKpiGauges(items);
        renderAgingHeatmap(items);
        if (graphSelect && graphSelect.value === 'labor-people') {
          drawLaborPeopleChart(items);
        }
        if (graphSelect && graphSelect.value === 'progress-curve') {
          drawProgressCurve(items);
        }
        if (graphSelect && graphSelect.value === 'real-hours') {
          drawRealHoursChart(items);
        }
        if (graphSelect && graphSelect.value === 'role-performance') {
          drawRolePerformanceChart(items);
        }
        drawStartCurve(items);
      }

      searchInput.addEventListener('input', refresh);
      statusFilter.addEventListener('change', refresh);
      if (priorityFilter) priorityFilter.addEventListener('change', refresh);
      if (kpiPersonSelect) kpiPersonSelect.addEventListener('change', refresh);
      if (kpiProgressPersonSelect) kpiProgressPersonSelect.addEventListener('change', refresh);
      if (kpiOverduePersonSelect) kpiOverduePersonSelect.addEventListener('change', refresh);
      if (kpiPrioritySelect) kpiPrioritySelect.addEventListener('change', refresh);
      if (kpiIgPhaseSelect) kpiIgPhaseSelect.addEventListener('change', refresh);
      if (progressRangeMain) progressRangeMain.addEventListener('change', refresh);
      if (progressRangeChild) progressRangeChild.addEventListener('change', refresh);

      const bindProgressLegend = (container, getChart) => {
        if (!container) return;
        container.addEventListener('click', (event) => {
          const target = event.target.closest('.progress-legend-item');
          if (!target) return;
          const idx = Number(target.getAttribute('data-dataset'));
          if (!Number.isFinite(idx)) return;
          const chart = getChart();
          if (!chart) return;
          const checkbox = target.querySelector('input[type="checkbox"]');
          let nextVisible;
          if (checkbox) {
            if (event.target === checkbox) {
              nextVisible = checkbox.checked;
            } else {
              nextVisible = !checkbox.checked;
              checkbox.checked = nextVisible;
            }
          } else {
            nextVisible = !chart.isDatasetVisible(idx);
          }
          chart.setDatasetVisibility(idx, nextVisible);
          target.classList.toggle('legend-disabled', !nextVisible);
          chart.update();
        });
      };
      bindProgressLegend(
        document.querySelector('.progress-legend[data-legend-for="main"]'),
        () => progressCurveMainChartInstance
      );
      bindProgressLegend(
        document.querySelector('.progress-legend[data-legend-for="child"]'),
        () => progressCurveChartInstance
      );

      document.getElementById('download-pdf-btn').addEventListener('click', () => {
        const g = graphSelect ? graphSelect.value : 'status';
        const panel = document.querySelector(`.graph-panel[data-graph-panel="${g}"]`);
        if (panel) panel.classList.add('print-target');
        document.body.classList.add('print-selected');
        const cleanup = () => {
          document.body.classList.remove('print-selected');
          if (panel) panel.classList.remove('print-target');
          window.removeEventListener('afterprint', cleanup);
        };
        window.addEventListener('afterprint', cleanup);
        window.print();
      });

      function syncGraphPanels() {
        const g = graphSelect ? graphSelect.value : 'status';
        if (statusPanel) statusPanel.style.display = g === 'status' ? '' : 'none';
        if (agingPanel) agingPanel.style.display = g === 'aging' ? '' : 'none';
        if (laborPeoplePanel) laborPeoplePanel.style.display = g === 'labor-people' ? '' : 'none';
        if (progressCurvePanel) progressCurvePanel.style.display = g === 'progress-curve' ? '' : 'none';
        if (realHoursPanel) realHoursPanel.style.display = g === 'real-hours' ? '' : 'none';
        if (rolePerformancePanel) rolePerformancePanel.style.display = g === 'role-performance' ? '' : 'none';
        if (startcurvePanel) startcurvePanel.style.display = g === 'startcurve' ? '' : 'none';
        if (g === 'labor-people') {
          const items = filterItems();
          setTimeout(() => drawLaborPeopleChart(items), 0);
          setTimeout(() => drawLaborPeopleChart(items), 80);
          if (!laborPeopleResizeObserver && laborPeoplePanel) {
            laborPeopleResizeObserver = new ResizeObserver(() => {
              if (graphSelect && graphSelect.value === 'labor-people') {
                drawLaborPeopleChart(filterItems());
              }
            });
            laborPeopleResizeObserver.observe(laborPeoplePanel);
          }
        }
        if (g === 'real-hours') {
          const items = filterItems();
          requestAnimationFrame(() => drawRealHoursChart(items));
          setTimeout(() => drawRealHoursChart(items), 120);
          if (!realHoursResizeObserver && realHoursPanel) {
            realHoursResizeObserver = new ResizeObserver(() => {
              if (graphSelect && graphSelect.value === 'real-hours') {
                drawRealHoursChart(filterItems());
              }
            });
            realHoursResizeObserver.observe(realHoursPanel);
          }
        }
        if (g === 'progress-curve') {
          drawProgressCurve(filterItems());
        }
        if (g === 'role-performance') {
          drawRolePerformanceChart(filterItems());
        }
      }

      graphSelect.addEventListener('change', () => {
        syncGraphPanels();
        // Redibujar por si cambian tamanos al ocultar/mostrar
        const items = filterItems();
        drawStatusChart(items);
        renderAgingHeatmap(items);
        drawLaborPeopleChart(items);
        drawProgressCurve(items);
        drawRolePerformanceChart(items);
        const flowChartFn = window.drawFlowChart;
        const burndownChartFn = window.drawBurndownChart;
        if (typeof flowChartFn === 'function') flowChartFn(items);
        if (typeof burndownChartFn === 'function') burndownChartFn(items);
      });

      syncGraphPanels();
      function downloadStatusChart() {
        if (!statusChart) return;
        const url = statusChart.toDataURL('image/png');
        const a = document.createElement('a');
        a.href = url;
        a.download = `inventario_estados_${Date.now()}.png`;
        a.click();
      }

      function downloadAgingChart() {
        if (!agingSnapshot) return;
        const { buckets, counts, max } = agingSnapshot;

        // Canvas dimension y estilo similar al grid
        const width = 720;
        const rowH = 70;
        const padding = 20;
        const radius = 10;
        const height = padding * 2 + buckets.length * rowH;

        const canvas = document.createElement('canvas');
        canvas.width = width * window.devicePixelRatio;
        canvas.height = height * window.devicePixelRatio;
        const ctx = canvas.getContext('2d');
        ctx.setTransform(1, 0, 0, 1, 0, 0);
        ctx.scale(window.devicePixelRatio, window.devicePixelRatio);

        // Fondo
        ctx.fillStyle = '#ffffff';
        ctx.fillRect(0, 0, width, height);

        ctx.font = '12px Inter, sans-serif';
        ctx.textBaseline = 'middle';

        const drawRoundedRect = (x, y, w, h, r) => {
          ctx.beginPath();
          ctx.moveTo(x + r, y);
          ctx.lineTo(x + w - r, y);
          ctx.quadraticCurveTo(x + w, y, x + w, y + r);
          ctx.lineTo(x + w, y + h - r);
          ctx.quadraticCurveTo(x + w, y + h, x + w - r, y + h);
          ctx.lineTo(x + r, y + h);
          ctx.quadraticCurveTo(x, y + h, x, y + h - r);
          ctx.lineTo(x, y + r);
          ctx.quadraticCurveTo(x, y, x + r, y);
          ctx.closePath();
        };

        buckets.forEach((b, i) => {
          const count = counts[i];
          const intensity = max ? count / max : 0;
          const color = `rgba(29,78,216, ${0.15 + intensity * 0.65})`;
          const y = padding + i * rowH;
          const boxHeight = rowH - 10;

          // Fondo degradado similar a las celdas de la UI
          const gradient = ctx.createLinearGradient(padding, y, width - padding, y + boxHeight);
          gradient.addColorStop(0, color);
          gradient.addColorStop(1, '#ffffff');

          drawRoundedRect(padding, y, width - padding * 2, boxHeight, radius);
          ctx.fillStyle = gradient;
          ctx.fill();
          ctx.strokeStyle = '#dbeafe';
          ctx.lineWidth = 1;
          ctx.stroke();

          // Texto principal
          ctx.fillStyle = '#0f172a';
          ctx.font = '13px Inter, sans-serif';
          ctx.fillText(`${b.label}: ${count} paquetes de trabajo`, padding + 12, y + boxHeight / 2);
        });

        const url = canvas.toDataURL('image/png');
        const a = document.createElement('a');
        a.href = url;
        a.download = `aging_index_${Date.now()}.png`;
        a.click();
      }

      if (downloadStatusIcon) downloadStatusIcon.addEventListener('click', downloadStatusChart);
      if (downloadAgingIcon) downloadAgingIcon.addEventListener('click', downloadAgingChart);
      if (downloadStartcurveIcon) downloadStartcurveIcon.addEventListener('click', () => {
        if (!startcurveMainChart) return;
        const url = startcurveMainChart.toDataURL('image/png');
        const a = document.createElement('a');
        a.href = url;
        a.download = `curva_inicio_${Date.now()}.png`;
        a.click();
      });

      refresh();
    })();
  </script>
</body>
</html>
